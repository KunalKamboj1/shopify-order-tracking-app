import{b as ze,c as Ye,j as Dy,k as Uy}from"/build/_shared/chunk-75R42CZL.js";import{m as Ky,n as Wy}from"/build/_shared/chunk-IPTBUBXZ.js";import{a as m,b as d,c as yr,e as R,f as Ly,h as Ji}from"/build/_shared/chunk-IA5SELQI.js";var vu=d((YP,Fy)=>{Fy.exports={Polaris:{ActionMenu:{Actions:{moreActions:"More actions"},RollupActions:{rollupButton:"View actions"}},ActionList:{SearchField:{clearButtonLabel:"Clear",search:"Search",placeholder:"Search actions"}},Avatar:{label:"Avatar",labelWithInitials:"Avatar with initials {initials}"},Autocomplete:{spinnerAccessibilityLabel:"Loading",ellipsis:"{content}\u2026"},Badge:{PROGRESS_LABELS:{incomplete:"Incomplete",partiallyComplete:"Partially complete",complete:"Complete"},TONE_LABELS:{info:"Info",success:"Success",warning:"Warning",critical:"Critical",attention:"Attention",new:"New",readOnly:"Read-only",enabled:"Enabled"},progressAndTone:"{toneLabel} {progressLabel}"},Banner:{dismissButton:"Dismiss notification"},Button:{spinnerAccessibilityLabel:"Loading"},Common:{checkbox:"checkbox",undo:"Undo",cancel:"Cancel",clear:"Clear",close:"Close",submit:"Submit",more:"More"},ContextualSaveBar:{save:"Save",discard:"Discard"},DataTable:{sortAccessibilityLabel:"sort {direction} by",navAccessibilityLabel:"Scroll table {direction} one column",totalsRowHeading:"Totals",totalRowHeading:"Total"},DatePicker:{previousMonth:"Show previous month, {previousMonthName} {showPreviousYear}",nextMonth:"Show next month, {nextMonth} {nextYear}",today:"Today ",start:"Start of range",end:"End of range",months:{january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},days:{monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sunday:"Sunday"},daysAbbreviated:{monday:"Mo",tuesday:"Tu",wednesday:"We",thursday:"Th",friday:"Fr",saturday:"Sa",sunday:"Su"}},DiscardConfirmationModal:{title:"Discard all unsaved changes",message:"If you discard changes, you\u2019ll delete any edits you made since you last saved.",primaryAction:"Discard changes",secondaryAction:"Continue editing"},DropZone:{single:{overlayTextFile:"Drop file to upload",overlayTextImage:"Drop image to upload",overlayTextVideo:"Drop video to upload",actionTitleFile:"Add file",actionTitleImage:"Add image",actionTitleVideo:"Add video",actionHintFile:"or drop file to upload",actionHintImage:"or drop image to upload",actionHintVideo:"or drop video to upload",labelFile:"Upload file",labelImage:"Upload image",labelVideo:"Upload video"},allowMultiple:{overlayTextFile:"Drop files to upload",overlayTextImage:"Drop images to upload",overlayTextVideo:"Drop videos to upload",actionTitleFile:"Add files",actionTitleImage:"Add images",actionTitleVideo:"Add videos",actionHintFile:"or drop files to upload",actionHintImage:"or drop images to upload",actionHintVideo:"or drop videos to upload",labelFile:"Upload files",labelImage:"Upload images",labelVideo:"Upload videos"},errorOverlayTextFile:"File type is not valid",errorOverlayTextImage:"Image type is not valid",errorOverlayTextVideo:"Video type is not valid"},EmptySearchResult:{altText:"Empty search results"},Frame:{skipToContent:"Skip to content",navigationLabel:"Navigation",Navigation:{closeMobileNavigationLabel:"Close navigation"}},FullscreenBar:{back:"Back",accessibilityLabel:"Exit fullscreen mode"},Filters:{moreFilters:"More filters",moreFiltersWithCount:"More filters ({count})",filter:"Filter {resourceName}",noFiltersApplied:"No filters applied",cancel:"Cancel",done:"Done",clearAllFilters:"Clear all filters",clear:"Clear",clearLabel:"Clear {filterName}",addFilter:"Add filter",clearFilters:"Clear all"},FilterPill:{clear:"Clear"},IndexFilters:{searchFilterTooltip:"Search and filter",searchFilterTooltipWithShortcut:"Search and filter (F)",searchFilterAccessibilityLabel:"Search and filter results",sort:"Sort your results",addView:"Add a new view",newView:"Custom search",SortButton:{ariaLabel:"Sort the results",tooltip:"Sort",title:"Sort by",sorting:{asc:"Ascending",desc:"Descending",az:"A-Z",za:"Z-A"}},EditColumnsButton:{tooltip:"Edit columns",accessibilityLabel:"Customize table column order and visibility"},UpdateButtons:{cancel:"Cancel",update:"Update",save:"Save",saveAs:"Save as",modal:{title:"Save view as",label:"Name",sameName:"A view with this name already exists. Please choose a different name.",save:"Save",cancel:"Cancel"}}},IndexProvider:{defaultItemSingular:"Item",defaultItemPlural:"Items",allItemsSelected:"All {itemsLength}+ {resourceNamePlural} are selected",selected:"{selectedItemsCount} selected",a11yCheckboxDeselectAllSingle:"Deselect {resourceNameSingular}",a11yCheckboxSelectAllSingle:"Select {resourceNameSingular}",a11yCheckboxDeselectAllMultiple:"Deselect all {itemsLength} {resourceNamePlural}",a11yCheckboxSelectAllMultiple:"Select all {itemsLength} {resourceNamePlural}"},IndexTable:{emptySearchTitle:"No {resourceNamePlural} found",emptySearchDescription:"Try changing the filters or search term",onboardingBadgeText:"New",resourceLoadingAccessibilityLabel:"Loading {resourceNamePlural}\u2026",selectAllLabel:"Select all {resourceNamePlural}",selected:"{selectedItemsCount} selected",undo:"Undo",selectAllItems:"Select all {itemsLength}+ {resourceNamePlural}",selectItem:"Select {resourceName}",selectButtonText:"Select",sortAccessibilityLabel:"sort {direction} by"},Loading:{label:"Page loading bar"},Modal:{iFrameTitle:"body markup",modalWarning:"These required properties are missing from Modal: {missingProps}"},Page:{Header:{rollupActionsLabel:"View actions for {title}",pageReadyAccessibilityLabel:"{title}. This page is ready"}},Pagination:{previous:"Previous",next:"Next",pagination:"Pagination"},ProgressBar:{negativeWarningMessage:"Values passed to the progress prop shouldn\u2019t be negative. Resetting {progress} to 0.",exceedWarningMessage:"Values passed to the progress prop shouldn\u2019t exceed 100. Setting {progress} to 100."},ResourceList:{sortingLabel:"Sort by",defaultItemSingular:"item",defaultItemPlural:"items",showing:"Showing {itemsCount} {resource}",showingTotalCount:"Showing {itemsCount} of {totalItemsCount} {resource}",loading:"Loading {resource}",selected:"{selectedItemsCount} selected",allItemsSelected:"All {itemsLength}+ {resourceNamePlural} in your store are selected",allFilteredItemsSelected:"All {itemsLength}+ {resourceNamePlural} in this filter are selected",selectAllItems:"Select all {itemsLength}+ {resourceNamePlural} in your store",selectAllFilteredItems:"Select all {itemsLength}+ {resourceNamePlural} in this filter",emptySearchResultTitle:"No {resourceNamePlural} found",emptySearchResultDescription:"Try changing the filters or search term",selectButtonText:"Select",a11yCheckboxDeselectAllSingle:"Deselect {resourceNameSingular}",a11yCheckboxSelectAllSingle:"Select {resourceNameSingular}",a11yCheckboxDeselectAllMultiple:"Deselect all {itemsLength} {resourceNamePlural}",a11yCheckboxSelectAllMultiple:"Select all {itemsLength} {resourceNamePlural}",Item:{actionsDropdownLabel:"Actions for {accessibilityLabel}",actionsDropdown:"Actions dropdown",viewItem:"View details for {itemName}"},BulkActions:{actionsActivatorLabel:"Actions",moreActionsActivatorLabel:"More actions"}},SkeletonPage:{loadingLabel:"Page loading"},Tabs:{newViewAccessibilityLabel:"Create new view",newViewTooltip:"Create view",toggleTabsLabel:"More views",Tab:{rename:"Rename view",duplicate:"Duplicate view",edit:"Edit view",editColumns:"Edit columns",delete:"Delete view",copy:"Copy of {name}",deleteModal:{title:"Delete view?",description:"This can\u2019t be undone. {viewName} view will no longer be available in your admin.",cancel:"Cancel",delete:"Delete view"}},RenameModal:{title:"Rename view",label:"Name",cancel:"Cancel",create:"Save",errors:{sameName:"A view with this name already exists. Please choose a different name."}},DuplicateModal:{title:"Duplicate view",label:"Name",cancel:"Cancel",create:"Create view",errors:{sameName:"A view with this name already exists. Please choose a different name."}},CreateViewModal:{title:"Create new view",label:"Name",cancel:"Cancel",create:"Create view",errors:{sameName:"A view with this name already exists. Please choose a different name."}}},Tag:{ariaLabel:"Remove {children}"},TextField:{characterCount:"{count} characters",characterCountWithMaxLength:"{count} of {limit} characters used"},TooltipOverlay:{accessibilityLabel:"Tooltip: {label}"},TopBar:{toggleMenuLabel:"Toggle menu",SearchField:{clearButtonLabel:"Clear",search:"Search"}},MediaCard:{dismissButton:"Dismiss",popoverButton:"Actions"},VideoThumbnail:{playButtonA11yLabel:{default:"Play video",defaultWithDuration:"Play video of length {duration}",duration:{hours:{other:{only:"{hourCount} hours",andMinutes:"{hourCount} hours and {minuteCount} minutes",andMinute:"{hourCount} hours and {minuteCount} minute",minutesAndSeconds:"{hourCount} hours, {minuteCount} minutes, and {secondCount} seconds",minutesAndSecond:"{hourCount} hours, {minuteCount} minutes, and {secondCount} second",minuteAndSeconds:"{hourCount} hours, {minuteCount} minute, and {secondCount} seconds",minuteAndSecond:"{hourCount} hours, {minuteCount} minute, and {secondCount} second",andSeconds:"{hourCount} hours and {secondCount} seconds",andSecond:"{hourCount} hours and {secondCount} second"},one:{only:"{hourCount} hour",andMinutes:"{hourCount} hour and {minuteCount} minutes",andMinute:"{hourCount} hour and {minuteCount} minute",minutesAndSeconds:"{hourCount} hour, {minuteCount} minutes, and {secondCount} seconds",minutesAndSecond:"{hourCount} hour, {minuteCount} minutes, and {secondCount} second",minuteAndSeconds:"{hourCount} hour, {minuteCount} minute, and {secondCount} seconds",minuteAndSecond:"{hourCount} hour, {minuteCount} minute, and {secondCount} second",andSeconds:"{hourCount} hour and {secondCount} seconds",andSecond:"{hourCount} hour and {secondCount} second"}},minutes:{other:{only:"{minuteCount} minutes",andSeconds:"{minuteCount} minutes and {secondCount} seconds",andSecond:"{minuteCount} minutes and {secondCount} second"},one:{only:"{minuteCount} minute",andSeconds:"{minuteCount} minute and {secondCount} seconds",andSecond:"{minuteCount} minute and {secondCount} second"}},seconds:{other:"{secondCount} seconds",one:"{secondCount} second"}}}}}}});var wu=d(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});var jy="https://cdn.shopify.com/shopifycloud/app-bridge.js";Vi.APP_BRIDGE_URL=jy});var bu=d(Gi=>{"use strict";Object.defineProperty(Gi,"__esModule",{value:!0});var By=Ly(),Jy=(Uy(),R(Dy)),Vy=Ji();function Gy(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var Xy=Gy(By),zy=Xy.default.forwardRef((e,t)=>{var r;return Vy.jsx(Jy.Link,{...e,to:(r=e.url)!==null&&r!==void 0?r:e.to,ref:t})});Gi.RemixPolarisLink=zy});var _u=d(Xi=>{"use strict";Object.defineProperty(Xi,"__esModule",{value:!0});var Yy=(Wy(),R(Ky)),Qy=vu(),Zy=wu(),eg=bu(),mn=Ji();function tg(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var rg=tg(Qy);function ng(e){let{children:t,apiKey:r,i18n:n,isEmbeddedApp:o=!0,__APP_BRIDGE_URL:i=Zy.APP_BRIDGE_URL,...s}=e;return mn.jsxs(mn.Fragment,{children:[o&&mn.jsx("script",{src:i,"data-api-key":r}),mn.jsx(Yy.AppProvider,{...s,linkComponent:eg.RemixPolarisLink,i18n:n||rg.default,children:t})]})}Xi.AppProvider=ng});var ig=d(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});var og=_u();zi.AppProvider=og.AppProvider});var T={};yr(T,{__addDisposableResource:()=>Ju,__assign:()=>yn,__asyncDelegator:()=>Lu,__asyncGenerator:()=>Nu,__asyncValues:()=>Du,__await:()=>Ht,__awaiter:()=>Iu,__classPrivateFieldGet:()=>Fu,__classPrivateFieldIn:()=>Bu,__classPrivateFieldSet:()=>ju,__createBinding:()=>vn,__decorate:()=>Au,__disposeResources:()=>Vu,__esDecorate:()=>Cu,__exportStar:()=>Hu,__extends:()=>Eu,__generator:()=>qu,__importDefault:()=>Wu,__importStar:()=>Ku,__makeTemplateObject:()=>Uu,__metadata:()=>xu,__param:()=>Ru,__propKey:()=>Ou,__read:()=>Zi,__rest:()=>Su,__rewriteRelativeImportExtension:()=>Gu,__runInitializers:()=>Pu,__setFunctionName:()=>Tu,__spread:()=>ku,__spreadArray:()=>$u,__spreadArrays:()=>Mu,__values:()=>gn,default:()=>cg});function Eu(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Yi(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Su(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function Au(e,t,r,n){var o=arguments.length,i=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(i=(o<3?s(i):o>3?s(t,r,i):s(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function Ru(e,t){return function(r,n){t(r,n,e)}}function Cu(e,t,r,n,o,i){function s(me){if(me!==void 0&&typeof me!="function")throw new TypeError("Function expected");return me}for(var a=n.kind,c=a==="getter"?"get":a==="setter"?"set":"value",u=!t&&e?n.static?e:e.prototype:null,l=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),p,h=!1,f=r.length-1;f>=0;f--){var w={};for(var S in n)w[S]=S==="access"?{}:n[S];for(var S in n.access)w.access[S]=n.access[S];w.addInitializer=function(me){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(s(me||null))};var k=(0,r[f])(a==="accessor"?{get:l.get,set:l.set}:l[c],w);if(a==="accessor"){if(k===void 0)continue;if(k===null||typeof k!="object")throw new TypeError("Object expected");(p=s(k.get))&&(l.get=p),(p=s(k.set))&&(l.set=p),(p=s(k.init))&&o.unshift(p)}else(p=s(k))&&(a==="field"?o.unshift(p):l[c]=p)}u&&Object.defineProperty(u,n.name,l),h=!0}function Pu(e,t,r){for(var n=arguments.length>2,o=0;o<t.length;o++)r=n?t[o].call(e,r):t[o].call(e);return n?r:void 0}function Ou(e){return typeof e=="symbol"?e:"".concat(e)}function Tu(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function xu(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Iu(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(l){try{u(n.next(l))}catch(p){s(p)}}function c(l){try{u(n.throw(l))}catch(p){s(p)}}function u(l){l.done?i(l.value):o(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})}function qu(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(r=0)),r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Hu(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&vn(t,e,r)}function gn(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zi(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function ku(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Zi(arguments[t]));return e}function Mu(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function $u(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function Ht(e){return this instanceof Ht?(this.v=e,this):new Ht(e)}function Nu(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(w){return Promise.resolve(w).then(f,p)}}function a(f,w){n[f]&&(o[f]=function(S){return new Promise(function(k,me){i.push([f,S,k,me])>1||c(f,S)})},w&&(o[f]=w(o[f])))}function c(f,w){try{u(n[f](w))}catch(S){h(i[0][3],S)}}function u(f){f.value instanceof Ht?Promise.resolve(f.value.v).then(l,p):h(i[0][2],f)}function l(f){c("next",f)}function p(f){c("throw",f)}function h(f,w){f(w),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Lu(e){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,i){t[o]=e[o]?function(s){return(r=!r)?{value:Ht(e[o](s)),done:!1}:i?i(s):s}:i}}function Du(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof gn=="function"?gn(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(a,c){s=e[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},s)}}function Uu(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function Ku(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=Qi(e),n=0;n<r.length;n++)r[n]!=="default"&&vn(t,e,r[n]);return sg(t,e),t}function Wu(e){return e&&e.__esModule?e:{default:e}}function Fu(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function ju(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r}function Bu(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function Ju(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,o;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(o=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");o&&(n=function(){try{o.call(this)}catch(i){return Promise.reject(i)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}function Vu(e){function t(i){e.error=e.hasError?new ag(i,e.error,"An error was suppressed during disposal."):i,e.hasError=!0}var r,n=0;function o(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(o);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(o,function(s){return t(s),o()})}else n|=1}catch(s){t(s)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return o()}function Gu(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,o,i,s){return n?t?".jsx":".js":o&&(!i||!s)?r:o+i+"."+s.toLowerCase()+"js"}):e}var Yi,yn,vn,sg,Qi,ag,cg,x=m(()=>{Yi=function(e,t){return Yi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},Yi(e,t)};yn=function(){return yn=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},yn.apply(this,arguments)};vn=Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};sg=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},Qi=function(e){return Qi=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},Qi(e)};ag=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};cg={__extends:Eu,__assign:yn,__rest:Su,__decorate:Au,__param:Ru,__esDecorate:Cu,__runInitializers:Pu,__propKey:Ou,__setFunctionName:Tu,__metadata:xu,__awaiter:Iu,__generator:qu,__createBinding:vn,__exportStar:Hu,__values:gn,__read:Zi,__spread:ku,__spreadArrays:Mu,__spreadArray:$u,__await:Ht,__asyncGenerator:Nu,__asyncDelegator:Lu,__asyncValues:Du,__makeTemplateObject:Uu,__importStar:Ku,__importDefault:Wu,__classPrivateFieldGet:Fu,__classPrivateFieldSet:ju,__classPrivateFieldIn:Bu,__addDisposableResource:Ju,__disposeResources:Vu,__rewriteRelativeImportExtension:Gu}});var U=d(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.FeatureDeprecatedError=b.BillingError=b.InvalidRequestError=b.UnsupportedClientType=b.MissingRequiredArgument=b.SessionStorageError=b.MissingWebhookCallbackError=b.InvalidWebhookError=b.InvalidSession=b.CookieNotFound=b.BotActivityDetected=b.InvalidOAuthError=b.GraphqlQueryError=b.RestResourceError=b.HttpThrottlingError=b.HttpInternalError=b.HttpRetriableError=b.HttpResponseError=b.HttpMaxRetriesError=b.HttpRequestError=b.PrivateAppError=b.SafeCompareError=b.InvalidDeliveryMethodError=b.MissingJwtTokenError=b.InvalidJwtError=b.InvalidHostError=b.InvalidShopError=b.InvalidHmacError=b.ShopifyError=void 0;var ug=(x(),R(T)),N=class extends Error{constructor(...t){super(...t),Object.setPrototypeOf(this,new.target.prototype)}};b.ShopifyError=N;var es=class extends N{};b.InvalidHmacError=es;var ts=class extends N{};b.InvalidShopError=ts;var rs=class extends N{};b.InvalidHostError=rs;var ns=class extends N{};b.InvalidJwtError=ns;var os=class extends N{};b.MissingJwtTokenError=os;var is=class extends N{};b.InvalidDeliveryMethodError=is;var ss=class extends N{};b.SafeCompareError=ss;var as=class extends N{};b.PrivateAppError=as;var cs=class extends N{};b.HttpRequestError=cs;var us=class extends N{};b.HttpMaxRetriesError=us;var wn=class extends N{constructor({message:t,code:r,statusText:n,body:o,headers:i}){super(t),this.response={code:r,statusText:n,body:o,headers:i}}};b.HttpResponseError=wn;var gr=class extends wn{};b.HttpRetriableError=gr;var ls=class extends gr{};b.HttpInternalError=ls;var ds=class extends gr{constructor(t){var{retryAfter:r}=t,n=ug.__rest(t,["retryAfter"]);super(n),this.response.retryAfter=r}};b.HttpThrottlingError=ds;var ps=class extends N{};b.RestResourceError=ps;var fs=class extends N{constructor({message:t,response:r,headers:n}){super(t),this.response=r,this.headers=n}};b.GraphqlQueryError=fs;var hs=class extends N{};b.InvalidOAuthError=hs;var ms=class extends N{};b.BotActivityDetected=ms;var ys=class extends N{};b.CookieNotFound=ys;var gs=class extends N{};b.InvalidSession=gs;var bn=class extends N{constructor({message:t,response:r}){super(t),this.response=r}};b.InvalidWebhookError=bn;var vs=class extends bn{};b.MissingWebhookCallbackError=vs;var ws=class extends N{};b.SessionStorageError=ws;var bs=class extends N{};b.MissingRequiredArgument=bs;var _s=class extends N{};b.UnsupportedClientType=_s;var Es=class extends N{};b.InvalidRequestError=Es;var Ss=class extends N{constructor({message:t,errorData:r}){super(t),this.message=t,this.errorData=r}};b.BillingError=Ss;var As=class extends N{};b.FeatureDeprecatedError=As});var Cs=d(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.crypto=Qe.setCrypto=void 0;var Rs;Qe.crypto=Rs;try{Qe.crypto=Rs=crypto}catch{}function lg(e){Qe.crypto=Rs=e}Qe.setCrypto=lg});var vt=d(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.HashFormat=void 0;var dg;(function(e){e.Base64="base64",e.Hex="hex"})(dg=vr.HashFormat||(vr.HashFormat={}))});var Ts=d(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.hashString=ke.asBase64=ke.asHex=ke.createSHA256HMAC=void 0;var pg=(x(),R(T)),fg=U(),wr=Cs(),En=vt();function hg(e,t,r=En.HashFormat.Base64){return pg.__awaiter(this,void 0,void 0,function*(){let n=typeof(wr.crypto===null||wr.crypto===void 0?void 0:wr.crypto.webcrypto)>"u"?wr.crypto:wr.crypto.webcrypto,o=new TextEncoder,i=yield n.subtle.importKey("raw",o.encode(e),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),s=yield n.subtle.sign("HMAC",i,o.encode(t));return r===En.HashFormat.Base64?Os(s):Ps(s)})}ke.createSHA256HMAC=hg;function Ps(e){return[...new Uint8Array(e)].map(t=>t.toString(16).padStart(2,"0")).join("")}ke.asHex=Ps;var _n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Os(e){let t="",r=new Uint8Array(e);for(let n=0;n<r.length;){let o=r[n++],i=r[n++],s=r[n++],a=o>>2,c=(o&3)<<4|i>>4,u=(i&15)<<2|s>>6,l=s&63;isNaN(i)&&(u=64),isNaN(s)&&(l=64),t+=_n[a]+_n[c]+_n[u]+_n[l]}return t}ke.asBase64=Os;function mg(e,t){let r=new TextEncoder().encode(e);switch(t){case En.HashFormat.Base64:return Os(r);case En.HashFormat.Hex:return Ps(r);default:throw new fg.ShopifyError(`Unrecognized hash format '${t}'`)}}ke.hashString=mg});var xs=d(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.splitN=void 0;function yg(e,t,r){let n=e.split(t),o=Math.min(Math.abs(r),n.length);return[...n.slice(0,o-1),n.slice(o-1).join(t)]}Sn.splitN=yg});var Is=d(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.flatHeaders=X.removeHeader=X.canonicalizeHeaders=X.addHeader=X.setHeader=X.getHeader=X.getHeaders=X.canonicalizeHeaderName=void 0;function wt(e){return e.replace(/(^|-)(\w+)/g,(t,r,n)=>r+n.slice(0,1).toUpperCase()+n.slice(1).toLowerCase())}X.canonicalizeHeaderName=wt;function zu(e,t){let r=[];if(!e)return r;let n=wt(t);for(let[o,i]of Object.entries(e))wt(o)===n&&(Array.isArray(i)?r.push(...i):r.push(i));return r}X.getHeaders=zu;function gg(e,t){var r;if(e)return(r=zu(e,t))===null||r===void 0?void 0:r[0]}X.getHeader=gg;function vg(e,t,r){An(e),e[wt(t)]=[r]}X.setHeader=vg;function wg(e,t,r){An(e);let n=wt(t),o=e[n];o?Array.isArray(o)||(o=[o]):o=[],e[n]=o,o.push(r)}X.addHeader=wg;function Xu(e){return typeof e=="number"?e.toString():e}function An(e){for(let[t,r]of Object.entries(e)){let n=wt(t);e[n]||(e[n]=[]),Array.isArray(e[n])||(e[n]=[Xu(e[n])]),t!==n&&(delete e[t],e[n].push(...[r].flat().map(o=>Xu(o))))}return e}X.canonicalizeHeaders=An;function bg(e,t){An(e);let r=wt(t);delete e[r]}X.removeHeader=bg;function _g(e){return Object.entries(e).flatMap(([t,r])=>Array.isArray(r)?r.map(n=>[t,n]):[[t,r]])}X.flatHeaders=_g});var Zu=d(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.Cookies=void 0;var qs=(x(),R(T)),Yu=Ts(),Qu=xs(),Rn=Is(),bt=class{static parseCookies(t){let r=t.filter(o=>o.trim().length>0).map(o=>{let[i,...s]=o.split(";"),[a,c]=(0,Qu.splitN)(i,"=",2).map(u=>u.trim());return[a,Object.assign({name:a,value:c},Object.fromEntries(s.map(u=>(0,Qu.splitN)(u,"=",2).map(l=>l.trim()))))]}),n=Object.fromEntries(r);for(let o of Object.values(n))typeof o.expires=="string"&&(o.expires=new Date(o.expires));return n}static encodeCookie(t){let r="";return r+=`${t.name}=${t.value};`,r+=Object.entries(t).filter(([n])=>!["name","value","expires"].includes(n)).map(([n,o])=>`${n}=${o}`).join("; "),t.expires&&(r+=";",r+=`expires=${t.expires.toUTCString()}`),r}constructor(t,r,{keys:n=[]}={}){var o,i;this.response=r,this.receivedCookieJar={},this.outgoingCookieJar={},this.keys=[],n&&(this.keys=n);let s=(o=(0,Rn.getHeader)(t.headers,"Cookie"))!==null&&o!==void 0?o:"";this.receivedCookieJar=bt.parseCookies(s.split(";"));let a=(i=(0,Rn.getHeaders)(r.headers,"Set-Cookie"))!==null&&i!==void 0?i:[];this.outgoingCookieJar=bt.parseCookies(a)}toHeaders(){return Object.values(this.outgoingCookieJar).map(t=>bt.encodeCookie(t))}updateHeader(){this.response.headers||(this.response.headers={}),(0,Rn.removeHeader)(this.response.headers,"Set-Cookie"),this.toHeaders().map(t=>(0,Rn.addHeader)(this.response.headers,"Set-Cookie",t))}get(t){var r;return(r=this.receivedCookieJar[t])===null||r===void 0?void 0:r.value}deleteCookie(t){this.set(t,"",{path:"/",expires:new Date(0)})}getAndVerify(t){return qs.__awaiter(this,void 0,void 0,function*(){let r=this.get(t);if(r&&(yield this.isSignedCookieValid(t)))return r})}get canSign(){var t;return((t=this.keys)===null||t===void 0?void 0:t.length)>0}set(t,r,n={}){this.outgoingCookieJar[t]=Object.assign(Object.assign({},n),{name:t,value:r}),this.updateHeader()}setAndSign(t,r,n={}){return qs.__awaiter(this,void 0,void 0,function*(){if(!this.canSign)throw Error("No keys provided for signing.");this.set(t,r,n);let o=`${t}.sig`,i=yield(0,Yu.createSHA256HMAC)(this.keys[0],r);this.set(o,i,n),this.updateHeader()})}isSignedCookieValid(t){return qs.__awaiter(this,void 0,void 0,function*(){let r=`${t}.sig`;if(!this.get(t)||!this.get(r))return this.deleteCookie(r),this.deleteCookie(t),!1;let n=this.get(t),o=this.get(r);return(yield Promise.all(this.keys.map(s=>(0,Yu.createSHA256HMAC)(s,n)))).includes(o)?!0:(this.deleteCookie(r),this.deleteCookie(t),!1)})}};Cn.Cookies=bt});var tl=d(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0})});var We=d(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.setAbstractConvertHeadersFunc=I.abstractConvertHeaders=I.setAbstractConvertResponseFunc=I.abstractConvertResponse=I.setAbstractConvertIncomingResponseFunc=I.abstractConvertIncomingResponse=I.setAbstractConvertRequestFunc=I.abstractConvertRequest=I.setAbstractFetchFunc=I.abstractFetch=I.isOK=void 0;var Pn=(x(),R(T));Pn.__exportStar(Zu(),I);Pn.__exportStar(Is(),I);Pn.__exportStar(xs(),I);Pn.__exportStar(tl(),I);function Eg(e){return e.statusCode>=200&&e.statusCode<=299}I.isOK=Eg;var Sg=()=>{throw new Error("Missing adapter implementation for 'abstractFetch' - make sure to import the appropriate adapter for your platform")};I.abstractFetch=Sg;function Ag(e){I.abstractFetch=e}I.setAbstractFetchFunc=Ag;var Rg=()=>{throw new Error("Missing adapter implementation for 'abstractConvertRequest' - make sure to import the appropriate adapter for your platform")};I.abstractConvertRequest=Rg;function Cg(e){I.abstractConvertRequest=e}I.setAbstractConvertRequestFunc=Cg;var Pg=()=>Promise.resolve({});I.abstractConvertIncomingResponse=Pg;function Og(e){I.abstractConvertIncomingResponse=e}I.setAbstractConvertIncomingResponseFunc=Og;var Tg=()=>{throw new Error("Missing adapter implementation for 'abstractConvertResponse' - make sure to import the appropriate adapter for your platform")};I.abstractConvertResponse=Tg;function xg(e){I.abstractConvertResponse=e}I.setAbstractConvertResponseFunc=xg;var Ig=()=>{throw new Error("Missing adapter implementation for 'abstractConvertHeaders' - make sure to import the appropriate adapter for your platform")};I.abstractConvertHeaders=Ig;function qg(e){I.abstractConvertHeaders=e}I.setAbstractConvertHeadersFunc=qg});var _t=d(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});var Hs=(x(),R(T));Hs.__exportStar(vt(),br);Hs.__exportStar(Cs(),br);Hs.__exportStar(Ts(),br)});var nl=d(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0})});var ol=d(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.setAbstractRuntimeString=Et.abstractRuntimeString=void 0;var Hg=()=>{throw new Error("Missing adapter implementation for 'abstractRuntimeString' - make sure to import the appropriate adapter for your platform")};Et.abstractRuntimeString=Hg;function kg(e){Et.abstractRuntimeString=e}Et.setAbstractRuntimeString=kg});var Tn=d(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});var il=(x(),R(T));il.__exportStar(nl(),On);il.__exportStar(ol(),On)});var St=d(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});var ks=(x(),R(T));ks.__exportStar(We(),_r);ks.__exportStar(_t(),_r);ks.__exportStar(Tn(),_r)});var al=d(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.webApiRuntimeString=Se.webApiFetch=Se.webApiConvertResponse=Se.webApiConvertHeaders=Se.webApiConvertRequest=void 0;var In=(x(),R(T)),xn=St();function Mg(e){var t;return In.__awaiter(this,void 0,void 0,function*(){let r=e.rawRequest,n={};for(let[o,i]of r.headers.entries())(0,xn.addHeader)(n,o,i);return{headers:n,method:(t=r.method)!==null&&t!==void 0?t:"GET",url:new URL(r.url).toString()}})}Se.webApiConvertRequest=Mg;function sl(e,t){return In.__awaiter(this,void 0,void 0,function*(){let r=new Headers;return(0,xn.flatHeaders)(e??{}).forEach(([n,o])=>r.append(n,o)),Promise.resolve(r)})}Se.webApiConvertHeaders=sl;function $g(e,t){var r;return In.__awaiter(this,void 0,void 0,function*(){return new Response(e.body,{status:e.statusCode,statusText:e.statusText,headers:yield sl((r=e.headers)!==null&&r!==void 0?r:{},t)})})}Se.webApiConvertResponse=$g;function Ng({headers:e,method:t,url:r,body:n}){return In.__awaiter(this,void 0,void 0,function*(){let o=yield fetch(r,{method:t,headers:(0,xn.flatHeaders)(e),body:n}),i=yield o.text();return{statusCode:o.status,statusText:o.statusText,body:i,headers:(0,xn.canonicalizeHeaders)(Object.fromEntries(o.headers.entries()))}})}Se.webApiFetch=Ng;function Lg(){return"Web API"}Se.webApiRuntimeString=Lg});var Ms=d(cl=>{"use strict";Object.defineProperty(cl,"__esModule",{value:!0});var Er=St(),Sr=al();(0,Er.setAbstractFetchFunc)(Sr.webApiFetch);(0,Er.setAbstractConvertRequestFunc)(Sr.webApiConvertRequest);(0,Er.setAbstractConvertResponseFunc)(Sr.webApiConvertResponse);(0,Er.setAbstractConvertHeadersFunc)(Sr.webApiConvertHeaders);(0,Er.setAbstractRuntimeString)(Sr.webApiRuntimeString)});var yl={};yr(yl,{compare:()=>fl,compareVersions:()=>pl,satisfies:()=>Ug,validate:()=>Dg});var pl,Dg,fl,Ug,hl,qn,ul,ll,Kg,Wg,kt,ml,dl,Fg,gl=m(()=>{pl=(e,t)=>{let r=qn(e),n=qn(t),o=r.pop(),i=n.pop(),s=kt(r,n);return s!==0?s:o&&i?kt(o.split("."),i.split(".")):o||i?o?-1:1:0},Dg=e=>typeof e=="string"&&/^[v\d]/.test(e)&&hl.test(e),fl=(e,t,r)=>{Fg(r);let n=pl(e,t);return ml[r].includes(n)},Ug=(e,t)=>{let r=t.match(/^([<>=~^]+)/),n=r?r[1]:"=";if(n!=="^"&&n!=="~")return fl(e,t,n);let[o,i,s,,a]=qn(e),[c,u,l,,p]=qn(t),h=[o,i,s],f=[c,u??"x",l??"x"];if(p&&(!a||kt(h,f)!==0||kt(a.split("."),p.split("."))===-1))return!1;let w=f.findIndex(k=>k!=="0")+1,S=n==="~"?2:w>1?w:1;return!(kt(h.slice(0,S),f.slice(0,S))!==0||kt(h.slice(S),f.slice(S))===-1)},hl=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,qn=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");let t=e.match(hl);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},ul=e=>e==="*"||e==="x"||e==="X",ll=e=>{let t=parseInt(e,10);return isNaN(t)?e:t},Kg=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],Wg=(e,t)=>{if(ul(e)||ul(t))return 0;let[r,n]=Kg(ll(e),ll(t));return r>n?1:r<n?-1:0},kt=(e,t)=>{for(let r=0;r<Math.max(e.length,t.length);r++){let n=Wg(e[r]||"0",t[r]||"0");if(n!==0)return n}return 0},ml={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},dl=Object.keys(ml),Fg=e=>{if(typeof e!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof e}`);if(dl.indexOf(e)===-1)throw new Error(`Invalid operator, expected one of ${dl.join("|")}`)}});var _e=d(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.BillingReplacementBehavior=L.BillingInterval=L.gdprTopics=L.ClientType=L.ShopifyHeader=L.LATEST_API_VERSION=L.LIBRARY_NAME=L.ApiVersion=L.LogSeverity=void 0;var jg;(function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(jg=L.LogSeverity||(L.LogSeverity={}));var vl;(function(e){e.October22="2022-10",e.January23="2023-01",e.April23="2023-04",e.July23="2023-07",e.October23="2023-10",e.Unstable="unstable"})(vl=L.ApiVersion||(L.ApiVersion={}));L.LIBRARY_NAME="Shopify API Library";L.LATEST_API_VERSION=vl.October23;var Bg;(function(e){e.AccessToken="X-Shopify-Access-Token",e.ApiVersion="X-Shopify-API-Version",e.Domain="X-Shopify-Shop-Domain",e.Hmac="X-Shopify-Hmac-Sha256",e.Topic="X-Shopify-Topic",e.WebhookId="X-Shopify-Webhook-Id",e.StorefrontPrivateToken="Shopify-Storefront-Private-Token",e.StorefrontSDKVariant="X-SDK-Variant",e.StorefrontSDKVersion="X-SDK-Version"})(Bg=L.ShopifyHeader||(L.ShopifyHeader={}));var Jg;(function(e){e.Rest="rest",e.Graphql="graphql"})(Jg=L.ClientType||(L.ClientType={}));L.gdprTopics=["CUSTOMERS_DATA_REQUEST","CUSTOMERS_REDACT","SHOP_REDACT"];var Vg;(function(e){e.OneTime="ONE_TIME",e.Every30Days="EVERY_30_DAYS",e.Annual="ANNUAL",e.Usage="USAGE"})(Vg=L.BillingInterval||(L.BillingInterval={}));var Gg;(function(e){e.ApplyImmediately="APPLY_IMMEDIATELY",e.ApplyOnNextBillingCycle="APPLY_ON_NEXT_BILLING_CYCLE",e.Standard="STANDARD"})(Gg=L.BillingReplacementBehavior||(L.BillingReplacementBehavior={}))});var Ar=d(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.SHOPIFY_API_LIBRARY_VERSION=void 0;Hn.SHOPIFY_API_LIBRARY_VERSION="8.1.1"});var wl=d(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.log=void 0;var kn=_e();function Xg(e){return function(t,r,n={}){if(t>e.logger.level)return;let o=[];e.logger.timestamps&&o.push(`${new Date().toISOString().slice(0,-5)}Z`);let i=n.package||"shopify-api";switch(delete n.package,t){case kn.LogSeverity.Debug:i=`${i}/DEBUG`;break;case kn.LogSeverity.Info:i=`${i}/INFO`;break;case kn.LogSeverity.Warning:i=`${i}/WARNING`;break;case kn.LogSeverity.Error:i=`${i}/ERROR`;break}o.push(i);let s=[];Object.entries(n).forEach(([c,u])=>{s.push(`${c}: ${u}`)});let a="";s.length>0&&(a=` | {${s.join(", ")}}`),e.logger.log(t,`[${o.join("] [")}] ${r}${a}`)}}Mn.log=Xg});var de=d(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.logger=void 0;var $n=(x(),R(T)),zg=(gl(),R(yl)),Rr=_e(),Yg=U(),Qg=Ar(),Zg=wl();function ev(e){let t=(0,Zg.log)(e);return{log:t,debug:(r,n={})=>$n.__awaiter(this,void 0,void 0,function*(){return t(Rr.LogSeverity.Debug,r,n)}),info:(r,n={})=>$n.__awaiter(this,void 0,void 0,function*(){return t(Rr.LogSeverity.Info,r,n)}),warning:(r,n={})=>$n.__awaiter(this,void 0,void 0,function*(){return t(Rr.LogSeverity.Warning,r,n)}),error:(r,n={})=>$n.__awaiter(this,void 0,void 0,function*(){return t(Rr.LogSeverity.Error,r,n)}),deprecated:tv(t)}}Nn.logger=ev;function tv(e){return function(t,r){if((0,zg.compare)(Qg.SHOPIFY_API_LIBRARY_VERSION,t,">="))throw new Yg.FeatureDeprecatedError(`Feature was deprecated in version ${t}`);return e(Rr.LogSeverity.Warning,`[Deprecated | ${t}] ${r}`)}}});var bl=d(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.loadRestResources=void 0;var rv=de();function nv({resources:e,config:t,RestClient:r}){let n=Object.keys(e)[0];return t.apiVersion!==e[n].apiVersion&&(0,rv.logger)(t).warning(`Loading REST resources for API version ${e[n].apiVersion}, which doesn't match the default ${t.apiVersion}`),Object.fromEntries(Object.entries(e).map(([o,i])=>{class s extends i{}return s.setClassProperties({Client:r,config:t}),Object.entries(s.hasOne).map(([a,c])=>{c.setClassProperties({Client:r,config:t})}),Object.entries(s.hasMany).map(([a,c])=>{c.setClassProperties({Client:r,config:t})}),Reflect.defineProperty(s,"name",{value:o}),[o,s]}))}Ln.loadRestResources=nv});var $s=d(Dn=>{"use strict";Object.defineProperty(Dn,"__esModule",{value:!0});Dn.AuthScopes=void 0;var Pe=class{constructor(t){let r=[];typeof t=="string"?r=t.split(new RegExp(`${Pe.SCOPE_DELIMITER}\\s*`)):Array.isArray(t)?r=t:t&&(r=Array.from(t.expandedScopes)),r=r.map(s=>s.trim()).filter(s=>s.length);let n=this.getImpliedScopes(r),o=new Set(r),i=new Set(n);this.compressedScopes=new Set([...o].filter(s=>!i.has(s))),this.expandedScopes=new Set([...o,...i])}has(t){let r;return t instanceof Pe?r=t:r=new Pe(t),r.toArray().filter(n=>!this.expandedScopes.has(n)).length===0}equals(t){let r;return t instanceof Pe?r=t:r=new Pe(t),this.compressedScopes.size===r.compressedScopes.size&&this.toArray().filter(n=>!r.has(n)).length===0}toString(){return this.toArray().join(Pe.SCOPE_DELIMITER)}toArray(){return[...this.compressedScopes]}getImpliedScopes(t){return t.reduce((r,n)=>{let o=n.match(/^(unauthenticated_)?write_(.*)$/);return o&&r.push(`${o[1]?o[1]:""}read_${o[2]}`),r},[])}};Dn.AuthScopes=Pe;Pe.SCOPE_DELIMITER=","});var _l=d(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.validateConfig=void 0;var ov=(x(),R(T)),iv=U(),Mt=_e(),Ns=$s(),sv=de();function av(e){var t;let r={apiKey:"",apiSecretKey:"",scopes:new Ns.AuthScopes([]),hostName:"",hostScheme:"https",apiVersion:Mt.LATEST_API_VERSION,isEmbeddedApp:!0,isCustomStoreApp:!1,logger:{log:uv,level:Mt.LogSeverity.Info,httpRequests:!1,timestamps:!1},future:{}},n=["apiSecretKey","hostName"];(!("isCustomStoreApp"in e)||!e.isCustomStoreApp)&&(n.push("apiKey"),n.push("scopes")),"isCustomStoreApp"in e&&e.isCustomStoreApp&&(!("adminApiAccessToken"in e)||((t=e.adminApiAccessToken)===null||t===void 0?void 0:t.length)===0)&&n.push("adminApiAccessToken");let o=[];if(n.forEach(w=>{cv(e[w])||o.push(w)}),o.length)throw new iv.ShopifyError(`Cannot initialize Shopify API Library. Missing values for: ${o.join(", ")}`);let{hostScheme:i,isCustomStoreApp:s,adminApiAccessToken:a,userAgentPrefix:c,logger:u,privateAppStorefrontAccessToken:l,customShopDomains:p,billing:h}=e,f=ov.__rest(e,["hostScheme","isCustomStoreApp","adminApiAccessToken","userAgentPrefix","logger","privateAppStorefrontAccessToken","customShopDomains","billing"]);return Object.assign(r,f,{hostName:e.hostName.replace(/\/$/,""),scopes:e.scopes instanceof Ns.AuthScopes?e.scopes:new Ns.AuthScopes(e.scopes),hostScheme:i??r.hostScheme,isCustomStoreApp:s??r.isCustomStoreApp,adminApiAccessToken:a??r.adminApiAccessToken,userAgentPrefix:c??r.userAgentPrefix,logger:Object.assign(Object.assign({},r.logger),u||{}),privateAppStorefrontAccessToken:l??r.privateAppStorefrontAccessToken,customShopDomains:p??r.customShopDomains,billing:h??r.billing}),r.isCustomStoreApp&&e.adminApiAccessToken===e.apiSecretKey&&(0,sv.logger)(r).warning("adminApiAccessToken is set to the same value as apiSecretKey. adminApiAccessToken should be set to the Admin API access token for custom store apps; apiSecretKey should be set to the custom store app's API secret key."),r}Un.validateConfig=av;function cv(e){return e==null?!1:typeof e=="string"||Array.isArray(e)?e.length>0:!0}function uv(e,t){switch(e){case Mt.LogSeverity.Debug:console.debug(t);break;case Mt.LogSeverity.Info:console.log(t);break;case Mt.LogSeverity.Warning:console.warn(t);break;case Mt.LogSeverity.Error:console.error(t);break}}});var El=d(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.Method=void 0;(function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Patch="PATCH",e.Delete="DELETE",e.Head="HEAD",e.Options="OPTIONS",e.Connect="CONNECT"})(A.Method||(A.Method={}));A.StatusCode=void 0;(function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported"})(A.StatusCode||(A.StatusCode={}));A.Header=void 0;(function(e){e.Accept="Accept",e.AcceptEncoding="Accept-Encoding",e.AcceptLanguage="Accept-Language",e.AccessControlAllowCredentials="Access-Control-Allow-Credentials",e.AccessControlAllowHeaders="Access-Control-Allow-Headers",e.AccessControlAllowMethods="Access-Control-Allow-Methods",e.AccessControlAllowOrigin="Access-Control-Allow-Origin",e.AccessControlExposeHeaders="Access-Control-Expose-Headers",e.AccessControlMaxAge="Access-Control-Max-Age",e.AccessControlRequestHeaders="Access-Control-Request-Headers",e.AccessControlRequestMethod="Access-Control-Request-Method",e.Authorization="Authorization",e.CacheControl="Cache-Control",e.CacheStatus="Cache-Status",e.Connection="Connection",e.ContentDisposition="Content-Disposition",e.ContentEncoding="Content-Encoding",e.ContentLength="Content-Length",e.ContentSecurityPolicy="Content-Security-Policy",e.ContentSecurityPolicyReportOnly="Content-Security-Policy-Report-Only",e.ContentType="Content-Type",e.ContentTypeOptions="X-Content-Type-Options",e.Cookie="Cookie",e.DownloadOptions="X-Download-Options",e.ETag="ETag",e.Forwarded="Forwarded",e.ForwardedFor="X-Forwarded-For",e.ForwardedHost="X-Forwarded-Host",e.ForwardedProtocol="X-Forwarded-Proto",e.FrameOptions="X-Frame-Options",e.Host="Host",e.IfNoneMatch="If-None-Match",e.Location="Location",e.Origin="Origin",e.ReferrerPolicy="Referrer-Policy",e.ServerTiming="Server-Timing",e.StrictTransportSecurity="Strict-Transport-Security",e.TimingAllowOrigin="Timing-Allow-Origin",e.Trailer="Trailer",e.TransferEncoding="Transfer-Encoding",e.UserAgent="User-Agent",e.WwwAuthenticate="WWW-Authenticate",e.XhrRedirectedTo="X-XHR-Redirected-To",e.XhrReferer="X-XHR-Referer",e.XssProtecton="X-XSS-Protection",e.XContentTypeOptions="X-Content-Type-Options",e.XDownloadOptions="X-Download-Options",e.XForwardedFor="X-Forwarded-For",e.XForwardedHost="X-Forwarded-Host",e.XForwardedProto="X-Forwarded-Proto",e.XFrameOptions="X-Frame-Options",e.XXhrRedirectedTo="X-XHR-Redirected-To",e.XXhrReferer="X-XHR-Referer",e.XXssProtecton="X-XSS-Protection",e.XXssProtection="X-XSS-Protection"})(A.Header||(A.Header={}));A.CspDirective=void 0;(function(e){e.ChildSrc="child-src",e.ConnectSrc="connect-src",e.DefaultSrc="default-src",e.FontSrc="font-src",e.FrameSrc="frame-src",e.ImgSrc="img-src",e.ManifestSrc="manifest-src",e.MediaSrc="media-src",e.ObjectSrc="object-src",e.PrefetchSrc="prefetch-src",e.ScriptSrc="script-src",e.StyleSrc="style-src",e.WebrtcSrc="webrtc-src",e.WorkerSrc="worker-src",e.BaseUri="base-uri",e.PluginTypes="plugin-types",e.Sandbox="sandbox",e.FormAction="form-action",e.FrameAncestors="frame-ancestors",e.ReportUri="report-uri",e.BlockAllMixedContent="block-all-mixed-content",e.RequireSriFor="require-sri-for",e.UpgradeInsecureRequests="upgrade-insecure-requests"})(A.CspDirective||(A.CspDirective={}));A.CspSandboxAllow=void 0;(function(e){e.Forms="allow-forms",e.SameOrigin="allow-same-origin",e.Scripts="allow-scripts",e.Popups="allow-popups",e.Modals="allow-modals",e.OrientationLock="allow-orientation-lock",e.PointerLock="allow-pointer-lock",e.Presentation="allow-presentation",e.PopupsToEscapeSandbox="allow-popups-to-escape-sandbox",e.TopNavigation="allow-top-navigation"})(A.CspSandboxAllow||(A.CspSandboxAllow={}));A.SpecialSource=void 0;(function(e){e.Any="*",e.Self="'self'",e.UnsafeInline="'unsafe-inline'",e.UnsafeEval="'unsafe-eval'",e.None="'none'",e.StrictDynamic="'strict-dynamic'",e.ReportSample="'report-sample'",e.Data="data:",e.Blob="blob:",e.FileSystem="filesystem:"})(A.SpecialSource||(A.SpecialSource={}));A.SriAsset=void 0;(function(e){e.Script="script",e.Style="style"})(A.SriAsset||(A.SriAsset={}));A.HashAlgorithm=void 0;(function(e){e.Sha256="sha256",e.Sha384="sha384",e.Sha512="sha512"})(A.HashAlgorithm||(A.HashAlgorithm={}));A.ResponseType=void 0;(function(e){e.Informational="1xx",e.Success="2xx",e.Redirection="3xx",e.ClientError="4xx",e.ServerError="5xx",e.Unknown="Unknown"})(A.ResponseType||(A.ResponseType={}));function lv(e){return e>=100&&e<200?A.ResponseType.Informational:e>=200&&e<300?A.ResponseType.Success:e>=300&&e<400?A.ResponseType.Redirection:e>=400&&e<500?A.ResponseType.ClientError:e>=500&&e<600?A.ResponseType.ServerError:A.ResponseType.Unknown}function dv(e){return`'nonce-${e}'`}function pv(e,t){return`'${e}-${t}'`}A.CacheControl=void 0;(function(e){e.NoCache="no-cache",e.NoStore="no-store",e.MustRevalidate="must-revalidate",e.MaxAge="max-age"})(A.CacheControl||(A.CacheControl={}));var fv=`${A.CacheControl.NoCache},${A.CacheControl.NoStore},${A.CacheControl.MustRevalidate},${A.CacheControl.MaxAge}=0`;A.getResponseType=lv;A.hashSource=pv;A.noCache=fv;A.nonceSource=dv});var Sl=d(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var ye=El();Object.defineProperty(ne,"CacheControl",{enumerable:!0,get:function(){return ye.CacheControl}});Object.defineProperty(ne,"CspDirective",{enumerable:!0,get:function(){return ye.CspDirective}});Object.defineProperty(ne,"CspSandboxAllow",{enumerable:!0,get:function(){return ye.CspSandboxAllow}});Object.defineProperty(ne,"HashAlgorithm",{enumerable:!0,get:function(){return ye.HashAlgorithm}});Object.defineProperty(ne,"Header",{enumerable:!0,get:function(){return ye.Header}});Object.defineProperty(ne,"Method",{enumerable:!0,get:function(){return ye.Method}});Object.defineProperty(ne,"ResponseType",{enumerable:!0,get:function(){return ye.ResponseType}});Object.defineProperty(ne,"SpecialSource",{enumerable:!0,get:function(){return ye.SpecialSource}});Object.defineProperty(ne,"SriAsset",{enumerable:!0,get:function(){return ye.SriAsset}});Object.defineProperty(ne,"StatusCode",{enumerable:!0,get:function(){return ye.StatusCode}});ne.getResponseType=ye.getResponseType;ne.hashSource=ye.hashSource;ne.noCache=ye.noCache;ne.nonceSource=ye.nonceSource});var Ls=d((PO,Al)=>{Al.exports=Sl()});var Kn=d(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});var Cr=class{static stringify(t){return!t||Object.keys(t).length===0?"":new Cr().putAll(t).stringify()}constructor(){this.processedQuery=new URLSearchParams}putAll(t){return Object.entries(t).forEach(([r,n])=>this.put(r,n)),this}put(t,r){Array.isArray(r)?this.putArray(t,r):r?.constructor===Object?this.putObject(t,r):this.putSimple(t,r)}putArray(t,r){r.forEach(n=>this.processedQuery.append(`${t}[]`,`${n}`))}putObject(t,r){Object.entries(r).forEach(([n,o])=>{this.processedQuery.append(`${t}[${n}]`,`${o}`)})}putSimple(t,r){this.processedQuery.append(t,`${r}`)}stringify(t=!1){let r=this.processedQuery.toString();return t?r:`?${r}`}};Ds.default=Cr});var $t=d(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.DataType=void 0;var hv;(function(e){e.JSON="application/json",e.GraphQL="application/graphql",e.URLEncoded="application/x-www-form-urlencoded"})(hv=Pr.DataType||(Pr.DataType={}))});var At=d(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.httpClientClass=Lt.HttpClient=void 0;var Fe=(x(),R(T)),Ze=Ls(),et=Fe.__importStar(U()),mv=_e(),yv=Ar(),gv=Fe.__importDefault(Kn()),vv=_t(),wv=vt(),Nt=We(),bv=Tn(),Rl=de(),Wn=$t(),tt=class{constructor(t){this.loggedDeprecations={},this.domain=t.domain}get(t){return Fe.__awaiter(this,void 0,void 0,function*(){return this.request(Object.assign({method:Ze.Method.Get},t))})}post(t){return Fe.__awaiter(this,void 0,void 0,function*(){return this.request(Object.assign({method:Ze.Method.Post},t))})}put(t){return Fe.__awaiter(this,void 0,void 0,function*(){return this.request(Object.assign({method:Ze.Method.Put},t))})}delete(t){return Fe.__awaiter(this,void 0,void 0,function*(){return this.request(Object.assign({method:Ze.Method.Delete},t))})}request(t){var r;return Fe.__awaiter(this,void 0,void 0,function*(){let n=t.tries?t.tries:1;if(n<=0)throw new et.HttpRequestError(`Number of tries must be >= 0, got ${n}`);let o=`${mv.LIBRARY_NAME} v${yv.SHOPIFY_API_LIBRARY_VERSION} | ${(0,bv.abstractRuntimeString)()}`;this.httpClass().config.userAgentPrefix&&(o=`${this.httpClass().config.userAgentPrefix} | ${o}`),t.extraHeaders&&(t.extraHeaders["user-agent"]?(o=`${t.extraHeaders["user-agent"]} | ${o}`,delete t.extraHeaders["user-agent"]):t.extraHeaders["User-Agent"]&&(o=`${t.extraHeaders["User-Agent"]} | ${o}`));let i=Object.assign(Object.assign({},t.extraHeaders),{"User-Agent":o}),s;if(t.method===Ze.Method.Post||t.method===Ze.Method.Put){let p=(r=t.type)!==null&&r!==void 0?r:Wn.DataType.JSON,h=t.data;if(h){switch(p){case Wn.DataType.JSON:s=typeof h=="string"?h:JSON.stringify(h);break;case Wn.DataType.URLEncoded:s=typeof h=="string"?h:new URLSearchParams(h).toString();break;case Wn.DataType.GraphQL:s=h;break}i=Object.assign(Object.assign({},i),{"Content-Type":p,"Content-Length":new TextEncoder().encode(s).length})}}let a=`${this.httpClass().scheme}://${this.domain}${this.getRequestPath(t.path)}${gv.default.stringify(t.query)}`,c={method:t.method,url:a,headers:(0,Nt.canonicalizeHeaders)(i),body:s};if(this.httpClass().config.logger.httpRequests){let p=["Making HTTP request",`${c.method} ${c.url}`,`Headers: ${JSON.stringify(i)}`];s&&p.push(`Body: ${JSON.stringify(s).replace(/\n/g,"\\n  ")}`),(0,Rl.logger)(this.httpClass().config).debug(p.join("  -  "))}function u(p){return Fe.__awaiter(this,void 0,void 0,function*(){return new Promise(h=>setTimeout(h,p))})}let l=0;for(;l<n;)try{return yield this.doRequest(c)}catch(p){if(l++,p instanceof et.HttpRetriableError){if(l<n){let h=this.httpClass().RETRY_WAIT_TIME;p instanceof et.HttpThrottlingError&&p.response.retryAfter&&(h=p.response.retryAfter*1e3),yield u(h);continue}if(n>1)throw new et.HttpMaxRetriesError(`Exceeded maximum retry count of ${n}. Last message: ${p.message}`)}throw p}throw new et.ShopifyError("Unexpected flow, reached maximum HTTP tries but did not throw an error")})}getRequestPath(t){return`/${t.replace(/^\//,"")}`}httpClass(){return this.constructor}throwFailedRequest(t,r){let n=[];t.errors&&n.push(JSON.stringify(t.errors,null,2));let o=(0,Nt.getHeader)(r.headers,"x-request-id");o&&n.push(`If you report this error, please include this id: ${o}`);let i=n.length?`:
${n.join(`
`)}`:"",s=r.headers?r.headers:{},a=r.statusCode,c=r.statusText;switch(!0){case r.statusCode===Ze.StatusCode.TooManyRequests:{let u=(0,Nt.getHeader)(r.headers,"Retry-After");throw new et.HttpThrottlingError({message:`Shopify is throttling requests${i}`,code:a,statusText:c,body:t,headers:s,retryAfter:u?parseFloat(u):void 0})}case r.statusCode>=Ze.StatusCode.InternalServerError:throw new et.HttpInternalError({message:`Shopify internal error${i}`,code:a,statusText:c,body:t,headers:s});default:throw new et.HttpResponseError({message:`Received an error response (${r.statusCode} ${r.statusText}) from Shopify${i}`,code:a,statusText:c,body:t,headers:s})}}doRequest(t){var r;return Fe.__awaiter(this,void 0,void 0,function*(){let n=(0,Rl.logger)(this.httpClass().config),o=yield(0,Nt.abstractFetch)(t);this.httpClass().config.logger.httpRequests&&n.debug(`Completed HTTP request, received ${o.statusCode} ${o.statusText}`);let i={};if(o.body)try{i=JSON.parse(o.body)}catch{i=o.body}(0,Nt.isOK)(o)||this.throwFailedRequest(i,o);let s=(0,Nt.getHeader)(o.headers,"X-Shopify-API-Deprecated-Reason");if(s){let a={message:s,path:t.url};t.body&&(a.body=`${t.body.substring(0,100)}...`);let c=yield(0,vv.createSHA256HMAC)(this.httpClass().config.apiSecretKey,JSON.stringify(a),wv.HashFormat.Hex);if(!Object.keys(this.loggedDeprecations).includes(c)||Date.now()-this.loggedDeprecations[c]>=tt.DEPRECATION_ALERT_DELAY){this.loggedDeprecations[c]=Date.now();let u=new Error().stack,l=`API Deprecation Notice ${new Date().toLocaleString()} : ${JSON.stringify(a)}  -  Stack Trace: ${u}`;yield n.warning(l)}}return{body:i,headers:(r=o.headers)!==null&&r!==void 0?r:{}}})}};Lt.HttpClient=tt;tt.RETRY_WAIT_TIME=1e3;tt.DEPRECATION_ALERT_DELAY=3e5;function _v(e,t="https"){class r extends tt{}return r.config=e,r.scheme=t,Reflect.defineProperty(r,"name",{value:"HttpClient"}),r}Lt.httpClientClass=_v});var Pl=d(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.restClientClass=Dt.RestClient=void 0;var Cl=(x(),R(T)),Ev=We(),Sv=_e(),Av=Cl.__importStar(U()),Rv=At(),Cv=de(),je=class extends Rv.HttpClient{constructor(t){super({domain:t.session.shop});let r=this.restClass().config;if(!r.isCustomStoreApp&&!t.session.accessToken)throw new Av.MissingRequiredArgument("Missing access token when creating REST client");if(t.apiVersion){let n=t.apiVersion===r.apiVersion?`REST client has a redundant API version override to the default ${t.apiVersion}`:`REST client overriding default API version ${r.apiVersion} with ${t.apiVersion}`;(0,Cv.logger)(r).debug(n)}this.session=t.session,this.apiVersion=t.apiVersion}request(t){let r=Object.create(null,{request:{get:()=>super.request}});var n,o,i;return Cl.__awaiter(this,void 0,void 0,function*(){let s=(n=this.restClass().config.adminApiAccessToken)!==null&&n!==void 0?n:this.restClass().config.apiSecretKey;t.extraHeaders=Object.assign({[Sv.ShopifyHeader.AccessToken]:this.restClass().config.isCustomStoreApp?s:this.session.accessToken},t.extraHeaders);let a=yield r.request.call(this,t),c=(0,Ev.getHeader)(a.headers,"link");if(c!==void 0){let u={limit:!((o=t.query)===null||o===void 0)&&o.limit?(i=t.query)===null||i===void 0?void 0:i.limit.toString():je.DEFAULT_LIMIT};if(c){let l=c.split(", ");for(let p of l){let h=p.match(je.LINK_HEADER_REGEXP);if(!h)continue;let f=h[2],w=new URL(h[1]),S=w.searchParams.get("fields"),k=w.searchParams.get("page_info");if(!u.fields&&S&&(u.fields=S.split(",")),k)switch(f){case"previous":u.previousPageUrl=h[1],u.prevPage=this.buildRequestParams(h[1]);break;case"next":u.nextPageUrl=h[1],u.nextPage=this.buildRequestParams(h[1]);break}}}a.pageInfo=u}return a})}getRequestPath(t){let r=super.getRequestPath(t);return r.startsWith("/admin")?`${r.replace(/\.json$/,"")}.json`:`/admin/api/${this.apiVersion||this.restClass().config.apiVersion}${r.replace(/\.json$/,"")}.json`}restClass(){return this.constructor}buildRequestParams(t){let r="^/admin/api/[^/]+/(.*).json$",n=new URL(t);return{path:n.pathname.replace(new RegExp(r),"$1"),query:Object.fromEntries(n.searchParams.entries())}}};Dt.RestClient=je;je.LINK_HEADER_REGEXP=/<([^<]+)>; rel="([^"]+)"/;je.DEFAULT_LIMIT="50";function Pv(e){let{config:t}=e;class r extends je{}return r.config=t,r.scheme="https",Reflect.defineProperty(r,"name",{value:"RestClient"}),r}Dt.restClientClass=Pv});var Be=d(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.graphqlClientClass=Ut.GraphqlClient=void 0;var Tl=(x(),R(T)),Ov=_e(),Tv=At(),Ol=$t(),xv=de(),Fn=Tl.__importStar(U()),jn=class{constructor(t){this.baseApiPath="/admin/api";let r=this.graphqlClass().config;if(!r.isCustomStoreApp&&!t.session.accessToken)throw new Fn.MissingRequiredArgument("Missing access token when creating GraphQL client");if(t.apiVersion){let n=t.apiVersion===r.apiVersion?`GraphQL client has a redundant API version override to the default ${t.apiVersion}`:`GraphQL client overriding default API version ${r.apiVersion} with ${t.apiVersion}`;(0,xv.logger)(r).debug(n)}this.session=t.session,this.apiVersion=t.apiVersion,this.client=new(this.graphqlClass()).HttpClient({domain:this.session.shop})}query(t){var r,n;return Tl.__awaiter(this,void 0,void 0,function*(){if(typeof t.data=="string"&&t.data.length===0||Object.entries(t.data).length===0)throw new Fn.MissingRequiredArgument("Query missing.");let o=this.getApiHeaders();t.extraHeaders=Object.assign(Object.assign({},o),t.extraHeaders);let i=`${this.baseApiPath}/${this.apiVersion||this.graphqlClass().config.apiVersion}/graphql.json`,s;typeof t.data=="object"?s=Ol.DataType.JSON:s=Ol.DataType.GraphQL;let a=yield this.client.post(Object.assign({path:i,type:s},t)),c=a.body.errors;if(c?.length>0)throw new Fn.GraphqlQueryError({message:(n=(r=c[0])===null||r===void 0?void 0:r.message)!==null&&n!==void 0?n:"GraphQL query returned errors",response:a.body,headers:a.headers});return a})}getApiHeaders(){let{config:t}=this.graphqlClass(),r;if(t.isCustomStoreApp)r=t.adminApiAccessToken;else if(r=this.session.accessToken,!r)throw new Fn.MissingRequiredArgument("Session missing access token.");return{[Ov.ShopifyHeader.AccessToken]:r}}graphqlClass(){return this.constructor}};Ut.GraphqlClient=jn;function Iv(e){let{config:t}=e,{HttpClient:r}=e;r||(r=(0,Tv.httpClientClass)(e.config));class n extends jn{}return n.config=t,n.HttpClient=r,Reflect.defineProperty(n,"name",{value:"GraphqlClient"}),n}Ut.graphqlClientClass=Iv});var Il=d(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.storefrontClientClass=Kt.StorefrontClient=void 0;var qv=Ar(),Bn=_e(),Hv=At(),kv=de(),xl=U(),Mv=Be(),Jn=class extends Mv.GraphqlClient{constructor(t){super({session:t.session,apiVersion:t.apiVersion}),this.baseApiPath="/api";let r=this.storefrontClass().config;if(t.apiVersion){let n=t.apiVersion===r.apiVersion?`Storefront client has a redundant API version override to the default ${t.apiVersion}`:`Storefront client overriding default API version ${r.apiVersion} with ${t.apiVersion}`;(0,kv.logger)(r).debug(n)}}getApiHeaders(){let t=this.storefrontClass().config,r;if(t.isCustomStoreApp){if(r=t.privateAppStorefrontAccessToken,!r)throw new xl.MissingRequiredArgument("Custom store apps must set the privateAppStorefrontAccessToken property to call the Storefront API.")}else if(r=this.session.accessToken,!r)throw new xl.MissingRequiredArgument("Session missing access token.");let n=Bn.LIBRARY_NAME.toLowerCase().split(" ").join("-");return{[Bn.ShopifyHeader.StorefrontPrivateToken]:r,[Bn.ShopifyHeader.StorefrontSDKVariant]:n,[Bn.ShopifyHeader.StorefrontSDKVersion]:qv.SHOPIFY_API_LIBRARY_VERSION}}storefrontClass(){return this.constructor}};Kt.StorefrontClient=Jn;function $v(e){let{config:t}=e,{HttpClient:r}=e;r||(r=(0,Hv.httpClientClass)(t));class n extends Jn{}return n.config=t,n.HttpClient=r,Reflect.defineProperty(n,"name",{value:"StorefrontClient"}),n}Kt.storefrontClientClass=$v});var Hl=d(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.graphqlProxy=void 0;var ql=(x(),R(T)),Nv=ql.__importStar(U()),Lv=Be();function Dv(e){return({session:t,rawBody:r})=>ql.__awaiter(this,void 0,void 0,function*(){if(!t.accessToken)throw new Nv.InvalidSession("Cannot proxy query. Session not authenticated.");let n=(0,Lv.graphqlClientClass)({config:e});return new n({session:t}).query({data:r})})}Vn.graphqlProxy=Dv});var kl=d(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.clientClasses=void 0;var Uv=At(),Kv=Pl(),Wv=Be(),Fv=Il(),jv=Hl();function Bv(e){let t=(0,Uv.httpClientClass)(e);return{Rest:(0,Kv.restClientClass)({config:e}),Graphql:(0,Wv.graphqlClientClass)({config:e,HttpClient:t}),Storefront:(0,Fv.storefrontClientClass)({config:e,HttpClient:t}),graphqlProxy:(0,jv.graphqlProxy)(e)}}Gn.clientClasses=Bv});var zn=d(($O,Gl)=>{function Jv(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(l){u=!0,o=l}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}function Vv(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ml(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wl(n.key),n)}}function Gv(e,t,r){return t&&Ml(e.prototype,t),r&&Ml(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function $l(e,t,r){return t=Wl(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kl(e,t){return Xv(e)||Jv(e,t)||zv(e,t)||Yv()}function Xv(e){if(Array.isArray(e))return e}function zv(e,t){if(e){if(typeof e=="string")return Nl(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nl(e,t)}}function Nl(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Yv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qv(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Wl(e){var t=Qv(e,"string");return typeof t=="symbol"?t:String(t)}function Je(e,t){var r=jl(e,t,"get");return Zv(e,r)}function Fl(e,t,r){var n=jl(e,t,"set");return ew(e,n,r),r}function jl(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function Zv(e,t){return t.get?t.get.call(e):t.value}function ew(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}function Or(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function Bl(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ll(e,t,r){Bl(e,t),t.set(e,r)}function Dl(e,t){Bl(e,t),t.add(e)}var Jl=[" daum[ /]"," deusu/"," yadirectfetcher","(?:^| )site","(?:^|[^g])news","@[a-z]","\\(at\\)[a-z]","\\(github\\.com/","\\[at\\][a-z]","^12345","^<","^[\\w \\.\\-\\(\\)]+(/v?\\d+(\\.\\d+)?(\\.\\d{1,10})?)?$","^[^ ]{50,}$","^active","^ad muncher","^amaya","^anglesharp/","^anonymous","^avsdevicesdk/","^axios/","^bidtellect/","^biglotron","^btwebclient/","^castro","^clamav[ /]","^client/","^cobweb/","^coccoc","^custom","^ddg[_-]android","^discourse","^dispatch/\\d","^downcast/","^duckduckgo","^facebook","^fdm[ /]\\d","^getright/","^gozilla/","^hatena","^hobbit","^hotzonu","^hwcdn/","^jeode/","^jetty/","^jigsaw","^linkdex","^lwp[-: ]","^metauri","^microsoft bits","^movabletype","^mozilla/\\d\\.\\d \\(compatible;?\\)$","^mozilla/\\d\\.\\d \\w*$","^navermailapp","^netsurf","^offline explorer","^php","^postman","^postrank","^python","^read","^reed","^restsharp/","^snapchat","^space bison","^svn","^swcd ","^taringa","^test certificate info","^thumbor/","^tumblr/","^user-agent:mozilla","^valid","^venus/fedoraplanet","^w3c","^webbandit/","^webcopier","^wget","^whatsapp","^xenu link sleuth","^yahoo","^yandex","^zdm/\\d","^zoom marketplace/","^{{.*}}$","adbeat\\.com","appinsights","archive","ask jeeves/teoma","bit\\.ly/","bluecoat drtr","bot","browsex","burpcollaborator","capture","catch","check","chrome-lighthouse","chromeframe","cloud","crawl","cryptoapi","dareboost","datanyze","dataprovider","dejaclick","dmbrowser","download","evc-batch/","feed","firephp","freesafeip","gomezagent","google","headlesschrome/","http","httrack","hubspot marketing grader","hydra","ibisbrowser","images","inspect","iplabel","ips-agent","java","library","mail\\.ru/","manager","monitor","morningscore/","neustar wpm","nutch","offbyone","optimize","pageburst","pagespeed","perl","phantom","pingdom","powermarks","preview","proxy","ptst[ /]\\d","reader","rexx;","rigor","rss","scan","scrape","search","serp ?reputation ?management","server","sogou","sparkler/","speedcurve","spider","splash","statuscake","stumbleupon\\.com","supercleaner","synapse","synthetic","torrent","tracemyfile","transcoder","trendsmapresolver","twingly recon","url","virtuoso","wappalyzer","webglance","webkit2png","websitemetadataretriever","whatcms/","wordpress","zgrab"];function tw(e){try{new RegExp("(?<! cu)bot").test("dangerbot")}catch{return e}return[["bot","(?<! cu)bot"],["google","(?<! (?:channel/|google/))google(?!(app|/google| pixel))"],["http","(?<!(?:lib))http"],["java","java(?!;)"],["search","(?<! ya(?:yandex)?)search"]].forEach(function(t){var r=Kl(t,2),n=r[0],o=r[1],i=e.lastIndexOf(n);~i&&e.splice(i,1,o)}),e}tw(Jl);var Vl="i",rt=new WeakMap,Tr=new WeakMap,Xn=new WeakSet,Us=new WeakSet,rw=function(){function e(t){var r=this;Vv(this,e),Dl(this,Us),Dl(this,Xn),Ll(this,rt,{writable:!0,value:void 0}),Ll(this,Tr,{writable:!0,value:void 0}),Fl(this,rt,t||Jl.slice()),Or(this,Xn,Ks).call(this);var n=function(i){return r.test(i)};return Object.defineProperties(n,Object.entries(Object.getOwnPropertyDescriptors(e.prototype)).reduce(function(o,i){var s=Kl(i,2),a=s[0],c=s[1];return typeof c.value=="function"&&Object.assign(o,$l({},a,{value:r[a].bind(r)})),typeof c.get=="function"&&Object.assign(o,$l({},a,{get:function(){return r[a]}})),o},{}))}return Gv(e,[{key:"pattern",get:function(){return new RegExp(Je(this,Tr))}},{key:"test",value:function(r){return Boolean(r)&&Je(this,Tr).test(r)}},{key:"find",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=r.match(Je(this,Tr));return n&&n[0]}},{key:"matches",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Je(this,rt).filter(function(n){return new RegExp(n,Vl).test(r)})}},{key:"clear",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this.exclude(this.matches(r))}},{key:"extend",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];[].push.apply(Je(this,rt),n.filter(function(o){return Or(r,Us,Ul).call(r,o)===-1}).map(function(o){return o.toLowerCase()})),Or(this,Xn,Ks).call(this)}},{key:"exclude",value:function(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=r.length;n--;){var o=Or(this,Us,Ul).call(this,r[n]);o>-1&&Je(this,rt).splice(o,1)}Or(this,Xn,Ks).call(this)}},{key:"spawn",value:function(r){return new e(r||Je(this,rt))}}]),e}();function Ks(){Fl(this,Tr,new RegExp(Je(this,rt).join("|"),Vl))}function Ul(e){return Je(this,rt).indexOf(e.toLowerCase())}var nw=new rw;Gl.exports=nw});var xr=d(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.safeCompare=void 0;var ow=(x(),R(T)),iw=ow.__importStar(U()),sw=(e,t)=>{if(typeof e==typeof t){let r=new TextEncoder,n=r.encode(JSON.stringify(e)),o=r.encode(JSON.stringify(t));if(n.length===o.length)return aw(n,o)}else throw new iw.SafeCompareError(`Mismatched data types provided: ${typeof e} and ${typeof t}`);return!1};Yn.safeCompare=sw;function aw(e,t){let r=new Uint8Array(e),n=new Uint8Array(t),o=0;for(let i=0;i<r.length;i++)o|=r[i]^n[i];return o===0}});var Fs=d(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.getCurrentTimeInSec=nt.validateHmac=nt.generateLocalHmac=void 0;var Ir=(x(),R(T)),cw=_t(),uw=vt(),Ws=Ir.__importStar(U()),lw=xr(),dw=Ir.__importDefault(Kn()),pw=90;function fw(e){let t=new dw.default;return Object.keys(e).sort((r,n)=>r.localeCompare(n)).forEach(r=>t.put(r,e[r])),t.stringify(!0)}function hw(e){return Object.entries(e).sort(([t],[r])=>t.localeCompare(r)).reduce((t,[r,n])=>`${t}${r}=${Array.isArray(n)?n.join(","):n}`,"")}function Xl(e){return(t,r="admin")=>Ir.__awaiter(this,void 0,void 0,function*(){let{hmac:n,signature:o}=t,i=Ir.__rest(t,["hmac","signature"]),s=r==="admin"?fw(i):hw(i);return(0,cw.createSHA256HMAC)(e.apiSecretKey,s,uw.HashFormat.Hex)})}nt.generateLocalHmac=Xl;function mw(e){return(t,{signator:r}={signator:"admin"})=>Ir.__awaiter(this,void 0,void 0,function*(){if(r==="admin"&&!t.hmac)throw new Ws.InvalidHmacError("Query does not contain an HMAC value.");if(r==="appProxy"&&!t.signature)throw new Ws.InvalidHmacError("Query does not contain a signature value.");yw(t);let n=r==="appProxy"?t.signature:t.hmac,o=yield Xl(e)(t,r);return(0,lw.safeCompare)(n,o)})}nt.validateHmac=mw;function zl(){return Math.trunc(Date.now()/1e3)}nt.getCurrentTimeInSec=zl;function yw(e){if(Math.abs(zl()-Number(e.timestamp))>pw)throw new Ws.InvalidHmacError("HMAC timestamp is outside of the tolerance range")}});var js=d(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.decodeHost=void 0;function gw(e){return atob(e)}Qn.decodeHost=gw});var Ft=d(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.sanitizeHost=Wt.sanitizeShop=void 0;var Yl=U(),vw=js();function ww(e){return(t,r=!1)=>{let n=["myshopify\\.com","shopify\\.com","myshopify\\.io"];e.customShopDomains&&n.push(...e.customShopDomains.map(s=>typeof s=="string"?s:s.source));let i=new RegExp(`^[a-zA-Z0-9][a-zA-Z0-9-_]*\\.(${n.join("|")})[/]*$`).test(t)?t:null;if(!i&&r)throw new Yl.InvalidShopError("Received invalid shop argument");return i}}Wt.sanitizeShop=ww;function bw(){return(e,t=!1)=>{let n=/^[0-9a-zA-Z+/]+={0,2}$/.test(e)?e:null;if(n){let{hostname:o}=new URL(`https://${(0,vw.decodeHost)(n)}`),i=["myshopify\\.com","shopify\\.com","myshopify\\.io","spin\\.dev"];new RegExp(`\\.(${i.join("|")})$`).test(o)||(n=null)}if(!n&&t)throw new Yl.InvalidHostError("Received invalid host argument");return n}}Wt.sanitizeHost=bw});var Zn=d(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.STATE_COOKIE_NAME=jt.SESSION_COOKIE_NAME=void 0;jt.SESSION_COOKIE_NAME="shopify_app_session";jt.STATE_COOKIE_NAME="shopify_app_state"});var Js=d(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.nonce=void 0;var Bs=_t();function _w(){return(Bs.crypto.getRandomValues?Bs.crypto.getRandomValues(new Uint8Array(15)):Bs.crypto.randomBytes(15)).map(n=>n%10).join("")}eo.nonce=_w});var Gs=d(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.default=Sw;var to,Ew=new Uint8Array(16);function Sw(){if(!to&&(to=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!to))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return to(Ew)}});var Ql=d(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.default=void 0;var Aw=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ro.default=Aw});var qr=d(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.default=void 0;var Rw=Cw(Ql());function Cw(e){return e&&e.__esModule?e:{default:e}}function Pw(e){return typeof e=="string"&&Rw.default.test(e)}var Ow=Pw;no.default=Ow});var kr=d(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.default=void 0;Hr.unsafeStringify=Zl;var Tw=xw(qr());function xw(e){return e&&e.__esModule?e:{default:e}}var Y=[];for(let e=0;e<256;++e)Y.push((e+256).toString(16).slice(1));function Zl(e,t=0){return Y[e[t+0]]+Y[e[t+1]]+Y[e[t+2]]+Y[e[t+3]]+"-"+Y[e[t+4]]+Y[e[t+5]]+"-"+Y[e[t+6]]+Y[e[t+7]]+"-"+Y[e[t+8]]+Y[e[t+9]]+"-"+Y[e[t+10]]+Y[e[t+11]]+Y[e[t+12]]+Y[e[t+13]]+Y[e[t+14]]+Y[e[t+15]]}function Iw(e,t=0){let r=Zl(e,t);if(!(0,Tw.default)(r))throw TypeError("Stringified UUID is invalid");return r}var qw=Iw;Hr.default=qw});var td=d(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.default=void 0;var Hw=Mw(Gs()),kw=kr();function Mw(e){return e&&e.__esModule?e:{default:e}}var ed,Xs,zs=0,Ys=0;function $w(e,t,r){let n=t&&r||0,o=t||new Array(16);e=e||{};let i=e.node||ed,s=e.clockseq!==void 0?e.clockseq:Xs;if(i==null||s==null){let h=e.random||(e.rng||Hw.default)();i==null&&(i=ed=[h[0]|1,h[1],h[2],h[3],h[4],h[5]]),s==null&&(s=Xs=(h[6]<<8|h[7])&16383)}let a=e.msecs!==void 0?e.msecs:Date.now(),c=e.nsecs!==void 0?e.nsecs:Ys+1,u=a-zs+(c-Ys)/1e4;if(u<0&&e.clockseq===void 0&&(s=s+1&16383),(u<0||a>zs)&&e.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");zs=a,Ys=c,Xs=s,a+=122192928e5;let l=((a&268435455)*1e4+c)%4294967296;o[n++]=l>>>24&255,o[n++]=l>>>16&255,o[n++]=l>>>8&255,o[n++]=l&255;let p=a/4294967296*1e4&268435455;o[n++]=p>>>8&255,o[n++]=p&255,o[n++]=p>>>24&15|16,o[n++]=p>>>16&255,o[n++]=s>>>8|128,o[n++]=s&255;for(let h=0;h<6;++h)o[n+h]=i[h];return t||(0,kw.unsafeStringify)(o)}var Nw=$w;oo.default=Nw});var Qs=d(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.default=void 0;var Lw=Dw(qr());function Dw(e){return e&&e.__esModule?e:{default:e}}function Uw(e){if(!(0,Lw.default)(e))throw TypeError("Invalid UUID");let t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=t&255,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=t&255,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=t&255,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=t&255,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=t&255,r}var Kw=Uw;io.default=Kw});var Zs=d(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.URL=Rt.DNS=void 0;Rt.default=Jw;var Ww=kr(),Fw=jw(Qs());function jw(e){return e&&e.__esModule?e:{default:e}}function Bw(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var rd="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Rt.DNS=rd;var nd="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Rt.URL=nd;function Jw(e,t,r){function n(o,i,s,a){var c;if(typeof o=="string"&&(o=Bw(o)),typeof i=="string"&&(i=(0,Fw.default)(i)),((c=i)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+o.length);if(u.set(i),u.set(o,i.length),u=r(u),u[6]=u[6]&15|t,u[8]=u[8]&63|128,s){a=a||0;for(let l=0;l<16;++l)s[a+l]=u[l];return s}return(0,Ww.unsafeStringify)(u)}try{n.name=e}catch{}return n.DNS=rd,n.URL=nd,n}});var id=d(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.default=void 0;function Vw(e){if(typeof e=="string"){let t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return Gw(Xw(zw(e),e.length*8))}function Gw(e){let t=[],r=e.length*32,n="0123456789abcdef";for(let o=0;o<r;o+=8){let i=e[o>>5]>>>o%32&255,s=parseInt(n.charAt(i>>>4&15)+n.charAt(i&15),16);t.push(s)}return t}function od(e){return(e+64>>>9<<4)+14+1}function Xw(e,t){e[t>>5]|=128<<t%32,e[od(t)-1]=t;let r=1732584193,n=-271733879,o=-1732584194,i=271733878;for(let s=0;s<e.length;s+=16){let a=r,c=n,u=o,l=i;r=oe(r,n,o,i,e[s],7,-680876936),i=oe(i,r,n,o,e[s+1],12,-389564586),o=oe(o,i,r,n,e[s+2],17,606105819),n=oe(n,o,i,r,e[s+3],22,-1044525330),r=oe(r,n,o,i,e[s+4],7,-176418897),i=oe(i,r,n,o,e[s+5],12,1200080426),o=oe(o,i,r,n,e[s+6],17,-1473231341),n=oe(n,o,i,r,e[s+7],22,-45705983),r=oe(r,n,o,i,e[s+8],7,1770035416),i=oe(i,r,n,o,e[s+9],12,-1958414417),o=oe(o,i,r,n,e[s+10],17,-42063),n=oe(n,o,i,r,e[s+11],22,-1990404162),r=oe(r,n,o,i,e[s+12],7,1804603682),i=oe(i,r,n,o,e[s+13],12,-40341101),o=oe(o,i,r,n,e[s+14],17,-1502002290),n=oe(n,o,i,r,e[s+15],22,1236535329),r=ie(r,n,o,i,e[s+1],5,-165796510),i=ie(i,r,n,o,e[s+6],9,-1069501632),o=ie(o,i,r,n,e[s+11],14,643717713),n=ie(n,o,i,r,e[s],20,-373897302),r=ie(r,n,o,i,e[s+5],5,-701558691),i=ie(i,r,n,o,e[s+10],9,38016083),o=ie(o,i,r,n,e[s+15],14,-660478335),n=ie(n,o,i,r,e[s+4],20,-405537848),r=ie(r,n,o,i,e[s+9],5,568446438),i=ie(i,r,n,o,e[s+14],9,-1019803690),o=ie(o,i,r,n,e[s+3],14,-187363961),n=ie(n,o,i,r,e[s+8],20,1163531501),r=ie(r,n,o,i,e[s+13],5,-1444681467),i=ie(i,r,n,o,e[s+2],9,-51403784),o=ie(o,i,r,n,e[s+7],14,1735328473),n=ie(n,o,i,r,e[s+12],20,-1926607734),r=se(r,n,o,i,e[s+5],4,-378558),i=se(i,r,n,o,e[s+8],11,-2022574463),o=se(o,i,r,n,e[s+11],16,1839030562),n=se(n,o,i,r,e[s+14],23,-35309556),r=se(r,n,o,i,e[s+1],4,-1530992060),i=se(i,r,n,o,e[s+4],11,1272893353),o=se(o,i,r,n,e[s+7],16,-155497632),n=se(n,o,i,r,e[s+10],23,-1094730640),r=se(r,n,o,i,e[s+13],4,681279174),i=se(i,r,n,o,e[s],11,-358537222),o=se(o,i,r,n,e[s+3],16,-722521979),n=se(n,o,i,r,e[s+6],23,76029189),r=se(r,n,o,i,e[s+9],4,-640364487),i=se(i,r,n,o,e[s+12],11,-421815835),o=se(o,i,r,n,e[s+15],16,530742520),n=se(n,o,i,r,e[s+2],23,-995338651),r=ae(r,n,o,i,e[s],6,-198630844),i=ae(i,r,n,o,e[s+7],10,1126891415),o=ae(o,i,r,n,e[s+14],15,-1416354905),n=ae(n,o,i,r,e[s+5],21,-57434055),r=ae(r,n,o,i,e[s+12],6,1700485571),i=ae(i,r,n,o,e[s+3],10,-1894986606),o=ae(o,i,r,n,e[s+10],15,-1051523),n=ae(n,o,i,r,e[s+1],21,-2054922799),r=ae(r,n,o,i,e[s+8],6,1873313359),i=ae(i,r,n,o,e[s+15],10,-30611744),o=ae(o,i,r,n,e[s+6],15,-1560198380),n=ae(n,o,i,r,e[s+13],21,1309151649),r=ae(r,n,o,i,e[s+4],6,-145523070),i=ae(i,r,n,o,e[s+11],10,-1120210379),o=ae(o,i,r,n,e[s+2],15,718787259),n=ae(n,o,i,r,e[s+9],21,-343485551),r=ot(r,a),n=ot(n,c),o=ot(o,u),i=ot(i,l)}return[r,n,o,i]}function zw(e){if(e.length===0)return[];let t=e.length*8,r=new Uint32Array(od(t));for(let n=0;n<t;n+=8)r[n>>5]|=(e[n/8]&255)<<n%32;return r}function ot(e,t){let r=(e&65535)+(t&65535);return(e>>16)+(t>>16)+(r>>16)<<16|r&65535}function Yw(e,t){return e<<t|e>>>32-t}function so(e,t,r,n,o,i){return ot(Yw(ot(ot(t,e),ot(n,i)),o),r)}function oe(e,t,r,n,o,i,s){return so(t&r|~t&n,e,t,o,i,s)}function ie(e,t,r,n,o,i,s){return so(t&n|r&~n,e,t,o,i,s)}function se(e,t,r,n,o,i,s){return so(t^r^n,e,t,o,i,s)}function ae(e,t,r,n,o,i,s){return so(r^(t|~n),e,t,o,i,s)}var Qw=Vw;ao.default=Qw});var ad=d(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.default=void 0;var Zw=sd(Zs()),eb=sd(id());function sd(e){return e&&e.__esModule?e:{default:e}}var tb=(0,Zw.default)("v3",48,eb.default),rb=tb;co.default=rb});var cd=d(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.default=void 0;var nb=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ob={randomUUID:nb};uo.default=ob});var dd=d(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.default=void 0;var ud=ld(cd()),ib=ld(Gs()),sb=kr();function ld(e){return e&&e.__esModule?e:{default:e}}function ab(e,t,r){if(ud.default.randomUUID&&!t&&!e)return ud.default.randomUUID();e=e||{};let n=e.random||(e.rng||ib.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let o=0;o<16;++o)t[r+o]=n[o];return t}return(0,sb.unsafeStringify)(n)}var cb=ab;lo.default=cb});var pd=d(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.default=void 0;function ub(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function ea(e,t){return e<<t|e>>>32-t}function lb(e){let t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){let s=unescape(encodeURIComponent(e));e=[];for(let a=0;a<s.length;++a)e.push(s.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let n=e.length/4+2,o=Math.ceil(n/16),i=new Array(o);for(let s=0;s<o;++s){let a=new Uint32Array(16);for(let c=0;c<16;++c)a[c]=e[s*64+c*4]<<24|e[s*64+c*4+1]<<16|e[s*64+c*4+2]<<8|e[s*64+c*4+3];i[s]=a}i[o-1][14]=(e.length-1)*8/Math.pow(2,32),i[o-1][14]=Math.floor(i[o-1][14]),i[o-1][15]=(e.length-1)*8&4294967295;for(let s=0;s<o;++s){let a=new Uint32Array(80);for(let f=0;f<16;++f)a[f]=i[s][f];for(let f=16;f<80;++f)a[f]=ea(a[f-3]^a[f-8]^a[f-14]^a[f-16],1);let c=r[0],u=r[1],l=r[2],p=r[3],h=r[4];for(let f=0;f<80;++f){let w=Math.floor(f/20),S=ea(c,5)+ub(w,u,l,p)+h+t[w]+a[f]>>>0;h=p,p=l,l=ea(u,30)>>>0,u=c,c=S}r[0]=r[0]+c>>>0,r[1]=r[1]+u>>>0,r[2]=r[2]+l>>>0,r[3]=r[3]+p>>>0,r[4]=r[4]+h>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var db=lb;po.default=db});var hd=d(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.default=void 0;var pb=fd(Zs()),fb=fd(pd());function fd(e){return e&&e.__esModule?e:{default:e}}var hb=(0,pb.default)("v5",80,fb.default),mb=hb;fo.default=mb});var md=d(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.default=void 0;var yb="00000000-0000-0000-0000-000000000000";ho.default=yb});var yd=d(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});mo.default=void 0;var gb=vb(qr());function vb(e){return e&&e.__esModule?e:{default:e}}function wb(e){if(!(0,gb.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var bb=wb;mo.default=bb});var gd=d(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Object.defineProperty(Oe,"NIL",{enumerable:!0,get:function(){return Rb.default}});Object.defineProperty(Oe,"parse",{enumerable:!0,get:function(){return Tb.default}});Object.defineProperty(Oe,"stringify",{enumerable:!0,get:function(){return Ob.default}});Object.defineProperty(Oe,"v1",{enumerable:!0,get:function(){return _b.default}});Object.defineProperty(Oe,"v3",{enumerable:!0,get:function(){return Eb.default}});Object.defineProperty(Oe,"v4",{enumerable:!0,get:function(){return Sb.default}});Object.defineProperty(Oe,"v5",{enumerable:!0,get:function(){return Ab.default}});Object.defineProperty(Oe,"validate",{enumerable:!0,get:function(){return Pb.default}});Object.defineProperty(Oe,"version",{enumerable:!0,get:function(){return Cb.default}});var _b=Ve(td()),Eb=Ve(ad()),Sb=Ve(dd()),Ab=Ve(hd()),Rb=Ve(md()),Cb=Ve(yd()),Pb=Ve(qr()),Ob=Ve(kr()),Tb=Ve(Qs());function Ve(e){return e&&e.__esModule?e:{default:e}}});var go=d(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.Session=void 0;var xb=U(),vd=$s(),Ib=["id","shop","state","isOnline","scope","accessToken","expires","onlineAccessInfo"],Mr=class{static fromPropertyArray(t){if(!Array.isArray(t))throw new xb.InvalidSession("The parameter is not an array: a Session cannot be created from this object.");let r=Object.fromEntries(t.filter(([n,o])=>o!=null).map(([n,o])=>{switch(n.toLowerCase()){case"isonline":return["isOnline",o];case"accesstoken":return["accessToken",o];case"onlineaccessinfo":return["onlineAccessInfo",o];default:return[n.toLowerCase(),o]}}).map(([n,o])=>{switch(n){case"isOnline":return typeof o=="string"?[n,o.toString().toLowerCase()==="true"]:typeof o=="number"?[n,Boolean(o)]:[n,o];case"scope":return[n,o.toString()];case"expires":return[n,o?new Date(Number(o)):void 0];case"onlineAccessInfo":return[n,{associated_user:{id:Number(o)}}];default:return[n,o]}}));return Object.setPrototypeOf(r,Mr.prototype),r}constructor(t){Object.assign(this,t)}isActive(t){return!this.isScopeChanged(t)&&Boolean(this.accessToken)&&!this.isExpired()}isScopeChanged(t){return!(t instanceof vd.AuthScopes?t:new vd.AuthScopes(t)).equals(this.scope)}isExpired(){return Boolean(this.expires&&this.expires<new Date)}toObject(){let t={id:this.id,shop:this.shop,state:this.state,isOnline:this.isOnline};return this.scope&&(t.scope=this.scope),this.expires&&(t.expires=this.expires),this.accessToken&&(t.accessToken=this.accessToken),this.onlineAccessInfo&&(t.onlineAccessInfo=this.onlineAccessInfo),t}equals(t){if(!t||!(this.id===t.id&&this.shop===t.shop&&this.state===t.state&&this.isOnline===t.isOnline))return!1;let n=this.toPropertyArray();n.sort(([i],[s])=>i<s?-1:1);let o=t.toPropertyArray();return o.sort(([i],[s])=>i<s?-1:1),JSON.stringify(n)===JSON.stringify(o)}toPropertyArray(){return Object.entries(this).filter(([t,r])=>Ib.includes(t)&&r!==void 0&&r!==null).map(([t,r])=>{var n;switch(t){case"expires":return[t,r?r.getTime():void 0];case"onlineAccessInfo":return[t,(n=r?.associated_user)===null||n===void 0?void 0:n.id];default:return[t,r]}})}};yo.Session=Mr});var _,F,Q=m(()=>{_=crypto,F=e=>e instanceof CryptoKey});var qb,vo,ta=m(()=>{Q();qb=async(e,t)=>{let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await _.subtle.digest(r,t))},vo=qb});function Z(...e){let t=e.reduce((o,{length:i})=>o+i,0),r=new Uint8Array(t),n=0;return e.forEach(o=>{r.set(o,n),n+=o.length}),r}function wd(e,t){return Z(M.encode(e),new Uint8Array([0]),t)}function ra(e,t,r){if(t<0||t>=wo)throw new RangeError(`value must be >= 0 and <= ${wo-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,t&255],r)}function bo(e){let t=Math.floor(e/wo),r=e%wo,n=new Uint8Array(8);return ra(n,t,0),ra(n,r,4),n}function _o(e){let t=new Uint8Array(4);return ra(t,e),t}function Eo(e){return Z(_o(e.length),e)}async function bd(e,t,r){let n=Math.ceil((t>>3)/32),o=new Uint8Array(n*32);for(let i=0;i<n;i++){let s=new Uint8Array(4+e.length+r.length);s.set(_o(i+1)),s.set(e,4),s.set(r,4+e.length),o.set(await vo("sha256",s),i*32)}return o.slice(0,t>>3)}var M,j,wo,G=m(()=>{ta();M=new TextEncoder,j=new TextDecoder,wo=2**32});var So,$,na,D,ee=m(()=>{G();So=e=>{let t=e;typeof t=="string"&&(t=M.encode(t));let r=32768,n=[];for(let o=0;o<t.length;o+=r)n.push(String.fromCharCode.apply(null,t.subarray(o,o+r)));return btoa(n.join(""))},$=e=>So(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),na=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r},D=e=>{let t=e;t instanceof Uint8Array&&(t=j.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return na(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}});var ia={};yr(ia,{JOSEAlgNotAllowed:()=>it,JOSEError:()=>J,JOSENotSupported:()=>E,JWEDecompressionFailed:()=>oa,JWEDecryptionFailed:()=>Ge,JWEInvalid:()=>y,JWKInvalid:()=>$r,JWKSInvalid:()=>st,JWKSMultipleMatchingKeys:()=>Nr,JWKSNoMatchingKey:()=>Ct,JWKSTimeout:()=>Lr,JWSInvalid:()=>O,JWSSignatureVerificationFailed:()=>Pt,JWTClaimValidationFailed:()=>z,JWTExpired:()=>Bt,JWTInvalid:()=>V});var J,z,Bt,it,E,Ge,oa,y,O,V,$r,st,Ct,Nr,Lr,Pt,P=m(()=>{J=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(t){var r;super(t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}},z=class extends J{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(t,r="unspecified",n="unspecified"){super(t),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=n}},Bt=class extends J{static get code(){return"ERR_JWT_EXPIRED"}constructor(t,r="unspecified",n="unspecified"){super(t),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=n}},it=class extends J{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},E=class extends J{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Ge=class extends J{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},oa=class extends J{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}},y=class extends J{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},O=class extends J{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},V=class extends J{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},$r=class extends J{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},st=class extends J{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},Ct=class extends J{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Nr=class extends J{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Lr=class extends J{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},Pt=class extends J{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}});var at,Dr=m(()=>{Q();at=_.getRandomValues.bind(_)});function sa(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new E(`Unsupported JWE Algorithm: ${e}`)}}var Ao,Ro=m(()=>{P();Dr();Ao=e=>at(new Uint8Array(sa(e)>>3))});var Hb,Co,aa=m(()=>{P();Ro();Hb=(e,t)=>{if(t.length<<3!==sa(e))throw new y("Invalid Initialization Vector length")},Co=Hb});var kb,Jt,ca=m(()=>{P();kb=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new y(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)},Jt=kb});var Mb,Ed,Sd=m(()=>{Mb=(e,t)=>{if(!(e instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(e.length!==t.length)throw new TypeError("Input buffers must have the same length");let r=e.length,n=0,o=-1;for(;++o<r;)n|=e[o]^t[o];return n===0},Ed=Mb});function te(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function ct(e,t){return e.name===t}function Po(e){return parseInt(e.name.slice(4),10)}function $b(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ad(e,t){if(t.length&&!t.some(r=>e.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let n=t.pop();r+=`one of ${t.join(", ")}, or ${n}.`}else t.length===2?r+=`one of ${t[0]} or ${t[1]}.`:r+=`${t[0]}.`;throw new TypeError(r)}}function Rd(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!ct(e.algorithm,"HMAC"))throw te("HMAC");let n=parseInt(t.slice(2),10);if(Po(e.algorithm.hash)!==n)throw te(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ct(e.algorithm,"RSASSA-PKCS1-v1_5"))throw te("RSASSA-PKCS1-v1_5");let n=parseInt(t.slice(2),10);if(Po(e.algorithm.hash)!==n)throw te(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ct(e.algorithm,"RSA-PSS"))throw te("RSA-PSS");let n=parseInt(t.slice(2),10);if(Po(e.algorithm.hash)!==n)throw te(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(e.algorithm.name!=="Ed25519"&&e.algorithm.name!=="Ed448")throw te("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!ct(e.algorithm,"ECDSA"))throw te("ECDSA");let n=$b(t);if(e.algorithm.namedCurve!==n)throw te(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ad(e,r)}function ge(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!ct(e.algorithm,"AES-GCM"))throw te("AES-GCM");let n=parseInt(t.slice(1,4),10);if(e.algorithm.length!==n)throw te(n,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!ct(e.algorithm,"AES-KW"))throw te("AES-KW");let n=parseInt(t.slice(1,4),10);if(e.algorithm.length!==n)throw te(n,"algorithm.length");break}case"ECDH":{switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw te("ECDH, X25519, or X448")}break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!ct(e.algorithm,"PBKDF2"))throw te("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!ct(e.algorithm,"RSA-OAEP"))throw te("RSA-OAEP");let n=parseInt(t.slice(9),10)||1;if(Po(e.algorithm.hash)!==n)throw te(`SHA-${n}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}Ad(e,r)}var ut=m(()=>{});function Cd(e,t,...r){if(r.length>2){let n=r.pop();e+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}function ua(e,t,...r){return Cd(`Key for the ${e} algorithm must be `,t,...r)}var K,Te=m(()=>{K=(e,...t)=>Cd("Key must be ",e,...t)});var la,q,xe=m(()=>{Q();la=e=>F(e),q=["CryptoKey"]});async function Nb(e,t,r,n,o,i){if(!(t instanceof Uint8Array))throw new TypeError(K(t,"Uint8Array"));let s=parseInt(e.slice(1,4),10),a=await _.subtle.importKey("raw",t.subarray(s>>3),"AES-CBC",!1,["decrypt"]),c=await _.subtle.importKey("raw",t.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),u=Z(i,n,r,bo(i.length<<3)),l=new Uint8Array((await _.subtle.sign("HMAC",c,u)).slice(0,s>>3)),p;try{p=Ed(o,l)}catch{}if(!p)throw new Ge;let h;try{h=new Uint8Array(await _.subtle.decrypt({iv:n,name:"AES-CBC"},a,r))}catch{}if(!h)throw new Ge;return h}async function Lb(e,t,r,n,o,i){let s;t instanceof Uint8Array?s=await _.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(ge(t,e,"decrypt"),s=t);try{return new Uint8Array(await _.subtle.decrypt({additionalData:i,iv:n,name:"AES-GCM",tagLength:128},s,Z(r,o)))}catch{throw new Ge}}var Db,Oo,da=m(()=>{G();aa();ca();Sd();P();Q();ut();Te();xe();Db=async(e,t,r,n,o,i)=>{if(!F(t)&&!(t instanceof Uint8Array))throw new TypeError(K(t,...q,"Uint8Array"));switch(Co(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&Jt(t,parseInt(e.slice(-3),10)),Nb(e,t,r,n,o,i);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&Jt(t,parseInt(e.slice(1,4),10)),Lb(e,t,r,n,o,i);default:throw new E("Unsupported JWE Content Encryption Algorithm")}},Oo=Db});var Pd,Od,pa=m(()=>{P();Pd=async()=>{throw new E('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},Od=async()=>{throw new E('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')}});var Ub,Me,Vt=m(()=>{Ub=(...e)=>{let t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(let n of t){let o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(let i of o){if(r.has(i))return!1;r.add(i)}}return!0},Me=Ub});function Kb(e){return typeof e=="object"&&e!==null}function H(e){if(!Kb(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}var ve=m(()=>{});var Wb,Gt,fa=m(()=>{Wb=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]],Gt=Wb});function Td(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${t}`)}function xd(e,t,r){if(F(e))return ge(e,t,r),e;if(e instanceof Uint8Array)return _.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw new TypeError(K(e,...q,"Uint8Array"))}var Ur,Kr,To=m(()=>{fa();Q();ut();Te();xe();Ur=async(e,t,r)=>{let n=await xd(t,e,"wrapKey");Td(n,e);let o=await _.subtle.importKey("raw",r,...Gt);return new Uint8Array(await _.subtle.wrapKey("raw",o,n,"AES-KW"))},Kr=async(e,t,r)=>{let n=await xd(t,e,"unwrapKey");Td(n,e);let o=await _.subtle.unwrapKey("raw",r,n,"AES-KW",...Gt);return new Uint8Array(await _.subtle.exportKey("raw",o))}});async function xo(e,t,r,n,o=new Uint8Array(0),i=new Uint8Array(0)){if(!F(e))throw new TypeError(K(e,...q));if(ge(e,"ECDH"),!F(t))throw new TypeError(K(t,...q));ge(t,"ECDH","deriveBits");let s=Z(Eo(M.encode(r)),Eo(o),Eo(i),_o(n)),a;e.algorithm.name==="X25519"?a=256:e.algorithm.name==="X448"?a=448:a=Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3;let c=new Uint8Array(await _.subtle.deriveBits({name:e.algorithm.name,public:e},t,a));return bd(c,n,s)}async function Id(e){if(!F(e))throw new TypeError(K(e,...q));return _.subtle.generateKey(e.algorithm,!0,["deriveBits"])}function Io(e){if(!F(e))throw new TypeError(K(e,...q));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||e.algorithm.name==="X25519"||e.algorithm.name==="X448"}var ha=m(()=>{G();Q();ut();Te();xe()});function ma(e){if(!(e instanceof Uint8Array)||e.length<8)throw new y("PBES2 Salt Input must be 8 or more octets")}var Hd=m(()=>{P()});function Fb(e,t){if(e instanceof Uint8Array)return _.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(F(e))return ge(e,t,"deriveBits","deriveKey"),e;throw new TypeError(K(e,...q,"Uint8Array"))}async function kd(e,t,r,n){ma(e);let o=wd(t,e),i=parseInt(t.slice(13,16),10),s={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:o},a={length:i,name:"AES-KW"},c=await Fb(n,t);if(c.usages.includes("deriveBits"))return new Uint8Array(await _.subtle.deriveBits(s,c,i));if(c.usages.includes("deriveKey"))return _.subtle.deriveKey(s,c,a,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}var Md,$d,ya=m(()=>{Dr();G();ee();To();Hd();Q();ut();Te();xe();Md=async(e,t,r,n=2048,o=at(new Uint8Array(16)))=>{let i=await kd(o,e,n,t);return{encryptedKey:await Ur(e.slice(-6),i,r),p2c:n,p2s:$(o)}},$d=async(e,t,r,n,o)=>{let i=await kd(o,e,n,t);return Kr(e.slice(-6),i,r)}});function Xt(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new E(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}var Nd=m(()=>{P()});var Ot,qo=m(()=>{Ot=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}});var Ld,Dd,ga=m(()=>{Nd();fa();Q();ut();qo();Te();xe();Ld=async(e,t,r)=>{if(!F(t))throw new TypeError(K(t,...q));if(ge(t,e,"encrypt","wrapKey"),Ot(e,t),t.usages.includes("encrypt"))return new Uint8Array(await _.subtle.encrypt(Xt(e),t,r));if(t.usages.includes("wrapKey")){let n=await _.subtle.importKey("raw",r,...Gt);return new Uint8Array(await _.subtle.wrapKey("raw",n,t,Xt(e)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},Dd=async(e,t,r)=>{if(!F(t))throw new TypeError(K(t,...q));if(ge(t,e,"decrypt","unwrapKey"),Ot(e,t),t.usages.includes("decrypt"))return new Uint8Array(await _.subtle.decrypt(Xt(e),t,r));if(t.usages.includes("unwrapKey")){let n=await _.subtle.unwrapKey("raw",r,t,Xt(e),...Gt);return new Uint8Array(await _.subtle.exportKey("raw",n))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')}});function Wr(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new E(`Unsupported JWE Algorithm: ${e}`)}}var $e,Fr=m(()=>{P();Dr();$e=e=>at(new Uint8Array(Wr(e)>>3))});var va,Ud=m(()=>{va=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join(`
`);return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`}});function Wd(e){let t=[],r=0;for(;r<e.length;){let n=Gd(e.subarray(r));t.push(n),r+=n.byteLength}return t}function Gd(e){let t=0,r=e[0]&31;if(t++,r===31){for(r=0;e[t]>=128;)r=r*128+e[t]-128,t++;r=r*128+e[t]-128,t++}let n=0;if(e[t]<128)n=e[t],t++;else if(n===128){for(n=0;e[t+n]!==0||e[t+n+1]!==0;){if(n>e.byteLength)throw new TypeError("invalid indefinite form length");n++}let i=t+n+2;return{byteLength:i,contents:e.subarray(t,t+n),raw:e.subarray(0,i)}}else{let i=e[t]&127;t++,n=0;for(let s=0;s<i;s++)n=n*256+e[t],t++}let o=t+n;return{byteLength:o,contents:e.subarray(t,o),raw:e.subarray(0,o)}}function jb(e){let t=Wd(Wd(Gd(e).contents)[0].contents);return So(t[t[0].raw[0]===160?6:5].raw)}function Bb(e){let t=e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),r=na(t);return va(jb(r),"PUBLIC KEY")}var Fd,jd,Bd,lt,Kd,Jd,Vd,wa,Xd,Ho=m(()=>{Q();Te();ee();Ud();P();xe();Fd=async(e,t,r)=>{if(!F(r))throw new TypeError(K(r,...q));if(!r.extractable)throw new TypeError("CryptoKey is not extractable");if(r.type!==e)throw new TypeError(`key is not a ${e} key`);return va(So(new Uint8Array(await _.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},jd=e=>Fd("public","spki",e),Bd=e=>Fd("private","pkcs8",e),lt=(e,t,r=0)=>{r===0&&(t.unshift(t.length),t.unshift(6));let n=e.indexOf(t[0],r);if(n===-1)return!1;let o=e.subarray(n,n+t.length);return o.length!==t.length?!1:o.every((i,s)=>i===t[s])||lt(e,t,n+1)},Kd=e=>{switch(!0){case lt(e,[42,134,72,206,61,3,1,7]):return"P-256";case lt(e,[43,129,4,0,34]):return"P-384";case lt(e,[43,129,4,0,35]):return"P-521";case lt(e,[43,101,110]):return"X25519";case lt(e,[43,101,111]):return"X448";case lt(e,[43,101,112]):return"Ed25519";case lt(e,[43,101,113]):return"Ed448";default:throw new E("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},Jd=async(e,t,r,n,o)=>{var i;let s,a,c=new Uint8Array(atob(r.replace(e,"")).split("").map(l=>l.charCodeAt(0))),u=t==="spki";switch(n){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`},a=u?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`},a=u?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`},a=u?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},a=u?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},a=u?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},a=u?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let l=Kd(c);s=l.startsWith("P-")?{name:"ECDH",namedCurve:l}:{name:l},a=u?[]:["deriveBits"];break}case"EdDSA":s={name:Kd(c)},a=u?["verify"]:["sign"];break;default:throw new E('Invalid or unsupported "alg" (Algorithm) value')}return _.subtle.importKey(t,c,s,(i=o?.extractable)!==null&&i!==void 0?i:!1,a)},Vd=(e,t,r)=>Jd(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r),wa=(e,t,r)=>Jd(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r);Xd=(e,t,r)=>{let n;try{n=Bb(e)}catch(o){throw new TypeError("Failed to parse the X.509 certificate",{cause:o})}return wa(n,t,r)}});function Jb(e){let t,r;switch(e.kty){case"oct":{switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.slice(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new E(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new E('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new E('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new E('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new E('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new E('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}var Vb,ba,zd=m(()=>{Q();P();ee();Vb=async e=>{var t,r;if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:n,keyUsages:o}=Jb(e),i=[n,(t=e.ext)!==null&&t!==void 0?t:!1,(r=e.key_ops)!==null&&r!==void 0?r:o];if(n.name==="PBKDF2")return _.subtle.importKey("raw",D(e.k),...i);let s={...e};return delete s.alg,delete s.use,_.subtle.importKey("jwk",s,...i)},ba=Vb});async function Yd(e,t,r){if(typeof e!="string"||e.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return wa(e,t,r)}async function Qd(e,t,r){if(typeof e!="string"||e.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw new TypeError('"x509" must be X.509 formatted string');return Xd(e,t,r)}async function Zd(e,t,r){if(typeof e!="string"||e.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return Vd(e,t,r)}async function dt(e,t,r){var n;if(!H(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return r??(r=e.ext!==!0),r?ba({...e,alg:t,ext:(n=e.ext)!==null&&n!==void 0?n:!1}):D(e.k);case"RSA":if(e.oth!==void 0)throw new E('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return ba({...e,alg:t});default:throw new E('Unsupported "kty" (Key Type) Parameter value')}}var jr=m(()=>{ee();Ho();zd();P();ve()});var Gb,Xb,zb,pt,Br=m(()=>{Te();xe();Gb=(e,t)=>{if(!(t instanceof Uint8Array)){if(!la(t))throw new TypeError(ua(e,t,...q,"Uint8Array"));if(t.type!=="secret")throw new TypeError(`${q.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},Xb=(e,t,r)=>{if(!la(t))throw new TypeError(ua(e,t,...q));if(t.type==="secret")throw new TypeError(`${q.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&t.type==="public")throw new TypeError(`${q.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&t.type==="public")throw new TypeError(`${q.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&r==="verify"&&t.type==="private")throw new TypeError(`${q.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&r==="encrypt"&&t.type==="private")throw new TypeError(`${q.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},zb=(e,t,r)=>{e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Gb(e,t):Xb(e,t,r)},pt=zb});async function Yb(e,t,r,n,o){if(!(r instanceof Uint8Array))throw new TypeError(K(r,"Uint8Array"));let i=parseInt(e.slice(1,4),10),s=await _.subtle.importKey("raw",r.subarray(i>>3),"AES-CBC",!1,["encrypt"]),a=await _.subtle.importKey("raw",r.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),c=new Uint8Array(await _.subtle.encrypt({iv:n,name:"AES-CBC"},s,t)),u=Z(o,n,c,bo(o.length<<3)),l=new Uint8Array((await _.subtle.sign("HMAC",a,u)).slice(0,i>>3));return{ciphertext:c,tag:l}}async function Qb(e,t,r,n,o){let i;r instanceof Uint8Array?i=await _.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(ge(r,e,"encrypt"),i=r);let s=new Uint8Array(await _.subtle.encrypt({additionalData:o,iv:n,name:"AES-GCM",tagLength:128},i,t)),a=s.slice(-16);return{ciphertext:s.slice(0,-16),tag:a}}var Zb,Jr,_a=m(()=>{G();aa();ca();Q();ut();Te();P();xe();Zb=async(e,t,r,n,o)=>{if(!F(r)&&!(r instanceof Uint8Array))throw new TypeError(K(r,...q,"Uint8Array"));switch(Co(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&Jt(r,parseInt(e.slice(-3),10)),Yb(e,t,r,n,o);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&Jt(r,parseInt(e.slice(1,4),10)),Qb(e,t,r,n,o);default:throw new E("Unsupported JWE Content Encryption Algorithm")}},Jr=Zb});async function ep(e,t,r,n){let o=e.slice(0,7);n||(n=Ao(o));let{ciphertext:i,tag:s}=await Jr(o,r,t,n,new Uint8Array(0));return{encryptedKey:i,iv:$(n),tag:$(s)}}async function tp(e,t,r,n,o){let i=e.slice(0,7);return Oo(i,t,r,n,o,new Uint8Array(0))}var Ea=m(()=>{_a();da();Ro();ee()});async function e0(e,t,r,n,o){switch(pt(e,t,"decrypt"),e){case"dir":{if(r!==void 0)throw new y("Encountered unexpected JWE Encrypted Key");return t}case"ECDH-ES":if(r!==void 0)throw new y("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!H(n.epk))throw new y('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!Io(t))throw new E("ECDH with the provided key is not allowed or not supported by your javascript runtime");let i=await dt(n.epk,e),s,a;if(n.apu!==void 0){if(typeof n.apu!="string")throw new y('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{s=D(n.apu)}catch{throw new y("Failed to base64url decode the apu")}}if(n.apv!==void 0){if(typeof n.apv!="string")throw new y('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{a=D(n.apv)}catch{throw new y("Failed to base64url decode the apv")}}let c=await xo(i,t,e==="ECDH-ES"?n.enc:e,e==="ECDH-ES"?Wr(n.enc):parseInt(e.slice(-5,-2),10),s,a);if(e==="ECDH-ES")return c;if(r===void 0)throw new y("JWE Encrypted Key missing");return Kr(e.slice(-6),c,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(r===void 0)throw new y("JWE Encrypted Key missing");return Dd(e,t,r)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(r===void 0)throw new y("JWE Encrypted Key missing");if(typeof n.p2c!="number")throw new y('JOSE Header "p2c" (PBES2 Count) missing or invalid');let i=o?.maxPBES2Count||1e4;if(n.p2c>i)throw new y('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof n.p2s!="string")throw new y('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let s;try{s=D(n.p2s)}catch{throw new y("Failed to base64url decode the p2s")}return $d(e,t,r,n.p2c,s)}case"A128KW":case"A192KW":case"A256KW":{if(r===void 0)throw new y("JWE Encrypted Key missing");return Kr(e,t,r)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(r===void 0)throw new y("JWE Encrypted Key missing");if(typeof n.iv!="string")throw new y('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof n.tag!="string")throw new y('JOSE Header "tag" (Authentication Tag) missing or invalid');let i;try{i=D(n.iv)}catch{throw new y("Failed to base64url decode the iv")}let s;try{s=D(n.tag)}catch{throw new y("Failed to base64url decode the tag")}return tp(e,t,r,i,s)}default:throw new E('Invalid or unsupported "alg" (JWE Algorithm) header value')}}var rp,np=m(()=>{To();ha();ya();ga();ee();P();Fr();jr();Br();ve();Ea();rp=e0});function t0(e,t,r,n,o){if(o.crit!==void 0&&n.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(s=>typeof s!="string"||s.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...t.entries()]):i=t;for(let s of n.crit){if(!i.has(s))throw new E(`Extension Header Parameter "${s}" is not recognized`);if(o[s]===void 0)throw new e(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&n[s]===void 0)throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(n.crit)}var Ne,zt=m(()=>{P();Ne=t0});var r0,Vr,Sa=m(()=>{r0=(e,t)=>{if(t!==void 0&&(!Array.isArray(t)||t.some(r=>typeof r!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)},Vr=r0});async function Yt(e,t,r){var n;if(!H(e))throw new y("Flattened JWE must be an object");if(e.protected===void 0&&e.header===void 0&&e.unprotected===void 0)throw new y("JOSE Header missing");if(typeof e.iv!="string")throw new y("JWE Initialization Vector missing or incorrect type");if(typeof e.ciphertext!="string")throw new y("JWE Ciphertext missing or incorrect type");if(typeof e.tag!="string")throw new y("JWE Authentication Tag missing or incorrect type");if(e.protected!==void 0&&typeof e.protected!="string")throw new y("JWE Protected Header incorrect type");if(e.encrypted_key!==void 0&&typeof e.encrypted_key!="string")throw new y("JWE Encrypted Key incorrect type");if(e.aad!==void 0&&typeof e.aad!="string")throw new y("JWE AAD incorrect type");if(e.header!==void 0&&!H(e.header))throw new y("JWE Shared Unprotected Header incorrect type");if(e.unprotected!==void 0&&!H(e.unprotected))throw new y("JWE Per-Recipient Unprotected Header incorrect type");let o;if(e.protected)try{let B=D(e.protected);o=JSON.parse(j.decode(B))}catch{throw new y("JWE Protected Header is invalid")}if(!Me(o,e.header,e.unprotected))throw new y("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let i={...o,...e.header,...e.unprotected};if(Ne(y,new Map,r?.crit,o,i),i.zip!==void 0){if(!o||!o.zip)throw new y('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(i.zip!=="DEF")throw new E('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:s,enc:a}=i;if(typeof s!="string"||!s)throw new y("missing JWE Algorithm (alg) in JWE Header");if(typeof a!="string"||!a)throw new y("missing JWE Encryption Algorithm (enc) in JWE Header");let c=r&&Vr("keyManagementAlgorithms",r.keyManagementAlgorithms),u=r&&Vr("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(c&&!c.has(s))throw new it('"alg" (Algorithm) Header Parameter not allowed');if(u&&!u.has(a))throw new it('"enc" (Encryption Algorithm) Header Parameter not allowed');let l;if(e.encrypted_key!==void 0)try{l=D(e.encrypted_key)}catch{throw new y("Failed to base64url decode the encrypted_key")}let p=!1;typeof t=="function"&&(t=await t(o,e),p=!0);let h;try{h=await rp(s,t,l,i,r)}catch(B){if(B instanceof TypeError||B instanceof y||B instanceof E)throw B;h=$e(a)}let f,w;try{f=D(e.iv)}catch{throw new y("Failed to base64url decode the iv")}try{w=D(e.tag)}catch{throw new y("Failed to base64url decode the tag")}let S=M.encode((n=e.protected)!==null&&n!==void 0?n:""),k;e.aad!==void 0?k=Z(S,M.encode("."),M.encode(e.aad)):k=S;let me;try{me=D(e.ciphertext)}catch{throw new y("Failed to base64url decode the ciphertext")}let Ke=await Oo(a,h,me,f,w,k);i.zip==="DEF"&&(Ke=await(r?.inflateRaw||Pd)(Ke));let le={plaintext:Ke};if(e.protected!==void 0&&(le.protectedHeader=o),e.aad!==void 0)try{le.additionalAuthenticatedData=D(e.aad)}catch{throw new y("Failed to base64url decode the aad")}return e.unprotected!==void 0&&(le.sharedUnprotectedHeader=e.unprotected),e.header!==void 0&&(le.unprotectedHeader=e.header),p?{...le,key:t}:le}var ko=m(()=>{ee();da();pa();P();Vt();ve();np();G();Fr();zt();Sa()});async function Mo(e,t,r){if(e instanceof Uint8Array&&(e=j.decode(e)),typeof e!="string")throw new y("Compact JWE must be a string or Uint8Array");let{0:n,1:o,2:i,3:s,4:a,length:c}=e.split(".");if(c!==5)throw new y("Invalid Compact JWE");let u=await Yt({ciphertext:s,iv:i||void 0,protected:n||void 0,tag:a||void 0,encrypted_key:o||void 0},t,r),l={plaintext:u.plaintext,protectedHeader:u.protectedHeader};return typeof t=="function"?{...l,key:u.key}:l}var Aa=m(()=>{ko();P();G()});async function op(e,t,r){if(!H(e))throw new y("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(H))throw new y("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new y("JWE Recipients has no members");for(let n of e.recipients)try{return await Yt({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:n.encrypted_key,header:n.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new Ge}var ip=m(()=>{ko();P();ve()});var n0,sp,ap=m(()=>{Q();Te();ee();xe();n0=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:$(e)};if(!F(e))throw new TypeError(K(e,...q,"Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:n,use:o,...i}=await _.subtle.exportKey("jwk",e);return i},sp=n0});async function cp(e){return jd(e)}async function up(e){return Bd(e)}async function $o(e){return sp(e)}var Ra=m(()=>{Ho();Ho();ap()});async function o0(e,t,r,n,o={}){let i,s,a;switch(pt(e,r,"encrypt"),e){case"dir":{a=r;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Io(r))throw new E("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:u}=o,{epk:l}=o;l||(l=(await Id(r)).privateKey);let{x:p,y:h,crv:f,kty:w}=await $o(l),S=await xo(r,l,e==="ECDH-ES"?t:e,e==="ECDH-ES"?Wr(t):parseInt(e.slice(-5,-2),10),c,u);if(s={epk:{x:p,crv:f,kty:w}},w==="EC"&&(s.epk.y=h),c&&(s.apu=$(c)),u&&(s.apv=$(u)),e==="ECDH-ES"){a=S;break}a=n||$e(t);let k=e.slice(-6);i=await Ur(k,S,a);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{a=n||$e(t),i=await Ld(e,r,a);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{a=n||$e(t);let{p2c:c,p2s:u}=o;({encryptedKey:i,...s}=await Md(e,r,a,c,u));break}case"A128KW":case"A192KW":case"A256KW":{a=n||$e(t),i=await Ur(e,r,a);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{a=n||$e(t);let{iv:c}=o;({encryptedKey:i,...s}=await ep(e,r,a,c));break}default:throw new E('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:a,encryptedKey:i,parameters:s}}var No,Ca=m(()=>{To();ha();ya();ga();ee();Fr();P();Ra();Br();Ea();No=o0});var Pa,Xe,Lo=m(()=>{ee();_a();pa();Ro();Ca();P();Vt();G();zt();Pa=Symbol(),Xe=class{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=t}setKeyManagementParameters(t){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=t,this}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setSharedUnprotectedHeader(t){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}setAdditionalAuthenticatedData(t){return this._aad=t,this}setContentEncryptionKey(t){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=t,this}setInitializationVector(t){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=t,this}async encrypt(t,r){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new y("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!Me(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new y("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(Ne(y,new Map,r?.crit,this._protectedHeader,n),n.zip!==void 0){if(!this._protectedHeader||!this._protectedHeader.zip)throw new y('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(n.zip!=="DEF")throw new E('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:o,enc:i}=n;if(typeof o!="string"||!o)throw new y('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof i!="string"||!i)throw new y('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let s;if(o==="dir"){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if(o==="ECDH-ES"&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");let a;{let w;({cek:a,encryptedKey:s,parameters:w}=await No(o,i,t,this._cek,this._keyManagementParameters)),w&&(r&&Pa in r?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...w}:this.setUnprotectedHeader(w):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...w}:this.setProtectedHeader(w))}this._iv||(this._iv=Ao(i));let c,u,l;this._protectedHeader?u=M.encode($(JSON.stringify(this._protectedHeader))):u=M.encode(""),this._aad?(l=$(this._aad),c=Z(u,M.encode("."),M.encode(l))):c=u;let p,h;if(n.zip==="DEF"){let w=await(r?.deflateRaw||Od)(this._plaintext);({ciphertext:p,tag:h}=await Jr(i,w,a,this._iv,c))}else({ciphertext:p,tag:h}=await Jr(i,this._plaintext,a,this._iv,c));let f={ciphertext:$(p),iv:$(this._iv),tag:$(h)};return s&&(f.encrypted_key=$(s)),l&&(f.aad=l),this._protectedHeader&&(f.protected=j.decode(u)),this._sharedUnprotectedHeader&&(f.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(f.header=this._unprotectedHeader),f}}});var Oa,Do,lp=m(()=>{Lo();P();Fr();Vt();Ca();ee();zt();Oa=class{constructor(t,r,n){this.parent=t,this.key=r,this.options=n}setUnprotectedHeader(t){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=t,this}addRecipient(...t){return this.parent.addRecipient(...t)}encrypt(...t){return this.parent.encrypt(...t)}done(){return this.parent}},Do=class{constructor(t){this._recipients=[],this._plaintext=t}addRecipient(t,r){let n=new Oa(this,t,{crit:r?.crit});return this._recipients.push(n),n}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setSharedUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}setAdditionalAuthenticatedData(t){return this._aad=t,this}async encrypt(t){var r,n,o;if(!this._recipients.length)throw new y("at least one recipient must be added");if(t={deflateRaw:t?.deflateRaw},this._recipients.length===1){let[c]=this._recipients,u=await new Xe(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(c.unprotectedHeader).encrypt(c.key,{...c.options,...t}),l={ciphertext:u.ciphertext,iv:u.iv,recipients:[{}],tag:u.tag};return u.aad&&(l.aad=u.aad),u.protected&&(l.protected=u.protected),u.unprotected&&(l.unprotected=u.unprotected),u.encrypted_key&&(l.recipients[0].encrypted_key=u.encrypted_key),u.header&&(l.recipients[0].header=u.header),l}let i;for(let c=0;c<this._recipients.length;c++){let u=this._recipients[c];if(!Me(this._protectedHeader,this._unprotectedHeader,u.unprotectedHeader))throw new y("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let l={...this._protectedHeader,...this._unprotectedHeader,...u.unprotectedHeader},{alg:p}=l;if(typeof p!="string"||!p)throw new y('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(p==="dir"||p==="ECDH-ES")throw new y('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof l.enc!="string"||!l.enc)throw new y('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(!i)i=l.enc;else if(i!==l.enc)throw new y('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients');if(Ne(y,new Map,u.options.crit,this._protectedHeader,l),l.zip!==void 0&&(!this._protectedHeader||!this._protectedHeader.zip))throw new y('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let s=$e(i),a={ciphertext:"",iv:"",recipients:[],tag:""};for(let c=0;c<this._recipients.length;c++){let u=this._recipients[c],l={};a.recipients.push(l);let h={...this._protectedHeader,...this._unprotectedHeader,...u.unprotectedHeader}.alg.startsWith("PBES2")?2048+c:void 0;if(c===0){let S=await new Xe(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(s).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(u.unprotectedHeader).setKeyManagementParameters({p2c:h}).encrypt(u.key,{...u.options,...t,[Pa]:!0});a.ciphertext=S.ciphertext,a.iv=S.iv,a.tag=S.tag,S.aad&&(a.aad=S.aad),S.protected&&(a.protected=S.protected),S.unprotected&&(a.unprotected=S.unprotected),l.encrypted_key=S.encrypted_key,S.header&&(l.header=S.header);continue}let{encryptedKey:f,parameters:w}=await No(((r=u.unprotectedHeader)===null||r===void 0?void 0:r.alg)||((n=this._protectedHeader)===null||n===void 0?void 0:n.alg)||((o=this._unprotectedHeader)===null||o===void 0?void 0:o.alg),i,u.key,s,{p2c:h});l.encrypted_key=$(f),(u.unprotectedHeader||w)&&(l.header={...u.unprotectedHeader,...w})}return a}}});function Gr(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new E(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}var Ta=m(()=>{P()});function Xr(e,t,r){if(F(t))return Rd(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(K(t,...q));return _.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(K(t,...q,"Uint8Array"))}var xa=m(()=>{Q();ut();Te();xe()});var i0,dp,pp=m(()=>{Ta();Q();qo();xa();i0=async(e,t,r,n)=>{let o=await Xr(e,t,"verify");Ot(e,o);let i=Gr(e,o.algorithm);try{return await _.subtle.verify(i,o,r,n)}catch{return!1}},dp=i0});async function Qt(e,t,r){var n;if(!H(e))throw new O("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new O('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new O("JWS Protected Header incorrect type");if(e.payload===void 0)throw new O("JWS Payload missing");if(typeof e.signature!="string")throw new O("JWS Signature missing or incorrect type");if(e.header!==void 0&&!H(e.header))throw new O("JWS Unprotected Header incorrect type");let o={};if(e.protected)try{let k=D(e.protected);o=JSON.parse(j.decode(k))}catch{throw new O("JWS Protected Header is invalid")}if(!Me(o,e.header))throw new O("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...o,...e.header},s=Ne(O,new Map([["b64",!0]]),r?.crit,o,i),a=!0;if(s.has("b64")&&(a=o.b64,typeof a!="boolean"))throw new O('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:c}=i;if(typeof c!="string"||!c)throw new O('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&Vr("algorithms",r.algorithms);if(u&&!u.has(c))throw new it('"alg" (Algorithm) Header Parameter not allowed');if(a){if(typeof e.payload!="string")throw new O("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new O("JWS Payload must be a string or an Uint8Array instance");let l=!1;typeof t=="function"&&(t=await t(o,e),l=!0),pt(c,t,"verify");let p=Z(M.encode((n=e.protected)!==null&&n!==void 0?n:""),M.encode("."),typeof e.payload=="string"?M.encode(e.payload):e.payload),h;try{h=D(e.signature)}catch{throw new O("Failed to base64url decode the signature")}if(!await dp(c,t,h,p))throw new Pt;let w;if(a)try{w=D(e.payload)}catch{throw new O("Failed to base64url decode the payload")}else typeof e.payload=="string"?w=M.encode(e.payload):w=e.payload;let S={payload:w};return e.protected!==void 0&&(S.protectedHeader=o),e.header!==void 0&&(S.unprotectedHeader=e.header),l?{...S,key:t}:S}var Uo=m(()=>{ee();pp();P();G();Vt();ve();Br();zt();Sa()});async function Ko(e,t,r){if(e instanceof Uint8Array&&(e=j.decode(e)),typeof e!="string")throw new O("Compact JWS must be a string or Uint8Array");let{0:n,1:o,2:i,length:s}=e.split(".");if(s!==3)throw new O("Invalid Compact JWS");let a=await Qt({payload:o,protected:n,signature:i},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof t=="function"?{...c,key:a.key}:c}var Ia=m(()=>{Uo();P();G()});async function fp(e,t,r){if(!H(e))throw new O("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(H))throw new O("JWS Signatures missing or incorrect type");for(let n of e.signatures)try{return await Qt({header:n.header,payload:e.payload,protected:n.protected,signature:n.signature},t,r)}catch{}throw new Pt}var hp=m(()=>{Uo();P();ve()});var Zt,qa=m(()=>{Zt=e=>Math.floor(e.getTime()/1e3)});var s0,er,Ha=m(()=>{s0=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,er=e=>{let t=s0.exec(e);if(!t)throw new TypeError("Invalid time period format");let r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(r*60);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(r*3600);case"day":case"days":case"d":return Math.round(r*86400);case"week":case"weeks":case"w":return Math.round(r*604800);default:return Math.round(r*31557600)}}});var mp,a0,tr,Wo=m(()=>{P();G();qa();Ha();ve();mp=e=>e.toLowerCase().replace(/^application\//,""),a0=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1,tr=(e,t,r={})=>{let{typ:n}=r;if(n&&(typeof e.typ!="string"||mp(e.typ)!==mp(n)))throw new z('unexpected "typ" JWT header value',"typ","check_failed");let o;try{o=JSON.parse(j.decode(t))}catch{}if(!H(o))throw new V("JWT Claims Set must be a top-level JSON object");let{requiredClaims:i=[],issuer:s,subject:a,audience:c,maxTokenAge:u}=r;u!==void 0&&i.push("iat"),c!==void 0&&i.push("aud"),a!==void 0&&i.push("sub"),s!==void 0&&i.push("iss");for(let f of new Set(i.reverse()))if(!(f in o))throw new z(`missing required "${f}" claim`,f,"missing");if(s&&!(Array.isArray(s)?s:[s]).includes(o.iss))throw new z('unexpected "iss" claim value',"iss","check_failed");if(a&&o.sub!==a)throw new z('unexpected "sub" claim value',"sub","check_failed");if(c&&!a0(o.aud,typeof c=="string"?[c]:c))throw new z('unexpected "aud" claim value',"aud","check_failed");let l;switch(typeof r.clockTolerance){case"string":l=er(r.clockTolerance);break;case"number":l=r.clockTolerance;break;case"undefined":l=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,h=Zt(p||new Date);if((o.iat!==void 0||u)&&typeof o.iat!="number")throw new z('"iat" claim must be a number',"iat","invalid");if(o.nbf!==void 0){if(typeof o.nbf!="number")throw new z('"nbf" claim must be a number',"nbf","invalid");if(o.nbf>h+l)throw new z('"nbf" claim timestamp check failed',"nbf","check_failed")}if(o.exp!==void 0){if(typeof o.exp!="number")throw new z('"exp" claim must be a number',"exp","invalid");if(o.exp<=h-l)throw new Bt('"exp" claim timestamp check failed',"exp","check_failed")}if(u){let f=h-o.iat,w=typeof u=="number"?u:er(u);if(f-l>w)throw new Bt('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(f<0-l)throw new z('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return o}});async function yp(e,t,r){var n;let o=await Ko(e,t,r);if(!((n=o.protectedHeader.crit)===null||n===void 0)&&n.includes("b64")&&o.protectedHeader.b64===!1)throw new V("JWTs MUST NOT use unencoded payload");let s={payload:tr(o.protectedHeader,o.payload,r),protectedHeader:o.protectedHeader};return typeof t=="function"?{...s,key:o.key}:s}var gp=m(()=>{Ia();Wo();P()});async function vp(e,t,r){let n=await Mo(e,t,r),o=tr(n.protectedHeader,n.plaintext,r),{protectedHeader:i}=n;if(i.iss!==void 0&&i.iss!==o.iss)throw new z('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(i.sub!==void 0&&i.sub!==o.sub)throw new z('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(i.aud!==void 0&&JSON.stringify(i.aud)!==JSON.stringify(o.aud))throw new z('replicated "aud" claim header parameter mismatch',"aud","mismatch");let s={payload:o,protectedHeader:i};return typeof t=="function"?{...s,key:n.key}:s}var wp=m(()=>{Aa();Wo();P()});var rr,ka=m(()=>{Lo();rr=class{constructor(t){this._flattened=new Xe(t)}setContentEncryptionKey(t){return this._flattened.setContentEncryptionKey(t),this}setInitializationVector(t){return this._flattened.setInitializationVector(t),this}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}setKeyManagementParameters(t){return this._flattened.setKeyManagementParameters(t),this}async encrypt(t,r){let n=await this._flattened.encrypt(t,r);return[n.protected,n.encrypted_key,n.iv,n.ciphertext,n.tag].join(".")}}});var c0,bp,_p=m(()=>{Ta();Q();qo();xa();c0=async(e,t,r)=>{let n=await Xr(e,t,"sign");Ot(e,n);let o=await _.subtle.sign(Gr(e,n.algorithm),n,r);return new Uint8Array(o)},bp=c0});var ft,Fo=m(()=>{ee();_p();Vt();P();G();Br();zt();ft=class{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=t}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}async sign(t,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new O("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Me(this._protectedHeader,this._unprotectedHeader))throw new O("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},o=Ne(O,new Map([["b64",!0]]),r?.crit,this._protectedHeader,n),i=!0;if(o.has("b64")&&(i=this._protectedHeader.b64,typeof i!="boolean"))throw new O('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:s}=n;if(typeof s!="string"||!s)throw new O('JWS "alg" (Algorithm) Header Parameter missing or invalid');pt(s,t,"sign");let a=this._payload;i&&(a=M.encode($(a)));let c;this._protectedHeader?c=M.encode($(JSON.stringify(this._protectedHeader))):c=M.encode("");let u=Z(c,M.encode("."),a),l=await bp(s,t,u),p={signature:$(l),payload:""};return i&&(p.payload=j.decode(a)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=j.decode(c)),p}}});var nr,Ma=m(()=>{Fo();nr=class{constructor(t){this._flattened=new ft(t)}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}async sign(t,r){let n=await this._flattened.sign(t,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}});var $a,jo,Ep=m(()=>{Fo();P();$a=class{constructor(t,r,n){this.parent=t,this.key=r,this.options=n}setProtectedHeader(t){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=t,this}setUnprotectedHeader(t){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=t,this}addSignature(...t){return this.parent.addSignature(...t)}sign(...t){return this.parent.sign(...t)}done(){return this.parent}},jo=class{constructor(t){this._signatures=[],this._payload=t}addSignature(t,r){let n=new $a(this,t,r);return this._signatures.push(n),n}async sign(){if(!this._signatures.length)throw new O("at least one signature must be added");let t={signatures:[],payload:""};for(let r=0;r<this._signatures.length;r++){let n=this._signatures[r],o=new ft(this._payload);o.setProtectedHeader(n.protectedHeader),o.setUnprotectedHeader(n.unprotectedHeader);let{payload:i,...s}=await o.sign(n.key,n.options);if(r===0)t.payload=i;else if(t.payload!==i)throw new O("inconsistent use of JWS Unencoded Payload (RFC7797)");t.signatures.push(s)}return t}}});var ht,Bo=m(()=>{qa();ve();Ha();ht=class{constructor(t){if(!H(t))throw new TypeError("JWT Claims Set MUST be an object");this._payload=t}setIssuer(t){return this._payload={...this._payload,iss:t},this}setSubject(t){return this._payload={...this._payload,sub:t},this}setAudience(t){return this._payload={...this._payload,aud:t},this}setJti(t){return this._payload={...this._payload,jti:t},this}setNotBefore(t){return typeof t=="number"?this._payload={...this._payload,nbf:t}:this._payload={...this._payload,nbf:Zt(new Date)+er(t)},this}setExpirationTime(t){return typeof t=="number"?this._payload={...this._payload,exp:t}:this._payload={...this._payload,exp:Zt(new Date)+er(t)},this}setIssuedAt(t){return typeof t>"u"?this._payload={...this._payload,iat:Zt(new Date)}:this._payload={...this._payload,iat:t},this}}});var Jo,Sp=m(()=>{Ma();P();G();Bo();Jo=class extends ht{setProtectedHeader(t){return this._protectedHeader=t,this}async sign(t,r){var n;let o=new nr(M.encode(JSON.stringify(this._payload)));if(o.setProtectedHeader(this._protectedHeader),Array.isArray((n=this._protectedHeader)===null||n===void 0?void 0:n.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new V("JWTs MUST NOT use unencoded payload");return o.sign(t,r)}}});var Vo,Ap=m(()=>{ka();G();Bo();Vo=class extends ht{setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setKeyManagementParameters(t){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=t,this}setContentEncryptionKey(t){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=t,this}setInitializationVector(t){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=t,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(t,r){let n=new rr(M.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),n.setProtectedHeader(this._protectedHeader),this._iv&&n.setInitializationVector(this._iv),this._cek&&n.setContentEncryptionKey(this._cek),this._keyManagementParameters&&n.setKeyManagementParameters(this._keyManagementParameters),n.encrypt(t,r)}}});async function Na(e,t){if(!H(e))throw new TypeError("JWK must be an object");if(t??(t="sha256"),t!=="sha256"&&t!=="sha384"&&t!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(e.kty){case"EC":mt(e.crv,'"crv" (Curve) Parameter'),mt(e.x,'"x" (X Coordinate) Parameter'),mt(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":mt(e.crv,'"crv" (Subtype of Key Pair) Parameter'),mt(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":mt(e.e,'"e" (Exponent) Parameter'),mt(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":mt(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new E('"kty" (Key Type) Parameter missing or unsupported')}let n=M.encode(JSON.stringify(r));return $(await vo(t,n))}async function Rp(e,t){t??(t="sha256");let r=await Na(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}var mt,Cp=m(()=>{ta();ee();P();G();ve();mt=(e,t)=>{if(typeof e!="string"||!e)throw new $r(`${t} missing or invalid`)}});async function Pp(e,t){let r={...e,...t?.header};if(!H(r.jwk))throw new O('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let n=await dt({...r.jwk,ext:!0},r.alg,!0);if(n instanceof Uint8Array||n.type!=="public")throw new O('"jwk" (JSON Web Key) Header Parameter must be a public key');return n}var Op=m(()=>{jr();ve();P()});function u0(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new E('Unsupported "alg" value for a JSON Web Key Set')}}function La(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(l0)}function l0(e){return H(e)}function d0(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}async function Tp(e,t,r){let n=e.get(t)||e.set(t,{}).get(t);if(n[r]===void 0){let o=await dt({...t,ext:!0},r);if(o instanceof Uint8Array||o.type!=="public")throw new st("JSON Web Key Set members must be public keys");n[r]=o}return n[r]}function xp(e){let t=new zr(e);return async function(r,n){return t.getKey(r,n)}}var zr,Da=m(()=>{jr();P();ve();zr=class{constructor(t){if(this._cached=new WeakMap,!La(t))throw new st("JSON Web Key Set malformed");this._jwks=d0(t)}async getKey(t,r){let{alg:n,kid:o}={...t,...r?.header},i=u0(n),s=this._jwks.keys.filter(u=>{let l=i===u.kty;if(l&&typeof o=="string"&&(l=o===u.kid),l&&typeof u.alg=="string"&&(l=n===u.alg),l&&typeof u.use=="string"&&(l=u.use==="sig"),l&&Array.isArray(u.key_ops)&&(l=u.key_ops.includes("verify")),l&&n==="EdDSA"&&(l=u.crv==="Ed25519"||u.crv==="Ed448"),l)switch(n){case"ES256":l=u.crv==="P-256";break;case"ES256K":l=u.crv==="secp256k1";break;case"ES384":l=u.crv==="P-384";break;case"ES512":l=u.crv==="P-521";break}return l}),{0:a,length:c}=s;if(c===0)throw new Ct;if(c!==1){let u=new Nr,{_cached:l}=this;throw u[Symbol.asyncIterator]=async function*(){for(let p of s)try{yield await Tp(l,p,n)}catch{continue}},u}return Tp(this._cached,a,n)}}});var p0,Ip,qp=m(()=>{P();p0=async(e,t,r)=>{let n,o,i=!1;typeof AbortController=="function"&&(n=new AbortController,o=setTimeout(()=>{i=!0,n.abort()},t));let s=await fetch(e.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch(a=>{throw i?new Lr:a});if(o!==void 0&&clearTimeout(o),s.status!==200)throw new J("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await s.json()}catch{throw new J("Failed to parse the JSON Web Key Set HTTP response as JSON")}},Ip=p0});function f0(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}function Hp(e,t){let r=new Ua(e,t);return async function(n,o){return r.getKey(n,o)}}var Ua,kp=m(()=>{qp();P();Da();Ua=class extends zr{constructor(t,r){if(super({keys:[]}),this._jwks=void 0,!(t instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(t.href),this._options={agent:r?.agent,headers:r?.headers},this._timeoutDuration=typeof r?.timeoutDuration=="number"?r?.timeoutDuration:5e3,this._cooldownDuration=typeof r?.cooldownDuration=="number"?r?.cooldownDuration:3e4,this._cacheMaxAge=typeof r?.cacheMaxAge=="number"?r?.cacheMaxAge:6e5}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(t,r){(!this._jwks||!this.fresh())&&await this.reload();try{return await super.getKey(t,r)}catch(n){if(n instanceof Ct&&this.coolingDown()===!1)return await this.reload(),super.getKey(t,r);throw n}}async reload(){this._pendingFetch&&f0()&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=Ip(this._url,this._timeoutDuration,this._options).then(t=>{if(!La(t))throw new st("JSON Web Key Set malformed");this._jwks={keys:t.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(t=>{throw this._pendingFetch=void 0,t})),await this._pendingFetch}}});var Go,Mp=m(()=>{ee();G();P();Wo();Bo();Go=class extends ht{encode(){let t=$(JSON.stringify({alg:"none"})),r=$(JSON.stringify(this._payload));return`${t}.${r}.`}static decode(t,r){if(typeof t!="string")throw new V("Unsecured JWT must be a string");let{0:n,1:o,2:i,length:s}=t.split(".");if(s!==3||i!=="")throw new V("Invalid Unsecured JWT");let a;try{if(a=JSON.parse(j.decode(D(n))),a.alg!=="none")throw new Error}catch{throw new V("Invalid Unsecured JWT")}return{payload:tr(a,D(o),r),header:a}}}});var Ka={};yr(Ka,{decode:()=>Yr,encode:()=>h0});var h0,Yr,Xo=m(()=>{ee();h0=$,Yr=D});function $p(e){let t;if(typeof e=="string"){let r=e.split(".");(r.length===3||r.length===5)&&([t]=r)}else if(typeof e=="object"&&e)if("protected"in e)t=e.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof t!="string"||!t)throw new Error;let r=JSON.parse(j.decode(Yr(t)));if(!H(r))throw new Error;return r}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}var Np=m(()=>{Xo();G();ve()});function Lp(e){if(typeof e!="string")throw new V("JWTs must use Compact JWS serialization, JWT must be a string");let{1:t,length:r}=e.split(".");if(r===5)throw new V("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new V("Invalid JWT");if(!t)throw new V("JWTs must contain a payload");let n;try{n=Yr(t)}catch{throw new V("Failed to base64url decode the payload")}let o;try{o=JSON.parse(j.decode(n))}catch{throw new V("Failed to parse the decoded payload as JSON")}if(!H(o))throw new V("Invalid JWT Claims Set");return o}var Dp=m(()=>{Xo();G();ve();P()});async function Up(e,t){var r;let n,o,i;switch(e){case"HS256":case"HS384":case"HS512":n=parseInt(e.slice(-3),10),o={name:"HMAC",hash:`SHA-${n}`,length:n},i=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n=parseInt(e.slice(-3),10),at(new Uint8Array(n>>3));case"A128KW":case"A192KW":case"A256KW":n=parseInt(e.slice(1,4),10),o={name:"AES-KW",length:n},i=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n=parseInt(e.slice(1,4),10),o={name:"AES-GCM",length:n},i=["encrypt","decrypt"];break;default:throw new E('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return _.subtle.generateKey(o,(r=t?.extractable)!==null&&r!==void 0?r:!1,i)}function Wa(e){var t;let r=(t=e?.modulusLength)!==null&&t!==void 0?t:2048;if(typeof r!="number"||r<2048)throw new E("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}async function Kp(e,t){var r,n,o;let i,s;switch(e){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Wa(t)},s=["sign","verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Wa(t)},s=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Wa(t)},s=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":i={name:"ECDSA",namedCurve:"P-256"},s=["sign","verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},s=["sign","verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},s=["sign","verify"];break;case"EdDSA":s=["sign","verify"];let a=(r=t?.crv)!==null&&r!==void 0?r:"Ed25519";switch(a){case"Ed25519":case"Ed448":i={name:a};break;default:throw new E("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{s=["deriveKey","deriveBits"];let c=(n=t?.crv)!==null&&n!==void 0?n:"P-256";switch(c){case"P-256":case"P-384":case"P-521":{i={name:"ECDH",namedCurve:c};break}case"X25519":case"X448":i={name:c};break;default:throw new E("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new E('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return _.subtle.generateKey(i,(o=t?.extractable)!==null&&o!==void 0?o:!1,s)}var Fa=m(()=>{Q();P();Dr()});async function Wp(e,t){return Kp(e,t)}var Fp=m(()=>{Fa()});async function jp(e,t){return Up(e,t)}var Bp=m(()=>{Fa()});var Jp,Vp=m(()=>{Jp="WebCryptoAPI"});var Gp,Xp=m(()=>{Vp();Gp=Jp});var zp={};yr(zp,{CompactEncrypt:()=>rr,CompactSign:()=>nr,EmbeddedJWK:()=>Pp,EncryptJWT:()=>Vo,FlattenedEncrypt:()=>Xe,FlattenedSign:()=>ft,GeneralEncrypt:()=>Do,GeneralSign:()=>jo,SignJWT:()=>Jo,UnsecuredJWT:()=>Go,base64url:()=>Ka,calculateJwkThumbprint:()=>Na,calculateJwkThumbprintUri:()=>Rp,compactDecrypt:()=>Mo,compactVerify:()=>Ko,createLocalJWKSet:()=>xp,createRemoteJWKSet:()=>Hp,cryptoRuntime:()=>Gp,decodeJwt:()=>Lp,decodeProtectedHeader:()=>$p,errors:()=>ia,exportJWK:()=>$o,exportPKCS8:()=>up,exportSPKI:()=>cp,flattenedDecrypt:()=>Yt,flattenedVerify:()=>Qt,generalDecrypt:()=>op,generalVerify:()=>fp,generateKeyPair:()=>Wp,generateSecret:()=>jp,importJWK:()=>dt,importPKCS8:()=>Zd,importSPKI:()=>Yd,importX509:()=>Qd,jwtDecrypt:()=>vp,jwtVerify:()=>yp});var Yp=m(()=>{Aa();ko();ip();lp();Ia();Uo();hp();gp();wp();ka();Lo();Ma();Fo();Ep();Sp();Ap();Cp();Op();Da();kp();Mp();Ra();jr();Np();Dp();P();Fp();Bp();Xo();Xp()});var Qp=d(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.getHMACKey=void 0;function m0(e){let t=new Uint8Array(e.length);for(let r=0,n=e.length;r<n;r++)t[r]=e.charCodeAt(r);return t}zo.getHMACKey=m0});var Qo=d(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.decodeSessionToken=void 0;var ja=(x(),R(T)),y0=ja.__importStar((Yp(),R(zp))),Zp=ja.__importStar(U()),g0=Qp(),v0=10;function w0(e){return(t,{checkAudience:r=!0}={})=>ja.__awaiter(this,void 0,void 0,function*(){let n;try{n=(yield y0.jwtVerify(t,(0,g0.getHMACKey)(e.apiSecretKey),{algorithms:["HS256"],clockTolerance:v0})).payload}catch(o){throw new Zp.InvalidJwtError(`Failed to parse session token '${t}': ${o.message}`)}if(r&&n.aud!==e.apiKey)throw new Zp.InvalidJwtError("Session token had invalid API key");return n})}Yo.decodeSessionToken=w0});var Va=d(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.customAppSession=Le.getCurrentSessionId=Le.getOfflineId=Le.getJwtSessionId=void 0;var Ba=(x(),R(T)),b0=Zn(),ef=We(),Ja=Ft(),_0=de(),E0=Ba.__importStar(U()),S0=Qo(),A0=go();function tf(e){return(t,r)=>`${(0,Ja.sanitizeShop)(e)(t,!0)}_${r}`}Le.getJwtSessionId=tf;function rf(e){return t=>`offline_${(0,Ja.sanitizeShop)(e)(t,!0)}`}Le.getOfflineId=rf;function R0(e){return function(r){var{isOnline:n}=r,o=Ba.__rest(r,["isOnline"]);return Ba.__awaiter(this,void 0,void 0,function*(){let i=yield(0,ef.abstractConvertRequest)(o),s=(0,_0.logger)(e);if(e.isEmbeddedApp){s.debug("App is embedded, looking for session id in JWT payload",{isOnline:n});let a=i.headers.Authorization;if(a){let c=(typeof a=="string"?a:a[0]).match(/^Bearer (.+)$/);if(!c)throw s.error("Missing Bearer token in authorization header",{isOnline:n}),new E0.MissingJwtTokenError("Missing Bearer token in authorization header");let u=yield(0,S0.decodeSessionToken)(e)(c[1]),l=u.dest.replace(/^https:\/\//,"");return s.debug("Found valid JWT payload",{shop:l,isOnline:n}),n?tf(e)(l,u.sub):rf(e)(l)}else s.error("Missing Authorization header, was the request made with authenticatedFetch?",{isOnline:n})}else return s.debug("App is not embedded, looking for session id in cookies",{isOnline:n}),new ef.Cookies(i,{},{keys:[e.apiSecretKey]}).getAndVerify(b0.SESSION_COOKIE_NAME)})}}Le.getCurrentSessionId=R0;function C0(e){return t=>new A0.Session({id:"",shop:`${(0,Ja.sanitizeShop)(e)(t,!0)}`,state:"",isOnline:!1})}Le.customAppSession=C0});var Ga=d(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.accessTokenResponse=or.createSession=void 0;var P0=(x(),R(T)),O0=gd(),nf=go(),T0=de(),of=Va();function x0({config:e,accessTokenResponse:t,shop:r,state:n}){let o=t.associated_user,i=Boolean(o);if((0,T0.logger)(e).info("Creating new session",{shop:r,isOnline:i}),i){let s,a=t,{access_token:c,scope:u}=a,l=P0.__rest(a,["access_token","scope"]),p=new Date(Date.now()+a.expires_in*1e3);return e.isEmbeddedApp?s=(0,of.getJwtSessionId)(e)(r,`${l.associated_user.id}`):s=(0,O0.v4)(),new nf.Session({id:s,shop:r,state:n,isOnline:i,accessToken:c,scope:u,expires:p,onlineAccessInfo:l})}else return new nf.Session({id:(0,of.getOfflineId)(e)(r),shop:r,state:n,isOnline:i,accessToken:t.access_token,scope:t.scope})}or.createSession=x0;function I0(e){let t=e.body.associated_user;return Boolean(t),e.body}or.accessTokenResponse=I0});var pf=d(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.callback=ir.begin=void 0;var gt=(x(),R(T)),af=gt.__importDefault(zn()),q0=gt.__importDefault(Kn()),Zo=gt.__importStar(U()),H0=Fs(),cf=Ft(),k0=At(),M0=$t(),yt=We(),uf=de(),ei=Zn(),$0=Js(),N0=xr(),sf=Ga(),lf=({request:e,log:t,func:r})=>{t.debug(`Possible bot request to auth ${r}: `,{userAgent:e.headers["User-Agent"]})};function L0(e){return t=>gt.__awaiter(this,void 0,void 0,function*(){var{shop:r,callbackPath:n,isOnline:o}=t,i=gt.__rest(t,["shop","callbackPath","isOnline"]);df(e.isCustomStoreApp,"Cannot perform OAuth for private apps");let s=(0,uf.logger)(e);s.info("Beginning OAuth",{shop:r,isOnline:o,callbackPath:n});let a=yield(0,yt.abstractConvertRequest)(i),c=yield(0,yt.abstractConvertIncomingResponse)(i);if((0,af.default)(a.headers["User-Agent"]))return lf({request:a,log:s,func:"begin"}),c.statusCode=410,(0,yt.abstractConvertResponse)(c,i);let u=new yt.Cookies(a,c,{keys:[e.apiSecretKey],secure:!0}),l=(0,$0.nonce)();yield u.setAndSign(ei.STATE_COOKIE_NAME,l,{expires:new Date(Date.now()+6e4),sameSite:"lax",secure:!0,path:n});let p={client_id:e.apiKey,scope:e.scopes.toString(),redirect_uri:`${e.hostScheme}://${e.hostName}${n}`,state:l,"grant_options[]":o?"per-user":""},h=new q0.default;h.putAll(p);let w=`https://${(0,cf.sanitizeShop)(e)(r,!0)}/admin/oauth/authorize${h.stringify()}`;return c.statusCode=302,c.statusText="Found",c.headers=Object.assign(Object.assign(Object.assign({},c.headers),u.response.headers),{Location:w}),s.debug(`OAuth started, redirecting to ${w}`,{shop:r,isOnline:o}),(0,yt.abstractConvertResponse)(c,i)})}ir.begin=L0;function D0(e){return function(r){var n=gt.__rest(r,[]);return gt.__awaiter(this,void 0,void 0,function*(){df(e.isCustomStoreApp,"Cannot perform OAuth for private apps");let o=(0,uf.logger)(e),i=yield(0,yt.abstractConvertRequest)(n),s=new URL(i.url,`${e.hostScheme}://${e.hostName}`).searchParams,a=s.get("shop"),c={};if((0,af.default)(i.headers["User-Agent"]))throw lf({request:i,log:o,func:"callback"}),new Zo.BotActivityDetected("Invalid OAuth callback initiated by bot");o.info("Completing OAuth",{shop:a});let u=new yt.Cookies(i,c,{keys:[e.apiSecretKey],secure:!0}),l=yield u.getAndVerify(ei.STATE_COOKIE_NAME);if(u.deleteCookie(ei.STATE_COOKIE_NAME),!l)throw o.error("Could not find OAuth cookie",{shop:a}),new Zo.CookieNotFound(`Cannot complete OAuth process. Could not find an OAuth cookie for shop url: ${a}`);let p=Object.fromEntries(s.entries());if(!(yield U0({config:e,query:p,stateFromCookie:l})))throw o.error("Invalid OAuth callback",{shop:a,stateFromCookie:l}),new Zo.InvalidOAuthError("Invalid OAuth callback.");o.debug("OAuth request is valid, requesting access token",{shop:a});let h={client_id:e.apiKey,client_secret:e.apiSecretKey,code:s.get("code")},f={path:"/admin/oauth/access_token",type:M0.DataType.JSON,data:h},w=(0,cf.sanitizeShop)(e)(s.get("shop"),!0),S=(0,k0.httpClientClass)(e),me=yield new S({domain:w}).post(f),Ke=(0,sf.createSession)({accessTokenResponse:(0,sf.accessTokenResponse)(me),shop:w,state:l,config:e});return e.isEmbeddedApp||(yield u.setAndSign(ei.SESSION_COOKIE_NAME,Ke.id,{expires:Ke.expires,sameSite:"lax",secure:!0,path:"/"})),{headers:yield(0,yt.abstractConvertHeaders)(u.response.headers,n),session:Ke}})}}ir.callback=D0;function U0({config:e,query:t,stateFromCookie:r}){return gt.__awaiter(this,void 0,void 0,function*(){return(yield(0,H0.validateHmac)(e)(t))&&(0,N0.safeCompare)(t.state,r)})}function df(e,t){if(e)throw new Zo.PrivateAppError(t)}});var Ya=d(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.buildEmbeddedAppUrl=sr.getEmbeddedAppUrl=void 0;var za=(x(),R(T)),Xa=za.__importStar(U()),K0=We(),W0=Ft(),F0=js();function j0(e){return t=>za.__awaiter(this,void 0,void 0,function*(){var r=za.__rest(t,[]);let n=yield(0,K0.abstractConvertRequest)(r);if(!n)throw new Xa.MissingRequiredArgument("getEmbeddedAppUrl requires a request object argument");if(!n.url)throw new Xa.InvalidRequestError("Request does not contain a URL");let i=new URL(n.url,`https://${n.headers.host}`).searchParams.get("host");if(typeof i!="string")throw new Xa.InvalidRequestError("Request does not contain a host query parameter");return ff(e)(i)})}sr.getEmbeddedAppUrl=j0;function ff(e){return t=>((0,W0.sanitizeHost)()(t,!0),`https://${(0,F0.decodeHost)(t)}/apps/${e.apiKey}`)}sr.buildEmbeddedAppUrl=ff});var Qa=d(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.tokenExchange=Tt.RequestedTokenType=void 0;var B0=(x(),R(T)),J0=Qo(),V0=Ft(),hf=$t(),G0=At(),mf=Ga(),X0;(function(e){e.OnlineAccessToken="urn:shopify:params:oauth:token-type:online-access-token",e.OfflineAccessToken="urn:shopify:params:oauth:token-type:offline-access-token"})(X0=Tt.RequestedTokenType||(Tt.RequestedTokenType={}));var z0="urn:ietf:params:oauth:grant-type:token-exchange",Y0="urn:ietf:params:oauth:token-type:id_token";function Q0(e){return({shop:t,sessionToken:r,requestedTokenType:n})=>B0.__awaiter(this,void 0,void 0,function*(){yield(0,J0.decodeSessionToken)(e)(r);let o={client_id:e.apiKey,client_secret:e.apiSecretKey,grant_type:z0,subject_token:r,subject_token_type:Y0,requested_token_type:n},i={path:"/admin/oauth/access_token",type:hf.DataType.JSON,data:o,extraHeaders:{Accept:hf.DataType.JSON}},s=(0,V0.sanitizeShop)(e)(t,!0),a=(0,G0.httpClientClass)(e),u=yield new a({domain:s}).post(i);return{session:(0,mf.createSession)({accessTokenResponse:(0,mf.accessTokenResponse)(u),shop:s,state:"",config:e})}})}Tt.tokenExchange=Q0});var vf=d(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.shopifyAuth=void 0;var yf=pf(),Z0=Js(),e_=xr(),gf=Ya(),t_=Qa();function r_(e){var t;let r={begin:(0,yf.begin)(e),callback:(0,yf.callback)(e),nonce:Z0.nonce,safeCompare:e_.safeCompare,getEmbeddedAppUrl:(0,gf.getEmbeddedAppUrl)(e),buildEmbeddedAppUrl:(0,gf.buildEmbeddedAppUrl)(e)};return!((t=e.future)===null||t===void 0)&&t.unstable_tokenExchange&&(r.tokenExchange=(0,t_.tokenExchange)(e)),r}ti.shopifyAuth=r_});var wf=d(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.shopifySession=void 0;var n_=Qo(),ri=Va();function o_(e){return{customAppSession:(0,ri.customAppSession)(e),getCurrentId:(0,ri.getCurrentSessionId)(e),getOfflineId:(0,ri.getOfflineId)(e),getJwtSessionId:(0,ri.getJwtSessionId)(e),decodeSessionToken:(0,n_.decodeSessionToken)(e)}}ni.shopifySession=o_});var _f=d(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.versionPriorTo=ar.versionCompatible=void 0;var i_=_e();function bf(e){return(t,r=e.apiVersion)=>{if(r===i_.ApiVersion.Unstable)return!0;let n=s=>parseInt(s.replace("-",""),10),o=n(r),i=n(t);return o>=i}}ar.versionCompatible=bf;function s_(e){return(t,r=e.apiVersion)=>!bf(e)(t,r)}ar.versionPriorTo=s_});var Af=d(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.shopifyUtils=void 0;var Ef=Ft(),a_=Fs(),Sf=_f();function c_(e){return{sanitizeShop:(0,Ef.sanitizeShop)(e),sanitizeHost:(0,Ef.sanitizeHost)(),validateHmac:(0,a_.validateHmac)(e),versionCompatible:(0,Sf.versionCompatible)(e),versionPriorTo:(0,Sf.versionPriorTo)(e)}}oi.shopifyUtils=c_});var cr=d(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.WebhookValidationErrorReason=Ie.WebhookOperation=Ie.DeliveryMethod=void 0;var u_;(function(e){e.Http="http",e.EventBridge="eventbridge",e.PubSub="pubsub"})(u_=Ie.DeliveryMethod||(Ie.DeliveryMethod={}));var l_;(function(e){e.Create="create",e.Update="update",e.Delete="delete"})(l_=Ie.WebhookOperation||(Ie.WebhookOperation={}));var d_;(function(e){e.MissingHeaders="missing_headers",e.MissingBody="missing_body",e.InvalidHmac="invalid_hmac"})(d_=Ie.WebhookValidationErrorReason||(Ie.WebhookValidationErrorReason={}))});var si=d(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.addHostToCallbackUrl=ce.handlerIdentifier=ce.getHandlers=ce.getTopicsAdded=ce.addHandlers=ce.topicForStorage=ce.registry=void 0;var Cf=U(),p_=de(),ii=cr();function f_(){return{}}ce.registry=f_;function ec(e){return e.toUpperCase().replace(/\/|\./g,"_")}ce.topicForStorage=ec;function h_(e,t){return function(n){for(let[o,i]of Object.entries(n)){let s=ec(o);if(Array.isArray(i))for(let a of i)Rf(e,t,s,a);else Rf(e,t,s,i)}}}ce.addHandlers=h_;function m_(e){return function(){return Object.keys(e)}}ce.getTopicsAdded=m_;function y_(e){return function(r){return e[ec(r)]||[]}}ce.getHandlers=y_;function Za(e,t){let r=t.deliveryMethod;switch(t.deliveryMethod){case ii.DeliveryMethod.Http:return`${r}_${Pf(e,t.callbackUrl)}`;case ii.DeliveryMethod.EventBridge:return`${r}_${t.arn}`;case ii.DeliveryMethod.PubSub:return`${r}_${t.pubSubProject}:${t.pubSubTopic}`;default:throw new Cf.InvalidDeliveryMethodError(`Unrecognized delivery method '${t.deliveryMethod}'`)}}ce.handlerIdentifier=Za;function Pf(e,t){return t.startsWith("/")?`${e.hostScheme}://${e.hostName}${t}`:t}ce.addHostToCallbackUrl=Pf;function Rf(e,t,r,n){var o,i;let s=(0,p_.logger)(e);if((o=n.includeFields)===null||o===void 0||o.sort(),(i=n.metafieldNamespaces)===null||i===void 0||i.sort(),!(r in t)){t[r]=[n];return}let a=Za(e,n);for(let c in t[r]){if(!Object.prototype.hasOwnProperty.call(t[r],c))continue;let u=t[r][c],l=Za(e,u);if(a===l)if(n.deliveryMethod===ii.DeliveryMethod.Http){s.info(`Detected multiple handlers for '${r}', webhooks.process will call them sequentially`);break}else throw new Cf.InvalidDeliveryMethodError(`Can only add multiple handlers when deliveryMethod is Http. Invalid handler: ${JSON.stringify(n)}`)}t[r].push(n)}});var Of=d(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.queryTemplate=void 0;function g_(e,t){let r=e;return Object.entries(t).forEach(([n,o])=>{r=r.replace(`{{${n}}}`,o)}),r}ai.queryTemplate=g_});var kf=d(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.TEMPLATE_MUTATION=De.TEMPLATE_GET_HANDLERS=De.register=void 0;var ur=(x(),R(T)),tc=Be(),li=U(),If=de(),v_=_e(),ui=si(),qf=Of(),re=cr();function w_(e,t){return function({session:n}){return ur.__awaiter(this,void 0,void 0,function*(){let o=(0,If.logger)(e);o.info("Registering webhooks",{shop:n.shop});let i=Object.keys(t).reduce((a,c)=>(a[c]=[],a),{}),s=yield b_(e,n);o.debug(`Existing topics: [${Object.keys(s).join(", ")}]`,{shop:n.shop});for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&(v_.gdprTopics.includes(a)||(i[a]=yield S_({config:e,session:n,topic:a,existingHandlers:s[a]||[],handlers:(0,ui.getHandlers)(t)(a)}),delete s[a]));for(let a in s){if(!Object.prototype.hasOwnProperty.call(s,a))continue;let c=(0,tc.graphqlClientClass)({config:e}),u=new c({session:n});i[a]=yield ci({config:e,client:u,topic:a,handlers:s[a],operation:re.WebhookOperation.Delete})}return i})}}De.register=w_;function b_(e,t){return ur.__awaiter(this,void 0,void 0,function*(){let r=(0,tc.graphqlClientClass)({config:e}),n=new r({session:t}),o={},i,s=null;do{let a=__(s),c=yield n.query({data:a});c.body.data.webhookSubscriptions.edges.forEach(u=>{let l=E_(u);o[u.node.topic]||(o[u.node.topic]=[]),o[u.node.topic].push(l)}),s=c.body.data.webhookSubscriptions.pageInfo.endCursor,i=c.body.data.webhookSubscriptions.pageInfo.hasNextPage}while(i);return o})}function __(e){return(0,qf.queryTemplate)(De.TEMPLATE_GET_HANDLERS,{END_CURSOR:JSON.stringify(e)})}function E_(e){var t,r;let n=e.node.endpoint,o;switch(n.__typename){case"WebhookHttpEndpoint":o={deliveryMethod:re.DeliveryMethod.Http,callbackUrl:n.callbackUrl,callback:()=>ur.__awaiter(this,void 0,void 0,function*(){})};break;case"WebhookEventBridgeEndpoint":o={deliveryMethod:re.DeliveryMethod.EventBridge,arn:n.arn};break;case"WebhookPubSubEndpoint":o={deliveryMethod:re.DeliveryMethod.PubSub,pubSubProject:n.pubSubProject,pubSubTopic:n.pubSubTopic};break}return o.id=e.node.id,o.includeFields=e.node.includeFields,o.metafieldNamespaces=e.node.metafieldNamespaces,(t=o.includeFields)===null||t===void 0||t.sort(),(r=o.metafieldNamespaces)===null||r===void 0||r.sort(),o}function S_({config:e,session:t,topic:r,existingHandlers:n,handlers:o}){return ur.__awaiter(this,void 0,void 0,function*(){let i=[],{toCreate:s,toUpdate:a,toDelete:c}=A_(e,n,o),u=(0,tc.graphqlClientClass)({config:e}),l=new u({session:t}),p=re.WebhookOperation.Create;return i=i.concat(yield ci({config:e,client:l,topic:r,operation:p,handlers:s})),p=re.WebhookOperation.Update,i=i.concat(yield ci({config:e,client:l,topic:r,operation:p,handlers:a})),p=re.WebhookOperation.Delete,i=i.concat(yield ci({config:e,client:l,topic:r,operation:p,handlers:c})),i})}function A_(e,t,r){let n=r.reduce((c,u)=>(c[(0,ui.handlerIdentifier)(e,u)]=u,c),{}),o=t.reduce((c,u)=>(c[(0,ui.handlerIdentifier)(e,u)]=u,c),{}),i=Object.assign({},n),s={},a={};for(let c in o){if(!Object.prototype.hasOwnProperty.call(o,c))continue;let u=o[c],l=n[c];c in n?(delete i[c],R_(u,l)||(s[c]=l,s[c].id=u.id)):a[c]=u}return{toCreate:Object.values(i),toUpdate:Object.values(s),toDelete:Object.values(a)}}function R_(e,t){let r=Tf(e.includeFields||[],t.includeFields||[]),n=Tf(e.metafieldNamespaces||[],t.metafieldNamespaces||[]);return r&&n}function Tf(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function ci({config:e,client:t,topic:r,handlers:n,operation:o}){return ur.__awaiter(this,void 0,void 0,function*(){let i=[];for(let s of n)i.push(yield C_({config:e,client:t,topic:r,handler:s,operation:o}));return i})}function C_({config:e,client:t,topic:r,handler:n,operation:o}){return ur.__awaiter(this,void 0,void 0,function*(){let i;(0,If.logger)(e).debug("Running webhook mutation",{topic:r,operation:o});try{let s=P_(e,r,n,o),a=yield t.query({data:s});i={deliveryMethod:n.deliveryMethod,success:O_(a.body,n,o),result:a.body,operation:o}}catch(s){if(s instanceof li.InvalidDeliveryMethodError)i={deliveryMethod:n.deliveryMethod,success:!1,result:{message:s.message},operation:o};else throw s}return i})}function P_(e,t,r,n){let o={},i;r.id?i=`id: "${r.id}"`:i=`topic: ${t}`;let s={MUTATION_NAME:Hf(r,n),IDENTIFIER:i,MUTATION_PARAMS:""};if(n!==re.WebhookOperation.Delete){switch(r.deliveryMethod){case re.DeliveryMethod.Http:o.callbackUrl=`"${(0,ui.addHostToCallbackUrl)(e,r.callbackUrl)}"`;break;case re.DeliveryMethod.EventBridge:o.arn=`"${r.arn}"`;break;case re.DeliveryMethod.PubSub:o.pubSubProject=`"${r.pubSubProject}"`,o.pubSubTopic=`"${r.pubSubTopic}"`;break;default:throw new li.InvalidDeliveryMethodError(`Unrecognized delivery method '${r.deliveryMethod}'`)}r.includeFields&&(o.includeFields=JSON.stringify(r.includeFields)),r.metafieldNamespaces&&(o.metafieldNamespaces=JSON.stringify(r.metafieldNamespaces));let a=Object.entries(o).map(([c,u])=>`${c}: ${u}`).join(", ");s.MUTATION_PARAMS=`webhookSubscription: {${a}}`}return(0,qf.queryTemplate)(De.TEMPLATE_MUTATION,s)}function Hf(e,t){switch(t){case re.WebhookOperation.Create:return`${xf(e)}Create`;case re.WebhookOperation.Update:return`${xf(e)}Update`;case re.WebhookOperation.Delete:return"webhookSubscriptionDelete";default:throw new li.ShopifyError(`Unrecognized operation '${t}'`)}}function xf(e){switch(e.deliveryMethod){case re.DeliveryMethod.Http:return"webhookSubscription";case re.DeliveryMethod.EventBridge:return"eventBridgeWebhookSubscription";case re.DeliveryMethod.PubSub:return"pubSubWebhookSubscription";default:throw new li.ShopifyError(`Unrecognized delivery method '${e.deliveryMethod}'`)}}function O_(e,t,r){let n=Hf(t,r);return Boolean(e.data&&e.data[n]&&e.data[n].userErrors.length===0)}De.TEMPLATE_GET_HANDLERS=`query shopifyApiReadWebhookSubscriptions {
  webhookSubscriptions(
    first: 250,
    after: {{END_CURSOR}},
  ) {
    edges {
      node {
        id
        topic
        includeFields
        metafieldNamespaces
        endpoint {
          __typename
          ... on WebhookHttpEndpoint {
            callbackUrl
          }
          ... on WebhookEventBridgeEndpoint {
            arn
          }
          ... on WebhookPubSubEndpoint {
            pubSubProject
            pubSubTopic
          }
        }
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}`;De.TEMPLATE_MUTATION=`
  mutation shopifyApiCreateWebhookSubscription {
    {{MUTATION_NAME}}(
      {{IDENTIFIER}},
      {{MUTATION_PARAMS}}
    ) {
      userErrors {
        field
        message
      }
    }
  }
`});var nc=d(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.validateFactory=void 0;var di=(x(),R(T)),Mf=We(),T_=_t(),x_=vt(),Qr=_e(),I_=xr(),q_=de(),rc=cr(),H_=si(),k_={apiVersion:Qr.ShopifyHeader.ApiVersion,domain:Qr.ShopifyHeader.Domain,hmac:Qr.ShopifyHeader.Hmac,topic:Qr.ShopifyHeader.Topic,webhookId:Qr.ShopifyHeader.WebhookId};function M_(e){return function(r){var{rawBody:n}=r,o=di.__rest(r,["rawBody"]);return di.__awaiter(this,void 0,void 0,function*(){let i=yield(0,Mf.abstractConvertRequest)(o),s=(0,q_.logger)(e),a=$_(n,i.headers);if(!a.valid)return yield s.debug("Received malformed webhook request",a),a;let{hmac:c,valid:u}=a,l=di.__rest(a,["hmac","valid"]);return yield s.debug("Webhook request is well formed",l),(yield N_(e.apiSecretKey,n,c))?(yield s.debug("Webhook request is valid",l),a):(yield s.debug("Webhook HMAC validation failed. Please note that events manually triggered from a store's Notifications settings will fail this validation. To test this, please use the CLI or trigger the actual event in a development store."),{valid:!1,reason:rc.WebhookValidationErrorReason.InvalidHmac})})}}pi.validateFactory=M_;function $_(e,t){if(!e.length)return{valid:!1,reason:rc.WebhookValidationErrorReason.MissingBody};let r=[],o=Object.entries(k_).reduce((i,[s,a])=>{let c=(0,Mf.getHeader)(t,a);return c?i[s]=c:r.push(a),i},{});return r.length?{valid:!1,reason:rc.WebhookValidationErrorReason.MissingHeaders,missingHeaders:r}:Object.assign(Object.assign({valid:!0},o),{topic:(0,H_.topicForStorage)(o.topic)})}function N_(e,t,r){return di.__awaiter(this,void 0,void 0,function*(){let n=yield(0,T_.createSHA256HMAC)(e,t,x_.HashFormat.Base64);return(0,I_.safeCompare)(n,r)})}});var Lf=d(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.process=void 0;var lr=(x(),R(T)),pe=Ls(),oc=We(),Nf=lr.__importStar(U()),ic=de(),fi=cr(),L_=nc(),$f={[pe.StatusCode.Ok]:"OK",[pe.StatusCode.BadRequest]:"Bad Request",[pe.StatusCode.Unauthorized]:"Unauthorized",[pe.StatusCode.NotFound]:"Not Found",[pe.StatusCode.InternalServerError]:"Internal Server Error"};function D_(e,t){return function(n){var{rawBody:o}=n,i=lr.__rest(n,["rawBody"]);return lr.__awaiter(this,void 0,void 0,function*(){let s={statusCode:pe.StatusCode.Ok,statusText:$f[pe.StatusCode.Ok],headers:{}};yield(0,ic.logger)(e).info("Receiving webhook request");let a=yield(0,L_.validateFactory)(e)(Object.assign({rawBody:o},i)),c="Unknown error while handling webhook";if(a.valid){let l=yield U_(e,t,a,o);s.statusCode=l.statusCode,(0,oc.isOK)(s)||(c=l.errorMessage||c)}else{let l=yield K_(e,a);s.statusCode=l.statusCode,s.statusText=$f[s.statusCode],c=l.errorMessage}let u=yield(0,oc.abstractConvertResponse)(s,i);if(!(0,oc.isOK)(s))throw new Nf.InvalidWebhookError({message:c,response:u});return Promise.resolve(u)})}}hi.process=D_;function U_(e,t,r,n){return lr.__awaiter(this,void 0,void 0,function*(){let o=(0,ic.logger)(e),{hmac:i,valid:s}=r,a=lr.__rest(r,["hmac","valid"]);yield o.debug("Webhook request is valid, looking for HTTP handlers to call",a);let c=t[r.topic]||[],u={statusCode:pe.StatusCode.Ok},l=!1;for(let p of c)if(p.deliveryMethod===fi.DeliveryMethod.Http){if(!p.callback)throw u.statusCode=pe.StatusCode.InternalServerError,u.errorMessage="Cannot call webhooks.process with a webhook handler that doesn't have a callback",new Nf.MissingWebhookCallbackError({message:u.errorMessage,response:u});l=!0,yield o.debug("Found HTTP handler, triggering it",a);try{yield p.callback(r.topic,r.domain,n,r.webhookId,r.apiVersion)}catch(h){u.statusCode=pe.StatusCode.InternalServerError,u.errorMessage=h.message}}return l||(yield o.debug("No HTTP handlers found",a),u.statusCode=pe.StatusCode.NotFound,u.errorMessage=`No HTTP webhooks registered for topic ${r.topic}`),u})}function K_(e,t){return lr.__awaiter(this,void 0,void 0,function*(){let r={statusCode:pe.StatusCode.InternalServerError,errorMessage:"Unknown error while handling webhook"};switch(t.reason){case fi.WebhookValidationErrorReason.MissingHeaders:r.statusCode=pe.StatusCode.BadRequest,r.errorMessage=`Missing one or more of the required HTTP headers to process webhooks: [${t.missingHeaders.join(", ")}]`;break;case fi.WebhookValidationErrorReason.MissingBody:r.statusCode=pe.StatusCode.BadRequest,r.errorMessage="No body was received when processing webhook";break;case fi.WebhookValidationErrorReason.InvalidHmac:r.statusCode=pe.StatusCode.Unauthorized,r.errorMessage="Could not validate request HMAC";break}return yield(0,ic.logger)(e).debug(`Webhook request is invalid, returning ${r.statusCode}: ${r.errorMessage}`),r})}});var Df=d(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.shopifyWebhooks=void 0;var mi=si(),W_=kf(),F_=Lf(),j_=nc();function B_(e){let t=(0,mi.registry)();return{addHandlers:(0,mi.addHandlers)(e,t),getTopicsAdded:(0,mi.getTopicsAdded)(t),getHandlers:(0,mi.getHandlers)(t),register:(0,W_.register)(e,t),process:(0,F_.process)(e,t),validate:(0,j_.validateFactory)(e)}}yi.shopifyWebhooks=B_});var Ff=d(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.check=void 0;var Uf=(x(),R(T)),J_=Be(),V_=U();function G_(e){return function({session:r,plans:n,isTest:o=!0,returnObject:i=!1}){return Uf.__awaiter(this,void 0,void 0,function*(){if(!e.billing)throw new V_.BillingError({message:"Attempted to look for purchases without billing configs",errorData:[]});let s=(0,J_.graphqlClientClass)({config:e}),a=new s({session:r}),c=Array.isArray(n)?n:[n];return X_({plans:c,client:a,isTest:o,returnObject:i})})}}gi.check=G_;function X_({plans:e,client:t,isTest:r,returnObject:n}){return Uf.__awaiter(this,void 0,void 0,function*(){let o=n?{hasActivePayment:!1,oneTimePurchases:[],appSubscriptions:[]}:!1,i,s=null;do{if(i=(yield t.query({data:{query:Q_,variables:{endCursor:s}}})).body.data.currentAppInstallation,n)i.activeSubscriptions.map(c=>{Kf({plans:e,isTest:r,subscription:c})&&(o.hasActivePayment=!0,o.appSubscriptions.push(c))}),i.oneTimePurchases.edges.map(c=>{Wf({plans:e,isTest:r,purchase:c.node})&&(o.hasActivePayment=!0,o.oneTimePurchases.push(c.node))});else{let c={plans:e,isTest:r,installation:i};if(z_(c)||Y_(c))return!0}s=i.oneTimePurchases.pageInfo.endCursor}while(i?.oneTimePurchases.pageInfo.hasNextPage);return o})}function Kf({plans:e,isTest:t,subscription:r}){return e.includes(r.name)&&(t||!r.test)}function Wf({plans:e,isTest:t,purchase:r}){return e.includes(r.name)&&(t||!r.test)&&r.status==="ACTIVE"}function z_({plans:e,isTest:t,installation:r}){return r.activeSubscriptions.some(n=>Kf({plans:e,isTest:t,subscription:n}))}function Y_({plans:e,isTest:t,installation:r}){return r.oneTimePurchases.edges.some(n=>Wf({plans:e,isTest:t,purchase:n.node}))}var Q_=`
  query appSubscription($endCursor: String) {
    currentAppInstallation {
      activeSubscriptions {
        id
        name
        test
      }

      oneTimePurchases(first: 250, sortKey: CREATED_AT, after: $endCursor) {
        edges {
          node {
            id
            name
            test
            status
          }
        }
        pageInfo {
          hasNextPage
          endCursor
        }
      }
    }
  }
`});var jf=d(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.request=void 0;var dr=(x(),R(T)),Zr=_e(),xt=U(),Z_=Ya(),eE=Be(),tE=_t(),rE=vt();function nE(e){return function(t){var r,{session:n,plan:o,isTest:i=!0,returnUrl:s,returnObject:a=!1}=t,c=dr.__rest(t,["session","plan","isTest","returnUrl","returnObject"]);return dr.__awaiter(this,void 0,void 0,function*(){if(!e.billing||!e.billing[o])throw new xt.BillingError({message:`Could not find plan ${o} in billing settings`,errorData:[]});let u=Object.assign({},e.billing[o]),l=Object.fromEntries(Object.entries(c).filter(([B,gu])=>gu!==void 0)),p=n.shop.replace(".myshopify.com",""),h=(0,Z_.buildEmbeddedAppUrl)(e)((0,tE.hashString)(`admin.shopify.com/store/${p}`,rE.HashFormat.Base64)),f=`${e.hostScheme}://${e.hostName}?shop=${n.shop}`,w=s||(e.isEmbeddedApp?h:f),S=(0,eE.graphqlClientClass)({config:e}),k=new S({session:n});function me(B){return"lineItems"in B}function Ke(B){return B.interval===Zr.BillingInterval.OneTime}let le;if(me(u)){let B=cE(u,l);le=(yield oE({billingConfig:B,plan:o,client:k,returnUrl:w,isTest:i})).data.appSubscriptionCreate}else if(Ke(u))le=(yield aE({billingConfig:Object.assign(Object.assign({},u),l),plan:o,client:k,returnUrl:w,isTest:i})).data.appPurchaseOneTimeCreate;else switch(u.interval){case Zr.BillingInterval.Usage:{le=(yield sE({billingConfig:Object.assign(Object.assign({},u),l),plan:o,client:k,returnUrl:w,isTest:i})).data.appSubscriptionCreate;break}default:le=(yield iE({billingConfig:Object.assign(Object.assign({},u),l),plan:o,client:k,returnUrl:w,isTest:i})).data.appSubscriptionCreate}if(!((r=le.userErrors)===null||r===void 0)&&r.length)throw new xt.BillingError({message:"Error while billing the store",errorData:le.userErrors});return a?le:le.confirmationUrl})}}vi.request=nE;function oE({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:o}){var i;return dr.__awaiter(this,void 0,void 0,function*(){let s=e.lineItems.map(c=>{if(c.interval===Zr.BillingInterval.Every30Days||c.interval===Zr.BillingInterval.Annual){let u={interval:c.interval,price:{amount:c.amount,currencyCode:c.currencyCode}};return c.discount&&(u.discount={durationLimitInIntervals:c.discount.durationLimitInIntervals,value:{amount:c.discount.value.amount,percentage:c.discount.value.percentage}}),{plan:{appRecurringPricingDetails:u}}}else{if(c.interval===Zr.BillingInterval.Usage)return{plan:{appUsagePricingDetails:{terms:c.terms,cappedAmount:{amount:c.amount,currencyCode:c.currencyCode}}}};throw new xt.BillingError({message:"Invalid interval provided",errorData:[c]})}}),a=yield r.query({data:{query:sc,variables:{name:t,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,returnUrl:n,test:o,lineItems:s}}});if(!((i=a.body.errors)===null||i===void 0)&&i.length)throw new xt.BillingError({message:"Error while billing the store",errorData:a.body.errors});return a.body})}function iE({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:o}){var i,s,a,c,u,l;return dr.__awaiter(this,void 0,void 0,function*(){let p=yield r.query({data:{query:sc,variables:{name:t,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,returnUrl:n,test:o,lineItems:[{plan:{appRecurringPricingDetails:{interval:e.interval,price:{amount:e.amount,currencyCode:e.currencyCode},discount:{durationLimitInIntervals:(i=e.discount)===null||i===void 0?void 0:i.durationLimitInIntervals,value:{amount:(a=(s=e.discount)===null||s===void 0?void 0:s.value)===null||a===void 0?void 0:a.amount,percentage:(u=(c=e.discount)===null||c===void 0?void 0:c.value)===null||u===void 0?void 0:u.percentage}}}}}]}}});if(!((l=p.body.errors)===null||l===void 0)&&l.length)throw new xt.BillingError({message:"Error while billing the store",errorData:p.body.errors});return p.body})}function sE({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:o}){var i;return dr.__awaiter(this,void 0,void 0,function*(){let s=yield r.query({data:{query:sc,variables:{name:t,returnUrl:n,test:o,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,lineItems:[{plan:{appUsagePricingDetails:{terms:e.usageTerms,cappedAmount:{amount:e.amount,currencyCode:e.currencyCode}}}}]}}});if(!((i=s.body.errors)===null||i===void 0)&&i.length)throw new xt.BillingError({message:`Error while billing the store:: ${s.body.errors}`,errorData:s.body.errors});return s.body})}function aE({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:o}){var i;return dr.__awaiter(this,void 0,void 0,function*(){let s=yield r.query({data:{query:uE,variables:{name:t,returnUrl:n,test:o,price:{amount:e.amount,currencyCode:e.currencyCode}}}});if(!((i=s.body.errors)===null||i===void 0)&&i.length)throw new xt.BillingError({message:"Error while billing the store",errorData:s.body.errors});return s.body})}function cE(e,t){let r=Object.assign(Object.assign({},e),t),n=[];if(e.lineItems&&t.lineItems){for(let o of e.lineItems){let i=!1;for(let s of t.lineItems)if(o.interval===s.interval){n.push(Object.assign(Object.assign({},o),s)),i=!0;break}i||n.push(o)}r.lineItems=n}return r}var sc=`
  mutation test(
    $name: String!
    $lineItems: [AppSubscriptionLineItemInput!]!
    $returnUrl: URL!
    $test: Boolean
    $trialDays: Int
    $replacementBehavior: AppSubscriptionReplacementBehavior
  ) {
    appSubscriptionCreate(
      name: $name
      lineItems: $lineItems
      returnUrl: $returnUrl
      test: $test
      trialDays: $trialDays
      replacementBehavior: $replacementBehavior
    ) {
      appSubscription {
        id
        name
        test
      }
      confirmationUrl
      userErrors {
        field
        message
      }
    }
  }
`,uE=`
  mutation test(
    $name: String!
    $price: MoneyInput!
    $returnUrl: URL!
    $test: Boolean
  ) {
    appPurchaseOneTimeCreate(
      name: $name
      price: $price
      returnUrl: $returnUrl
      test: $test
    ) {
      appPurchaseOneTime {
        id
        name
        test
      }
      confirmationUrl
      userErrors {
        field
        message
      }
    }
  }
`});var Bf=d(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.cancel=void 0;var lE=(x(),R(T)),dE=Be(),ac=U(),pE=`
  mutation appSubscriptionCancel($id: ID!, $prorate: Boolean) {
    appSubscriptionCancel(id: $id, prorate: $prorate) {
      appSubscription {
        id
        name
        test
      }
      userErrors {
        field
        message
      }
    }
  }
`;function fE(e){return function(t){var r;return lE.__awaiter(this,void 0,void 0,function*(){let{session:n,subscriptionId:o,prorate:i=!0}=t,s=(0,dE.graphqlClientClass)({config:e}),a=new s({session:n});try{let c=yield a.query({data:{query:pE,variables:{id:o,prorate:i}}});if(c.body.data.appSubscriptionCancel.userErrors.length)throw new ac.BillingError({message:"Error while canceling a subscription",errorData:c.body.data.appSubscriptionCancel.userErrors});return c.body.data.appSubscriptionCancel.appSubscription}catch(c){throw c instanceof ac.GraphqlQueryError?new ac.BillingError({message:c.message,errorData:(r=c.response)===null||r===void 0?void 0:r.errors}):c}})}}wi.cancel=fE});var Jf=d(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.subscriptions=void 0;var hE=(x(),R(T)),mE=U(),yE=Be(),gE=`
  query appSubscription {
    currentAppInstallation {
      activeSubscriptions {
        id
        name
        test
      }
  }
}
`;function vE(e){return function({session:t}){return hE.__awaiter(this,void 0,void 0,function*(){if(!e.billing)throw new mE.BillingError({message:"Attempted to look for purchases without billing configs",errorData:[]});let r=(0,yE.graphqlClientClass)({config:e});return(yield new r({session:t}).query({data:{query:gE}})).body.data.currentAppInstallation})}}bi.subscriptions=vE});var Vf=d(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.shopifyBilling=void 0;var wE=Ff(),bE=jf(),_E=Bf(),EE=Jf();function SE(e){return{check:(0,wE.check)(e),request:(0,bE.request)(e),cancel:(0,_E.cancel)(e),subscriptions:(0,EE.subscriptions)(e)}}_i.shopifyBilling=SE});var Gf=d(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.Session=void 0;var AE=go();Object.defineProperty(Ei,"Session",{enumerable:!0,get:function(){return AE.Session}})});var zf=d(Xf=>{"use strict";Object.defineProperty(Xf,"__esModule",{value:!0})});var Qf=d(Yf=>{"use strict";Object.defineProperty(Yf,"__esModule",{value:!0})});var Zf=d(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.RequestedTokenType=void 0;var RE=(x(),R(T));RE.__exportStar(Zn(),en);var CE=Qa();Object.defineProperty(en,"RequestedTokenType",{enumerable:!0,get:function(){return CE.RequestedTokenType}})});var th=d(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0})});var nh=d(rh=>{"use strict";Object.defineProperty(rh,"__esModule",{value:!0})});var ih=d(oh=>{"use strict";Object.defineProperty(oh,"__esModule",{value:!0})});var sh=d(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});var cc=(x(),R(T));cc.__exportStar($t(),tn);cc.__exportStar(nh(),tn);cc.__exportStar(ih(),tn)});var ch=d(ah=>{"use strict";Object.defineProperty(ah,"__esModule",{value:!0})});var qe=d(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.shopifyApi=void 0;var Ae=(x(),R(T)),PE=bl(),OE=Tn(),TE=_l(),xE=kl(),IE=vf(),qE=wf(),HE=Af(),kE=Df(),ME=Vf(),$E=de(),NE=Ar();Ae.__exportStar(U(),we);Ae.__exportStar(Gf(),we);Ae.__exportStar(zf(),we);Ae.__exportStar(_e(),we);Ae.__exportStar(Qf(),we);Ae.__exportStar(Zf(),we);Ae.__exportStar(th(),we);Ae.__exportStar(sh(),we);Ae.__exportStar(ch(),we);Ae.__exportStar(cr(),we);function LE(e){var{future:t}=e,r=Ae.__rest(e,["future"]);let{restResources:n}=r,o=Ae.__rest(r,["restResources"]),i=Object.assign(Object.assign({},o),{future:t}),s=(0,TE.validateConfig)(i),a={config:s,clients:(0,xE.clientClasses)(s),auth:(0,IE.shopifyAuth)(s),session:(0,qE.shopifySession)(s),utils:(0,HE.shopifyUtils)(s),webhooks:(0,kE.shopifyWebhooks)(s),billing:(0,ME.shopifyBilling)(s),logger:(0,$E.logger)(s),rest:{}};return n&&(a.rest=(0,PE.loadRestResources)({resources:n,config:s,RestClient:a.clients.Rest})),a.logger.info(`version ${NE.SHOPIFY_API_LIBRARY_VERSION}, environment ${(0,OE.abstractRuntimeString)()}`).catch(c=>console.log(c)),a}we.shopifyApi=LE});var Ai=d(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});var DE=function(e){return e.AppStore="app_store",e.SingleMerchant="single_merchant",e.ShopifyAdmin="shopify_admin",e}({}),UE=function(e){return e.MissingShop="MISSING_SHOP",e.InvalidShop="INVALID_SHOP",e}({});Si.AppDistribution=DE;Si.LoginErrorType=UE});var uh=d(uc=>{"use strict";Object.defineProperty(uc,"__esModule",{value:!0});function KE(e){let{parentHeaders:t,loaderHeaders:r,actionHeaders:n,errorHeaders:o}=e;return o&&Array.from(o.entries()).length>0?o:new Headers([...t?Array.from(t.entries()):[],...r?Array.from(r.entries()):[],...n?Array.from(n.entries()):[]])}uc.headersBoundary=KE});var lh=d(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});var WE=Ji();function FE(e){if(e.constructor.name==="ErrorResponse"||e.constructor.name==="ErrorResponseImpl")return WE.jsx("div",{dangerouslySetInnerHTML:{__html:e.data||"Handling response"}});throw e}lc.errorBoundary=FE});var dh=d(dc=>{"use strict";Object.defineProperty(dc,"__esModule",{value:!0});var jE=uh(),BE=lh(),JE={error:BE.errorBoundary,headers:jE.headersBoundary};dc.boundary=JE});var fc=d(pc=>{"use strict";Object.defineProperty(pc,"__esModule",{value:!0});var VE="2.1.0";pc.SHOPIFY_REMIX_LIBRARY_VERSION=VE});var ph=d(hc=>{"use strict";Object.defineProperty(hc,"__esModule",{value:!0});function GE({api:e,logger:t}){return async function({session:n}){return e.webhooks.register({session:n}).then(o=>(Object.entries(o).forEach(([i,s])=>{s.forEach(({success:a,...c})=>{a?t.debug("Registered webhook",{topic:i,shop:n.shop,operation:c.operation}):t.error("Failed to register webhook",{topic:i,shop:n.shop,result:JSON.stringify(c.result)})})}),o))}}hc.registerWebhooksFactory=GE});var fh=d(mc=>{"use strict";Object.defineProperty(mc,"__esModule",{value:!0});var XE=St();function zE({params:e,handleClientError:t,session:r}){return async function(n,o){var i;let s=new e.api.clients.Graphql({session:r,apiVersion:(i=o)===null||i===void 0?void 0:i.apiVersion});try{var a,c,u;let l=await s.query({data:{query:n,variables:(a=o)===null||a===void 0?void 0:a.variables},tries:(c=o)===null||c===void 0?void 0:c.tries,extraHeaders:(u=o)===null||u===void 0?void 0:u.headers});return new Response(JSON.stringify(l.body),{headers:XE.flatHeaders(l.headers)})}catch(l){throw t?await t({error:l,params:e,session:r}):l}}}mc.graphqlClientFactory=zE});var hh=d(gc=>{"use strict";Object.defineProperty(gc,"__esModule",{value:!0});function YE({params:e,handleClientError:t,session:r}){let{api:n}=e,o=new yc({params:e,handleClientError:t,session:r});if(n.rest){o.resources={};let i=QE({params:e,handleClientError:t,session:r});Object.entries(n.rest).forEach(([s,a])=>{class c extends a{}c.Client=i,Reflect.defineProperty(c,"name",{value:s}),Reflect.set(o.resources,s,c)})}return o}var yc=class{constructor({params:t,session:r,handleClientError:n}){this.session=void 0,this.params=void 0,this.handleClientError=void 0,this.params=t,this.handleClientError=n,this.session=r}async get(t){return this.makeRequest({method:"GET",...t})}async post(t){return this.makeRequest({method:"POST",...t})}async put(t){return this.makeRequest({method:"PUT",...t})}async delete(t){return this.makeRequest({method:"DELETE",...t})}async makeRequest(t){let r=new this.params.api.clients.Rest({session:this.session}),n=Reflect.get(r,"request");try{let o=await n.call(r,t);return new Response(JSON.stringify(o.body),{headers:o.headers})}catch(o){throw this.handleClientError?await this.handleClientError({error:o,session:this.session,params:this.params}):new Error(o)}}};function QE({params:e,handleClientError:t,session:r}){let{api:n}=e,o=n.clients.Rest;return class extends o{async request(s){let a=new n.clients.Rest({session:r}),c=Reflect.get(a,"request");try{return await c.call(a,s)}catch(u){throw t?await t({error:u,params:e,session:r}):new Error(u)}}}}gc.restClientFactory=YE});var rn=d(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});var ZE=fh(),eS=hh();function tS({params:e,handleClientError:t,session:r}){return{rest:eS.restClientFactory({params:e,session:r,handleClientError:t}),graphql:ZE.graphqlClientFactory({params:e,session:r,handleClientError:t})}}vc.adminClientFactory=tS});var Ci=d(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});var rS="https://cdn.shopify.com/shopifycloud/app-bridge.js",nS="X-Shopify-API-Request-Failure-Reauthorize-Url";Ri.APP_BRIDGE_URL=rS;Ri.REAUTH_URL_HEADER=nS});var Pi=d(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});var oS=Ci();function iS(e,t,r=[]){let{logger:n,config:o}=e;return function(s){let a=t.headers.get("Origin");if(a&&a!==o.appUrl){n.debug("Request comes from a different origin, adding CORS headers");let c=new Set(["Authorization","Content-Type",...r]);s.headers.set("Access-Control-Allow-Origin","*"),s.headers.set("Access-Control-Allow-Headers",[...c].join(", ")),s.headers.set("Access-Control-Expose-Headers",oS.REAUTH_URL_HEADER)}return s}}wc.ensureCORSHeadersFactory=iS});var _c=d(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});async function sS({api:e,logger:t},r,{checkAudience:n=!0}={}){t.debug("Validating session token");try{let o=await e.session.decodeSessionToken(r,{checkAudience:n});return t.debug("Session token is valid",{payload:JSON.stringify(o)}),o}catch(o){throw t.debug(`Failed to validate session token: ${o.message}`),new Response(void 0,{status:401,statusText:"Unauthorized"})}}bc.validateSessionToken=sS});var Oi=d(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});function aS(e){var t;return(t=e.headers.get("authorization"))===null||t===void 0?void 0:t.replace("Bearer ","")}Ec.getSessionTokenHeader=aS});var Ac=d(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});var cS=zn();function uS(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var lS=uS(cS);function dS({logger:e},t){if(lS.default(t.headers.get("User-Agent")))throw e.debug("Request is from a bot, skipping auth"),new Response(void 0,{status:410,statusText:"Gone"})}Sc.rejectBotRequest=dS});var Cc=d(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});var pS=Pi();function fS(e,t,r){if(t.method==="OPTIONS")throw pS.ensureCORSHeadersFactory(e,t,r)(new Response(null,{status:204,headers:{"Access-Control-Max-Age":"7200"}}))}Rc.respondToOptionsRequest=fS});var Oc=d(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});async function hS(e,t,r,n){let{api:o,config:i}=e;throw await o.auth.begin({shop:n,callbackPath:i.auth.callbackPath,isOnline:r,rawRequest:t})}Pc.beginAuth=hS});var xc=d(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});var mS=(Ye(),R(ze));function yS(e,t,r){let{api:n,config:o}=e,s=new URL(t.url).searchParams,a=n.utils.sanitizeHost(s.get("host"));throw s.set("shop",r),s.set("exitIframe",`${o.auth.path}?shop=${r}`),a&&s.set("host",a),mS.redirect(`${o.auth.exitIframePath}?${s.toString()}`)}Tc.redirectWithExitIframe=yS});var xi=d(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});var gS=Ci();function vS(e){throw new Response(void 0,{status:401,statusText:"Unauthorized",headers:mh(e)})}function mh(e){return new Headers({[gS.REAUTH_URL_HEADER]:e})}Ti.getAppBridgeHeaders=mh;Ti.redirectWithAppBridgeHeaders=vS});var pr=d(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});var wS=Oc(),bS=xc(),_S=xi();async function ES(e,t,r,n=!1){let{config:o}=e,s=new URL(t.url).searchParams.get("embedded")==="1";if(t.headers.get("authorization")){let c=new URL(o.auth.path,o.appUrl);c.searchParams.set("shop",r),_S.redirectWithAppBridgeHeaders(c.toString())}else if(s)bS.redirectWithExitIframe(e,t,r);else throw await wS.beginAuth(e,t,n,r)}Ic.redirectToAuthPage=ES});var yh=d(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});var SS=qe(),AS=pr();Ye();function RS(e,t,r){return async function(o){let{api:i,logger:s}=e;s.debug("Cancelling billing",{shop:r.shop,...o});try{return await i.billing.cancel({session:r,subscriptionId:o.subscriptionId,isTest:o.isTest,prorate:o.prorate})}catch(a){throw a instanceof SS.HttpResponseError&&a.response.code===401?(s.debug("API token was invalid, redirecting to OAuth",{shop:r.shop}),await AS.redirectToAuthPage(e,t,r.shop)):a}}}qc.cancelBillingFactory=RS});var gh=d(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});var CS=qe(),PS=pr();Ye();function OS(e,t,r){let{api:n,logger:o}=e;return async function(s){let a={shop:r.shop,plans:s.plans,isTest:s.isTest};o.debug("Checking billing for the shop",a);let c;try{c=await n.billing.check({session:r,plans:s.plans,isTest:s.isTest,returnObject:!0})}catch(u){throw u instanceof CS.HttpResponseError&&u.response.code===401?(o.debug("API token was invalid, redirecting to OAuth",a),await PS.redirectToAuthPage(e,t,r.shop)):u}if(!c.hasActivePayment)throw o.debug("Billing check failed",a),await s.onFailure(new Error("Billing check failed"));return o.debug("Billing check succeeded",a),c}}Hc.requireBillingFactory=OS});var wh=d(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});var TS=qe(),vh=(Ye(),R(ze)),xS=pr(),IS=xi();function qS(e,t,r){return async function({plan:o,isTest:i,returnUrl:s,...a}){let{api:c,logger:u}=e;u.info("Requesting billing",{shop:r.shop,plan:o,isTest:i,returnUrl:s});let l;try{l=await c.billing.request({plan:o,session:r,isTest:i,returnUrl:s,returnObject:!0,...a})}catch(p){throw p instanceof TS.HttpResponseError&&p.response.code===401?(u.debug("API token was invalid, redirecting to OAuth",{shop:r.shop}),await xS.redirectToAuthPage(e,t,r.shop)):p}throw HS(e,t,l.confirmationUrl,r.shop)}}function HS(e,t,r,n){let{config:o,logger:i}=e;i.debug("Redirecting out of app",{url:r});let s=new URL(t.url),a=s.searchParams.get("embedded")==="1";if(t.headers.get("authorization"))throw new Response(void 0,{status:401,statusText:"Unauthorized",headers:IS.getAppBridgeHeaders(r)});if(a){let u=new URLSearchParams({shop:n,host:s.searchParams.get("host"),exitIframe:r});throw vh.redirect(`${o.auth.exitIframePath}?${u.toString()}`)}else throw vh.redirect(r)}kc.requestBillingFactory=qS});var $c=d(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});var kS=qe(),MS=pr();function $S({request:e}){return async function({error:r,params:n,session:o}){throw r instanceof kS.HttpResponseError?(n.logger.debug(`Got an HTTP response error from the API: ${r.message}`,{code:r.response.code,statusText:r.response.statusText,body:JSON.stringify(r.response.body)}),r.response.code===401?await MS.redirectToAuthPage(n,e,o.shop):new Response(JSON.stringify(r.response.body),{status:r.response.code,headers:{"Content-Type":r.response.headers["Content-Type"]}})):(n.logger.debug(`Got a response error from the API: ${r.message}`),r)}}Mc.handleClientErrorFactory=$S});var _h=d(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});var NS=Ci(),bh;function LS(e){bh=e}function DS(){return bh||NS.APP_BRIDGE_URL}Ii.appBridgeUrl=DS;Ii.setAppBridgeUrlOverride=LS});var Nc=d(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});function US(e){let{api:t,config:r}=e;return function(n,o){let{searchParams:i}=new URL(n.url),s=t.utils.sanitizeShop(i.get("shop"));Eh(o,r.isEmbeddedApp,s)}}function Eh(e,t,r){r&&e.set("Link",'<https://cdn.shopify.com/shopifycloud/app-bridge.js>; rel="preload"; as="script";'),t?r&&e.set("Content-Security-Policy",`frame-ancestors https://${r} https://admin.shopify.com https://*.spin.dev;`):e.set("Content-Security-Policy","frame-ancestors 'none';")}qi.addDocumentResponseHeaders=Eh;qi.addDocumentResponseHeadersFactory=US});var Dc=d(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});var KS=_h(),WS=Nc();function FS({config:e},t,r){let n="";if(r){var o;let s=new URL(r.url,e.appUrl),a=(o=r.target)!==null&&o!==void 0?o:"_top";n=`<script>window.open(${JSON.stringify(s.toString())}, ${JSON.stringify(a)})<\/script>`}let i=new Headers({"content-type":"text/html;charset=utf-8"});throw WS.addDocumentResponseHeaders(i,e.isEmbeddedApp,new URL(t.url).searchParams.get("shop")),new Response(`
      <script data-api-key="${e.apiKey}" src="${KS.appBridgeUrl()}"><\/script>
      ${n}
    `,{headers:i})}Lc.renderAppBridge=FS});var Oh=d(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});var Sh=(Ye(),R(ze)),Rh=Oi(),Ah=Dc(),jS=xi();function BS(e,t){let{config:r}=e;return function(o,i){let{searchParams:s}=new URL(t.url),a=new URL(o,r.appUrl);(a.origin===r.appUrl||o.startsWith("/"))&&s.forEach((l,p)=>{a.searchParams.has(p)||a.searchParams.set(p,l)});let u=typeof i!="number"&&i?.target||"_self";if(u==="_self"){if(Ch(t))throw Ah.renderAppBridge(e,t,{url:a.toString(),target:u});return Sh.redirect(a.toString(),i)}else{if(JS(t))throw jS.redirectWithAppBridgeHeaders(a.toString());if(Ph(t))throw Ah.renderAppBridge(e,t,{url:a.toString(),target:u})}return Sh.redirect(o,i)}}function Ch(e){return Boolean(Rh.getSessionTokenHeader(e))&&e.headers.has("X-Shopify-Bounce")}function JS(e){let{searchParams:t}=new URL(e.url),r=e.method==="GET",n=Boolean(Rh.getSessionTokenHeader(e)),o=t.has("id_token");return n&&!o&&!Ch(e)&&(!Ph(e)||!r)}function Ph(e){let{searchParams:t}=new URL(e.url);return t.get("embedded")==="1"}Uc.redirectFactory=BS});var kh=d(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});var Hi=(Ye(),R(ze)),nn=qe(),VS=rn(),GS=Pi(),Th=_c(),XS=Oi(),zS=Ac(),YS=Cc(),QS=yh(),ZS=gh(),eA=wh(),on=Oc(),tA=$c(),xh=pr(),Ih=xc(),rA=Oh(),qh=Dc(),Hh="id_token",Kc=class{constructor({api:t,config:r,logger:n}){this.api=void 0,this.config=void 0,this.logger=void 0,this.api=t,this.config=r,this.logger=n}async authenticateAdmin(t){let{api:r,logger:n,config:o}=this;zS.rejectBotRequest({api:r,logger:n,config:o},t),YS.respondToOptionsRequest({api:r,logger:n,config:o},t);let i=GS.ensureCORSHeadersFactory({api:r,logger:n,config:o},t),s;try{s=await this.authenticateAndGetSessionContext(t)}catch(c){throw c instanceof Response&&i(c),c}let a={admin:this.createAdminApiContext(t,s.session),billing:this.createBillingContext(t,s.session),session:s.session,cors:i};return o.isEmbeddedApp?{...a,sessionToken:s.token,redirect:rA.redirectFactory({api:r,config:o,logger:n},t)}:a}async authenticateAndGetSessionContext(t){let{api:r,logger:n,config:o}=this,i={api:r,logger:n,config:o},s=new URL(t.url),a=s.pathname===o.auth.patchSessionTokenPath,c=s.pathname===o.auth.exitIframePath,u=s.pathname===o.auth.path,l=s.pathname===o.auth.callbackPath,p=XS.getSessionTokenHeader(t);if(n.info("Authenticating admin request"),a)throw n.debug("Rendering bounce page"),qh.renderAppBridge(i,t);if(c){let h=s.searchParams.get("exitIframe");throw n.debug("Rendering exit iframe page",{destination:h}),qh.renderAppBridge(i,t,{url:h})}else{if(l)throw await this.handleAuthCallbackRequest(t);if(u)throw await this.handleAuthBeginRequest(t);if(p){let h=await Th.validateSessionToken({api:r,logger:n,config:o},p);return this.validateAuthenticatedSession(t,h)}else return await this.validateUrlParams(t),await this.ensureInstalledOnShop(t),await this.ensureAppIsEmbeddedIfRequired(t),await this.ensureSessionTokenSearchParamIfRequired(t),this.ensureSessionExists(t)}}async handleAuthBeginRequest(t){let{api:r,config:n,logger:o}=this;o.info("Handling OAuth begin request");let i=this.ensureValidShopParam(t);throw o.debug("OAuth request contained valid shop",{shop:i}),n.isEmbeddedApp&&t.headers.get("Sec-Fetch-Dest")==="iframe"?(o.debug("Auth request in iframe detected, exiting iframe",{shop:i}),Ih.redirectWithExitIframe({api:r,config:n,logger:o},t,i)):await on.beginAuth({api:r,config:n,logger:o},t,!1,i)}async handleAuthCallbackRequest(t){let{api:r,config:n,logger:o}=this;o.info("Handling OAuth callback request");let i=this.ensureValidShopParam(t);try{let{session:s,headers:a}=await r.auth.callback({rawRequest:t});throw await n.sessionStorage.storeSession(s),n.useOnlineTokens&&!s.isOnline&&(o.info("Requesting online access token for offline session"),await on.beginAuth({api:r,config:n,logger:o},t,!0,i)),n.hooks.afterAuth&&(o.info("Running afterAuth hook"),await n.hooks.afterAuth({session:s,admin:this.createAdminApiContext(t,s)})),await this.redirectToShopifyOrAppRoot(t,a)}catch(s){throw s instanceof Response?s:(o.error("Error during OAuth callback",{error:s.message}),s instanceof nn.CookieNotFound?await this.handleAuthBeginRequest(t):s instanceof nn.InvalidHmacError||s instanceof nn.InvalidOAuthError?new Response(void 0,{status:400,statusText:"Invalid OAuth Request"}):new Response(void 0,{status:500,statusText:"Internal Server Error"}))}}async validateUrlParams(t){let{api:r,config:n,logger:o}=this;if(n.isEmbeddedApp){let i=new URL(t.url),s=r.utils.sanitizeShop(i.searchParams.get("shop"));if(!s)throw o.debug("Missing or invalid shop, redirecting to login path",{shop:s}),Hi.redirect(n.auth.loginPath);if(!r.utils.sanitizeHost(i.searchParams.get("host")))throw o.debug("Invalid host, redirecting to login path",{host:i.searchParams.get("host")}),Hi.redirect(n.auth.loginPath)}}async ensureInstalledOnShop(t){let{api:r,config:n,logger:o}=this,i=new URL(t.url),s=i.searchParams.get("shop"),a=i.searchParams.get("embedded")==="1";o.debug("Ensuring app is installed on shop",{shop:s});let c=s?r.session.getOfflineId(s):await r.session.getCurrentId({isOnline:!1,rawRequest:t});if(!c)throw o.info("Could not find a shop, can't authenticate request"),new Response(void 0,{status:400,statusText:"Bad Request"});let u=await n.sessionStorage.loadSession(c);if(!u)if(o.info("Shop hasn't installed app yet, redirecting to OAuth",{shop:s}),a)Ih.redirectWithExitIframe({api:r,config:n,logger:o},t,s);else throw await on.beginAuth({api:r,config:n,logger:o},t,!1,s);if(s=s||u.shop,n.isEmbeddedApp&&!a)try{o.debug("Ensuring offline session is valid before embedding",{shop:s}),await this.testSession(u),o.debug("Offline session is still valid, embedding app",{shop:s})}catch(l){if(l instanceof nn.HttpResponseError){if(l.response.code===401)throw o.info("Shop session is no longer valid, redirecting to OAuth",{shop:s}),await on.beginAuth({api:r,config:n,logger:o},t,!1,s);{let p=JSON.stringify(l.response.body,null,2);throw o.error(`Unexpected error during session validation: ${p}`,{shop:s}),new Response(void 0,{status:l.response.code,statusText:l.response.statusText})}}else if(l instanceof nn.GraphqlQueryError){let p={shop:s};throw l.response&&(p.response=JSON.stringify(l.response)),o.error(`Unexpected error during session validation: ${l.message}`,p),new Response(void 0,{status:500,statusText:"Internal Server Error"})}}}async testSession(t){let{api:r}=this;await new r.clients.Graphql({session:t}).query({data:`#graphql
        query shopifyAppShopName {
          shop {
            name
          }
        }
      `})}ensureValidShopParam(t){let r=new URL(t.url),{api:n}=this,o=n.utils.sanitizeShop(r.searchParams.get("shop"));if(!o)throw new Response("Shop param is invalid",{status:400});return o}async ensureAppIsEmbeddedIfRequired(t){let{api:r,logger:n}=this,o=new URL(t.url),i=o.searchParams.get("shop");r.config.isEmbeddedApp&&o.searchParams.get("embedded")!=="1"&&(n.debug("App is not embedded, redirecting to Shopify",{shop:i}),await this.redirectToShopifyOrAppRoot(t))}async ensureSessionTokenSearchParamIfRequired(t){let{api:r,logger:n}=this,o=new URL(t.url),i=o.searchParams.get("shop"),s=o.searchParams.get(Hh);r.config.isEmbeddedApp&&!s&&(n.debug("Missing session token in search params, going to bounce page",{shop:i}),this.redirectToBouncePage(o))}async ensureSessionExists(t){let{api:r,config:n,logger:o}=this,i=new URL(t.url),s=i.searchParams.get("shop"),a=i.searchParams.get(Hh);if(r.config.isEmbeddedApp){o.debug("Session token is present in query params, validating session",{shop:s});let c=await Th.validateSessionToken({api:r,config:n,logger:o},a);return this.validateAuthenticatedSession(t,c)}else{let c=await r.session.getCurrentId({isOnline:n.useOnlineTokens,rawRequest:t});if(!c)throw o.debug("Session id not found in cookies, redirecting to OAuth",{shop:s}),await on.beginAuth({api:r,config:n,logger:o},t,!1,s);return{session:await this.loadSession(t,s,c)}}}async validateAuthenticatedSession(t,r){let{config:n,logger:o,api:i}=this,a=new URL(r.dest).hostname,c=n.useOnlineTokens?i.session.getJwtSessionId(a,r.sub):i.session.getOfflineId(a),u=await this.loadSession(t,a,c);return o.debug("Found session, request is valid",{shop:a}),{session:u,token:r}}async loadSession(t,r,n){let{api:o,config:i,logger:s}=this;s.debug("Loading session from storage",{sessionId:n});let a=await i.sessionStorage.loadSession(n);return a?a.isActive(i.scopes)||(s.debug("Found a session, but it has expired, redirecting to OAuth",{shop:r}),await xh.redirectToAuthPage({api:o,config:i,logger:s},t,r)):(s.debug("No session found, redirecting to OAuth",{shop:r}),await xh.redirectToAuthPage({api:o,config:i,logger:s},t,r)),a}async redirectToShopifyOrAppRoot(t,r){let{api:n}=this,o=new URL(t.url),i=n.utils.sanitizeHost(o.searchParams.get("host")),s=n.utils.sanitizeShop(o.searchParams.get("shop")),a=n.config.isEmbeddedApp?await n.auth.getEmbeddedAppUrl({rawRequest:t}):`/?shop=${s}&host=${encodeURIComponent(i)}`;throw Hi.redirect(a,{headers:r})}redirectToBouncePage(t){let{config:r}=this;throw t.searchParams.set("shopify-reload",`${r.appUrl}${t.pathname}${t.search}`),Hi.redirect(`${r.auth.patchSessionTokenPath}${t.search}`)}createBillingContext(t,r){let{api:n,logger:o,config:i}=this;return{require:ZS.requireBillingFactory({api:n,logger:o,config:i},t,r),request:eA.requestBillingFactory({api:n,logger:o,config:i},t,r),cancel:QS.cancelBillingFactory({api:n,logger:o,config:i},t,r)}}createAdminApiContext(t,r){return VS.adminClientFactory({session:r,params:{api:this.api,config:this.config,logger:this.logger},handleClientError:tA.handleClientErrorFactory({request:t})})}};Wc.AuthStrategy=Kc});var Mh=d(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});var nA=rn();St();var oA=$c();Ye();function iA(e){let{api:t,config:r,logger:n}=e;return async function(i){if(i.method!=="POST")throw n.debug("Received a non-POST request for a webhook. Only POST requests are allowed.",{url:i.url,method:i.method}),new Response(void 0,{status:405,statusText:"Method not allowed"});let s=await i.text(),a=await t.webhooks.validate({rawBody:s,rawRequest:i});if(!a.valid)throw n.debug("Webhook validation failed",a),new Response(void 0,{status:400,statusText:"Bad Request"});let c=t.session.getOfflineId(a.domain),u=await r.sessionStorage.loadSession(c),l={apiVersion:a.apiVersion,shop:a.domain,topic:a.topic,webhookId:a.webhookId,payload:JSON.parse(s),session:void 0,admin:void 0};if(!u)return l;let p;if(r.future.v3_webhookAdminContext)p=nA.adminClientFactory({params:e,session:u,handleClientError:oA.handleClientErrorFactory({request:i})});else{let h=new t.clients.Rest({session:u,apiVersion:a.apiVersion}),f=new t.clients.Graphql({session:u,apiVersion:a.apiVersion});Object.entries(t.rest).forEach(([w,S])=>{Reflect.set(h,w,S)}),p={rest:h,graphql:f}}return{...l,session:u,admin:p}}}Fc.authenticateWebhookFactory=iA});var sn=d((EM,$h)=>{var sA="2.0.0",aA=Number.MAX_SAFE_INTEGER||9007199254740991,cA=16,uA=256-6,lA=["major","premajor","minor","preminor","patch","prepatch","prerelease"];$h.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:cA,MAX_SAFE_BUILD_LENGTH:uA,MAX_SAFE_INTEGER:aA,RELEASE_TYPES:lA,SEMVER_SPEC_VERSION:sA,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var an=d((SM,Nh)=>{var dA=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};Nh.exports=dA});var fr=d((Ue,Lh)=>{var{MAX_SAFE_COMPONENT_LENGTH:jc,MAX_SAFE_BUILD_LENGTH:pA,MAX_LENGTH:fA}=sn(),hA=an();Ue=Lh.exports={};var mA=Ue.re=[],yA=Ue.safeRe=[],g=Ue.src=[],gA=Ue.safeSrc=[],v=Ue.t={},vA=0,Bc="[a-zA-Z0-9-]",wA=[["\\s",1],["\\d",fA],[Bc,pA]],bA=e=>{for(let[t,r]of wA)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},C=(e,t,r)=>{let n=bA(t),o=vA++;hA(e,o,t),v[e]=o,g[o]=t,gA[o]=n,mA[o]=new RegExp(t,r?"g":void 0),yA[o]=new RegExp(n,r?"g":void 0)};C("NUMERICIDENTIFIER","0|[1-9]\\d*");C("NUMERICIDENTIFIERLOOSE","\\d+");C("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Bc}*`);C("MAINVERSION",`(${g[v.NUMERICIDENTIFIER]})\\.(${g[v.NUMERICIDENTIFIER]})\\.(${g[v.NUMERICIDENTIFIER]})`);C("MAINVERSIONLOOSE",`(${g[v.NUMERICIDENTIFIERLOOSE]})\\.(${g[v.NUMERICIDENTIFIERLOOSE]})\\.(${g[v.NUMERICIDENTIFIERLOOSE]})`);C("PRERELEASEIDENTIFIER",`(?:${g[v.NUMERICIDENTIFIER]}|${g[v.NONNUMERICIDENTIFIER]})`);C("PRERELEASEIDENTIFIERLOOSE",`(?:${g[v.NUMERICIDENTIFIERLOOSE]}|${g[v.NONNUMERICIDENTIFIER]})`);C("PRERELEASE",`(?:-(${g[v.PRERELEASEIDENTIFIER]}(?:\\.${g[v.PRERELEASEIDENTIFIER]})*))`);C("PRERELEASELOOSE",`(?:-?(${g[v.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${g[v.PRERELEASEIDENTIFIERLOOSE]})*))`);C("BUILDIDENTIFIER",`${Bc}+`);C("BUILD",`(?:\\+(${g[v.BUILDIDENTIFIER]}(?:\\.${g[v.BUILDIDENTIFIER]})*))`);C("FULLPLAIN",`v?${g[v.MAINVERSION]}${g[v.PRERELEASE]}?${g[v.BUILD]}?`);C("FULL",`^${g[v.FULLPLAIN]}$`);C("LOOSEPLAIN",`[v=\\s]*${g[v.MAINVERSIONLOOSE]}${g[v.PRERELEASELOOSE]}?${g[v.BUILD]}?`);C("LOOSE",`^${g[v.LOOSEPLAIN]}$`);C("GTLT","((?:<|>)?=?)");C("XRANGEIDENTIFIERLOOSE",`${g[v.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);C("XRANGEIDENTIFIER",`${g[v.NUMERICIDENTIFIER]}|x|X|\\*`);C("XRANGEPLAIN",`[v=\\s]*(${g[v.XRANGEIDENTIFIER]})(?:\\.(${g[v.XRANGEIDENTIFIER]})(?:\\.(${g[v.XRANGEIDENTIFIER]})(?:${g[v.PRERELEASE]})?${g[v.BUILD]}?)?)?`);C("XRANGEPLAINLOOSE",`[v=\\s]*(${g[v.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[v.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[v.XRANGEIDENTIFIERLOOSE]})(?:${g[v.PRERELEASELOOSE]})?${g[v.BUILD]}?)?)?`);C("XRANGE",`^${g[v.GTLT]}\\s*${g[v.XRANGEPLAIN]}$`);C("XRANGELOOSE",`^${g[v.GTLT]}\\s*${g[v.XRANGEPLAINLOOSE]}$`);C("COERCEPLAIN",`(^|[^\\d])(\\d{1,${jc}})(?:\\.(\\d{1,${jc}}))?(?:\\.(\\d{1,${jc}}))?`);C("COERCE",`${g[v.COERCEPLAIN]}(?:$|[^\\d])`);C("COERCEFULL",g[v.COERCEPLAIN]+`(?:${g[v.PRERELEASE]})?(?:${g[v.BUILD]})?(?:$|[^\\d])`);C("COERCERTL",g[v.COERCE],!0);C("COERCERTLFULL",g[v.COERCEFULL],!0);C("LONETILDE","(?:~>?)");C("TILDETRIM",`(\\s*)${g[v.LONETILDE]}\\s+`,!0);Ue.tildeTrimReplace="$1~";C("TILDE",`^${g[v.LONETILDE]}${g[v.XRANGEPLAIN]}$`);C("TILDELOOSE",`^${g[v.LONETILDE]}${g[v.XRANGEPLAINLOOSE]}$`);C("LONECARET","(?:\\^)");C("CARETTRIM",`(\\s*)${g[v.LONECARET]}\\s+`,!0);Ue.caretTrimReplace="$1^";C("CARET",`^${g[v.LONECARET]}${g[v.XRANGEPLAIN]}$`);C("CARETLOOSE",`^${g[v.LONECARET]}${g[v.XRANGEPLAINLOOSE]}$`);C("COMPARATORLOOSE",`^${g[v.GTLT]}\\s*(${g[v.LOOSEPLAIN]})$|^$`);C("COMPARATOR",`^${g[v.GTLT]}\\s*(${g[v.FULLPLAIN]})$|^$`);C("COMPARATORTRIM",`(\\s*)${g[v.GTLT]}\\s*(${g[v.LOOSEPLAIN]}|${g[v.XRANGEPLAIN]})`,!0);Ue.comparatorTrimReplace="$1$2$3";C("HYPHENRANGE",`^\\s*(${g[v.XRANGEPLAIN]})\\s+-\\s+(${g[v.XRANGEPLAIN]})\\s*$`);C("HYPHENRANGELOOSE",`^\\s*(${g[v.XRANGEPLAINLOOSE]})\\s+-\\s+(${g[v.XRANGEPLAINLOOSE]})\\s*$`);C("STAR","(<|>)?=?\\s*\\*");C("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");C("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ki=d((AM,Dh)=>{var _A=Object.freeze({loose:!0}),EA=Object.freeze({}),SA=e=>e?typeof e!="object"?_A:e:EA;Dh.exports=SA});var Jc=d((RM,Wh)=>{var Uh=/^[0-9]+$/,Kh=(e,t)=>{let r=Uh.test(e),n=Uh.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1},AA=(e,t)=>Kh(t,e);Wh.exports={compareIdentifiers:Kh,rcompareIdentifiers:AA}});var ue=d((CM,Jh)=>{var Mi=an(),{MAX_LENGTH:Fh,MAX_SAFE_INTEGER:$i}=sn(),{safeRe:jh,safeSrc:Bh,t:Ni}=fr(),RA=ki(),{compareIdentifiers:hr}=Jc(),Ee=class{constructor(t,r){if(r=RA(r),t instanceof Ee){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Fh)throw new TypeError(`version is longer than ${Fh} characters`);Mi("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=t.trim().match(r.loose?jh[Ni.LOOSE]:jh[Ni.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>$i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>$i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>$i||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(o=>{if(/^[0-9]+$/.test(o)){let i=+o;if(i>=0&&i<$i)return i}return o}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Mi("SemVer.compare",this.version,this.options,t),!(t instanceof Ee)){if(typeof t=="string"&&t===this.version)return 0;t=new Ee(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof Ee||(t=new Ee(t,this.options)),hr(this.major,t.major)||hr(this.minor,t.minor)||hr(this.patch,t.patch)}comparePre(t){if(t instanceof Ee||(t=new Ee(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],o=t.prerelease[r];if(Mi("prerelease compare",r,n,o),n===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(n===void 0)return-1;if(n===o)continue;return hr(n,o)}while(++r)}compareBuild(t){t instanceof Ee||(t=new Ee(t,this.options));let r=0;do{let n=this.build[r],o=t.build[r];if(Mi("build compare",r,n,o),n===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(n===void 0)return-1;if(n===o)continue;return hr(n,o)}while(++r)}inc(t,r,n){if(t.startsWith("pre")){if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(r){let o=new RegExp(`^${this.options.loose?Bh[Ni.PRERELEASELOOSE]:Bh[Ni.PRERELEASE]}$`),i=`-${r}`.match(o);if(!i||i[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let o=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[o];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(o)}}if(r){let i=[r,o];n===!1&&(i=[r]),hr(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Jh.exports=Ee});var It=d((PM,Gh)=>{var Vh=ue(),CA=(e,t,r=!1)=>{if(e instanceof Vh)return e;try{return new Vh(e,t)}catch(n){if(!r)return null;throw n}};Gh.exports=CA});var zh=d((OM,Xh)=>{var PA=It(),OA=(e,t)=>{let r=PA(e,t);return r?r.version:null};Xh.exports=OA});var Qh=d((TM,Yh)=>{var TA=It(),xA=(e,t)=>{let r=TA(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};Yh.exports=xA});var tm=d((xM,em)=>{var Zh=ue(),IA=(e,t,r,n,o)=>{typeof r=="string"&&(o=n,n=r,r=void 0);try{return new Zh(e instanceof Zh?e.version:e,r).inc(t,n,o).version}catch{return null}};em.exports=IA});var om=d((IM,nm)=>{var rm=It(),qA=(e,t)=>{let r=rm(e,null,!0),n=rm(t,null,!0),o=r.compare(n);if(o===0)return null;let i=o>0,s=i?r:n,a=i?n:r,c=!!s.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(a.compareMain(s)===0)return a.minor&&!a.patch?"minor":"patch"}let l=c?"pre":"";return r.major!==n.major?l+"major":r.minor!==n.minor?l+"minor":r.patch!==n.patch?l+"patch":"prerelease"};nm.exports=qA});var sm=d((qM,im)=>{var HA=ue(),kA=(e,t)=>new HA(e,t).major;im.exports=kA});var cm=d((HM,am)=>{var MA=ue(),$A=(e,t)=>new MA(e,t).minor;am.exports=$A});var lm=d((kM,um)=>{var NA=ue(),LA=(e,t)=>new NA(e,t).patch;um.exports=LA});var pm=d((MM,dm)=>{var DA=It(),UA=(e,t)=>{let r=DA(e,t);return r&&r.prerelease.length?r.prerelease:null};dm.exports=UA});var Re=d(($M,hm)=>{var fm=ue(),KA=(e,t,r)=>new fm(e,r).compare(new fm(t,r));hm.exports=KA});var ym=d((NM,mm)=>{var WA=Re(),FA=(e,t,r)=>WA(t,e,r);mm.exports=FA});var vm=d((LM,gm)=>{var jA=Re(),BA=(e,t)=>jA(e,t,!0);gm.exports=BA});var Li=d((DM,bm)=>{var wm=ue(),JA=(e,t,r)=>{let n=new wm(e,r),o=new wm(t,r);return n.compare(o)||n.compareBuild(o)};bm.exports=JA});var Em=d((UM,_m)=>{var VA=Li(),GA=(e,t)=>e.sort((r,n)=>VA(r,n,t));_m.exports=GA});var Am=d((KM,Sm)=>{var XA=Li(),zA=(e,t)=>e.sort((r,n)=>XA(n,r,t));Sm.exports=zA});var cn=d((WM,Rm)=>{var YA=Re(),QA=(e,t,r)=>YA(e,t,r)>0;Rm.exports=QA});var Di=d((FM,Cm)=>{var ZA=Re(),eR=(e,t,r)=>ZA(e,t,r)<0;Cm.exports=eR});var Vc=d((jM,Pm)=>{var tR=Re(),rR=(e,t,r)=>tR(e,t,r)===0;Pm.exports=rR});var Gc=d((BM,Om)=>{var nR=Re(),oR=(e,t,r)=>nR(e,t,r)!==0;Om.exports=oR});var Ui=d((JM,Tm)=>{var iR=Re(),sR=(e,t,r)=>iR(e,t,r)>=0;Tm.exports=sR});var Ki=d((VM,xm)=>{var aR=Re(),cR=(e,t,r)=>aR(e,t,r)<=0;xm.exports=cR});var Xc=d((GM,Im)=>{var uR=Vc(),lR=Gc(),dR=cn(),pR=Ui(),fR=Di(),hR=Ki(),mR=(e,t,r,n)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return uR(e,r,n);case"!=":return lR(e,r,n);case">":return dR(e,r,n);case">=":return pR(e,r,n);case"<":return fR(e,r,n);case"<=":return hR(e,r,n);default:throw new TypeError(`Invalid operator: ${t}`)}};Im.exports=mR});var Hm=d((XM,qm)=>{var yR=ue(),gR=It(),{safeRe:Wi,t:Fi}=fr(),vR=(e,t)=>{if(e instanceof yR)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let r=null;if(!t.rtl)r=e.match(t.includePrerelease?Wi[Fi.COERCEFULL]:Wi[Fi.COERCE]);else{let c=t.includePrerelease?Wi[Fi.COERCERTLFULL]:Wi[Fi.COERCERTL],u;for(;(u=c.exec(e))&&(!r||r.index+r[0].length!==e.length);)(!r||u.index+u[0].length!==r.index+r[0].length)&&(r=u),c.lastIndex=u.index+u[1].length+u[2].length;c.lastIndex=-1}if(r===null)return null;let n=r[2],o=r[3]||"0",i=r[4]||"0",s=t.includePrerelease&&r[5]?`-${r[5]}`:"",a=t.includePrerelease&&r[6]?`+${r[6]}`:"";return gR(`${n}.${o}.${i}${s}${a}`,t)};qm.exports=vR});var Mm=d((zM,km)=>{var zc=class{constructor(){this.max=1e3,this.map=new Map}get(t){let r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){let o=this.map.keys().next().value;this.delete(o)}this.map.set(t,r)}return this}};km.exports=zc});var Ce=d((YM,Dm)=>{var wR=/\s+/g,qt=class{constructor(t,r){if(r=_R(r),t instanceof qt)return t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease?t:new qt(t.raw,r);if(t instanceof Yc)return this.raw=t.value,this.set=[[t]],this.formatted=void 0,this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=t.trim().replace(wR," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(o=>!Nm(o[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let o of this.set)if(o.length===1&&OR(o[0])){this.set=[o];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let t=0;t<this.set.length;t++){t>0&&(this.formatted+="||");let r=this.set[t];for(let n=0;n<r.length;n++)n>0&&(this.formatted+=" "),this.formatted+=r[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(t){let n=((this.options.includePrerelease&&CR)|(this.options.loose&&PR))+":"+t,o=$m.get(n);if(o)return o;let i=this.options.loose,s=i?be[fe.HYPHENRANGELOOSE]:be[fe.HYPHENRANGE];t=t.replace(s,LR(this.options.includePrerelease)),W("hyphen replace",t),t=t.replace(be[fe.COMPARATORTRIM],SR),W("comparator trim",t),t=t.replace(be[fe.TILDETRIM],AR),W("tilde trim",t),t=t.replace(be[fe.CARETTRIM],RR),W("caret trim",t);let a=t.split(" ").map(p=>TR(p,this.options)).join(" ").split(/\s+/).map(p=>NR(p,this.options));i&&(a=a.filter(p=>(W("loose invalid filter",p,this.options),!!p.match(be[fe.COMPARATORLOOSE])))),W("range list",a);let c=new Map,u=a.map(p=>new Yc(p,this.options));for(let p of u){if(Nm(p))return[p];c.set(p.value,p)}c.size>1&&c.has("")&&c.delete("");let l=[...c.values()];return $m.set(n,l),l}intersects(t,r){if(!(t instanceof qt))throw new TypeError("a Range is required");return this.set.some(n=>Lm(n,r)&&t.set.some(o=>Lm(o,r)&&n.every(i=>o.every(s=>i.intersects(s,r)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new ER(t,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(DR(this.set[r],t,this.options))return!0;return!1}};Dm.exports=qt;var bR=Mm(),$m=new bR,_R=ki(),Yc=un(),W=an(),ER=ue(),{safeRe:be,t:fe,comparatorTrimReplace:SR,tildeTrimReplace:AR,caretTrimReplace:RR}=fr(),{FLAG_INCLUDE_PRERELEASE:CR,FLAG_LOOSE:PR}=sn(),Nm=e=>e.value==="<0.0.0-0",OR=e=>e.value==="",Lm=(e,t)=>{let r=!0,n=e.slice(),o=n.pop();for(;r&&n.length;)r=n.every(i=>o.intersects(i,t)),o=n.pop();return r},TR=(e,t)=>(W("comp",e,t),e=qR(e,t),W("caret",e),e=xR(e,t),W("tildes",e),e=kR(e,t),W("xrange",e),e=$R(e,t),W("stars",e),e),he=e=>!e||e.toLowerCase()==="x"||e==="*",xR=(e,t)=>e.trim().split(/\s+/).map(r=>IR(r,t)).join(" "),IR=(e,t)=>{let r=t.loose?be[fe.TILDELOOSE]:be[fe.TILDE];return e.replace(r,(n,o,i,s,a)=>{W("tilde",e,n,o,i,s,a);let c;return he(o)?c="":he(i)?c=`>=${o}.0.0 <${+o+1}.0.0-0`:he(s)?c=`>=${o}.${i}.0 <${o}.${+i+1}.0-0`:a?(W("replaceTilde pr",a),c=`>=${o}.${i}.${s}-${a} <${o}.${+i+1}.0-0`):c=`>=${o}.${i}.${s} <${o}.${+i+1}.0-0`,W("tilde return",c),c})},qR=(e,t)=>e.trim().split(/\s+/).map(r=>HR(r,t)).join(" "),HR=(e,t)=>{W("caret",e,t);let r=t.loose?be[fe.CARETLOOSE]:be[fe.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,(o,i,s,a,c)=>{W("caret",e,o,i,s,a,c);let u;return he(i)?u="":he(s)?u=`>=${i}.0.0${n} <${+i+1}.0.0-0`:he(a)?i==="0"?u=`>=${i}.${s}.0${n} <${i}.${+s+1}.0-0`:u=`>=${i}.${s}.0${n} <${+i+1}.0.0-0`:c?(W("replaceCaret pr",c),i==="0"?s==="0"?u=`>=${i}.${s}.${a}-${c} <${i}.${s}.${+a+1}-0`:u=`>=${i}.${s}.${a}-${c} <${i}.${+s+1}.0-0`:u=`>=${i}.${s}.${a}-${c} <${+i+1}.0.0-0`):(W("no pr"),i==="0"?s==="0"?u=`>=${i}.${s}.${a}${n} <${i}.${s}.${+a+1}-0`:u=`>=${i}.${s}.${a}${n} <${i}.${+s+1}.0-0`:u=`>=${i}.${s}.${a} <${+i+1}.0.0-0`),W("caret return",u),u})},kR=(e,t)=>(W("replaceXRanges",e,t),e.split(/\s+/).map(r=>MR(r,t)).join(" ")),MR=(e,t)=>{e=e.trim();let r=t.loose?be[fe.XRANGELOOSE]:be[fe.XRANGE];return e.replace(r,(n,o,i,s,a,c)=>{W("xRange",e,n,o,i,s,a,c);let u=he(i),l=u||he(s),p=l||he(a),h=p;return o==="="&&h&&(o=""),c=t.includePrerelease?"-0":"",u?o===">"||o==="<"?n="<0.0.0-0":n="*":o&&h?(l&&(s=0),a=0,o===">"?(o=">=",l?(i=+i+1,s=0,a=0):(s=+s+1,a=0)):o==="<="&&(o="<",l?i=+i+1:s=+s+1),o==="<"&&(c="-0"),n=`${o+i}.${s}.${a}${c}`):l?n=`>=${i}.0.0${c} <${+i+1}.0.0-0`:p&&(n=`>=${i}.${s}.0${c} <${i}.${+s+1}.0-0`),W("xRange return",n),n})},$R=(e,t)=>(W("replaceStars",e,t),e.trim().replace(be[fe.STAR],"")),NR=(e,t)=>(W("replaceGTE0",e,t),e.trim().replace(be[t.includePrerelease?fe.GTE0PRE:fe.GTE0],"")),LR=e=>(t,r,n,o,i,s,a,c,u,l,p,h)=>(he(n)?r="":he(o)?r=`>=${n}.0.0${e?"-0":""}`:he(i)?r=`>=${n}.${o}.0${e?"-0":""}`:s?r=`>=${r}`:r=`>=${r}${e?"-0":""}`,he(u)?c="":he(l)?c=`<${+u+1}.0.0-0`:he(p)?c=`<${u}.${+l+1}.0-0`:h?c=`<=${u}.${l}.${p}-${h}`:e?c=`<${u}.${l}.${+p+1}-0`:c=`<=${c}`,`${r} ${c}`.trim()),DR=(e,t,r)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let n=0;n<e.length;n++)if(W(e[n].semver),e[n].semver!==Yc.ANY&&e[n].semver.prerelease.length>0){let o=e[n].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}});var un=d((QM,Bm)=>{var ln=Symbol("SemVer ANY"),mr=class{static get ANY(){return ln}constructor(t,r){if(r=Um(r),t instanceof mr){if(t.loose===!!r.loose)return t;t=t.value}t=t.trim().split(/\s+/).join(" "),Zc("comparator",t,r),this.options=r,this.loose=!!r.loose,this.parse(t),this.semver===ln?this.value="":this.value=this.operator+this.semver.version,Zc("comp",this)}parse(t){let r=this.options.loose?Km[Wm.COMPARATORLOOSE]:Km[Wm.COMPARATOR],n=t.match(r);if(!n)throw new TypeError(`Invalid comparator: ${t}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Fm(n[2],this.options.loose):this.semver=ln}toString(){return this.value}test(t){if(Zc("Comparator.test",t,this.options.loose),this.semver===ln||t===ln)return!0;if(typeof t=="string")try{t=new Fm(t,this.options)}catch{return!1}return Qc(t,this.operator,this.semver,this.options)}intersects(t,r){if(!(t instanceof mr))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new jm(t.value,r).test(this.value):t.operator===""?t.value===""?!0:new jm(this.value,r).test(t.semver):(r=Um(r),r.includePrerelease&&(this.value==="<0.0.0-0"||t.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&t.operator.startsWith(">")||this.operator.startsWith("<")&&t.operator.startsWith("<")||this.semver.version===t.semver.version&&this.operator.includes("=")&&t.operator.includes("=")||Qc(this.semver,"<",t.semver,r)&&this.operator.startsWith(">")&&t.operator.startsWith("<")||Qc(this.semver,">",t.semver,r)&&this.operator.startsWith("<")&&t.operator.startsWith(">")))}};Bm.exports=mr;var Um=ki(),{safeRe:Km,t:Wm}=fr(),Qc=Xc(),Zc=an(),Fm=ue(),jm=Ce()});var dn=d((ZM,Jm)=>{var UR=Ce(),KR=(e,t,r)=>{try{t=new UR(t,r)}catch{return!1}return t.test(e)};Jm.exports=KR});var Gm=d((e$,Vm)=>{var WR=Ce(),FR=(e,t)=>new WR(e,t).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));Vm.exports=FR});var zm=d((t$,Xm)=>{var jR=ue(),BR=Ce(),JR=(e,t,r)=>{let n=null,o=null,i=null;try{i=new BR(t,r)}catch{return null}return e.forEach(s=>{i.test(s)&&(!n||o.compare(s)===-1)&&(n=s,o=new jR(n,r))}),n};Xm.exports=JR});var Qm=d((r$,Ym)=>{var VR=ue(),GR=Ce(),XR=(e,t,r)=>{let n=null,o=null,i=null;try{i=new GR(t,r)}catch{return null}return e.forEach(s=>{i.test(s)&&(!n||o.compare(s)===1)&&(n=s,o=new VR(n,r))}),n};Ym.exports=XR});var ty=d((n$,ey)=>{var eu=ue(),zR=Ce(),Zm=cn(),YR=(e,t)=>{e=new zR(e,t);let r=new eu("0.0.0");if(e.test(r)||(r=new eu("0.0.0-0"),e.test(r)))return r;r=null;for(let n=0;n<e.set.length;++n){let o=e.set[n],i=null;o.forEach(s=>{let a=new eu(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||Zm(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),i&&(!r||Zm(r,i))&&(r=i)}return r&&e.test(r)?r:null};ey.exports=YR});var ny=d((o$,ry)=>{var QR=Ce(),ZR=(e,t)=>{try{return new QR(e,t).range||"*"}catch{return null}};ry.exports=ZR});var ji=d((i$,ay)=>{var eC=ue(),sy=un(),{ANY:tC}=sy,rC=Ce(),nC=dn(),oy=cn(),iy=Di(),oC=Ki(),iC=Ui(),sC=(e,t,r,n)=>{e=new eC(e,n),t=new rC(t,n);let o,i,s,a,c;switch(r){case">":o=oy,i=oC,s=iy,a=">",c=">=";break;case"<":o=iy,i=iC,s=oy,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(nC(e,t,n))return!1;for(let u=0;u<t.set.length;++u){let l=t.set[u],p=null,h=null;if(l.forEach(f=>{f.semver===tC&&(f=new sy(">=0.0.0")),p=p||f,h=h||f,o(f.semver,p.semver,n)?p=f:s(f.semver,h.semver,n)&&(h=f)}),p.operator===a||p.operator===c||(!h.operator||h.operator===a)&&i(e,h.semver))return!1;if(h.operator===c&&s(e,h.semver))return!1}return!0};ay.exports=sC});var uy=d((s$,cy)=>{var aC=ji(),cC=(e,t,r)=>aC(e,t,">",r);cy.exports=cC});var dy=d((a$,ly)=>{var uC=ji(),lC=(e,t,r)=>uC(e,t,"<",r);ly.exports=lC});var hy=d((c$,fy)=>{var py=Ce(),dC=(e,t,r)=>(e=new py(e,r),t=new py(t,r),e.intersects(t,r));fy.exports=dC});var yy=d((u$,my)=>{var pC=dn(),fC=Re();my.exports=(e,t,r)=>{let n=[],o=null,i=null,s=e.sort((l,p)=>fC(l,p,r));for(let l of s)pC(l,t,r)?(i=l,o||(o=l)):(i&&n.push([o,i]),i=null,o=null);o&&n.push([o,null]);let a=[];for(let[l,p]of n)l===p?a.push(l):!p&&l===s[0]?a.push("*"):p?l===s[0]?a.push(`<=${p}`):a.push(`${l} - ${p}`):a.push(`>=${l}`);let c=a.join(" || "),u=typeof t.raw=="string"?t.raw:String(t);return c.length<u.length?c:t}});var Ey=d((l$,_y)=>{var gy=Ce(),ru=un(),{ANY:tu}=ru,pn=dn(),nu=Re(),hC=(e,t,r={})=>{if(e===t)return!0;e=new gy(e,r),t=new gy(t,r);let n=!1;e:for(let o of e.set){for(let i of t.set){let s=yC(o,i,r);if(n=n||s!==null,s)continue e}if(n)return!1}return!0},mC=[new ru(">=0.0.0-0")],vy=[new ru(">=0.0.0")],yC=(e,t,r)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===tu){if(t.length===1&&t[0].semver===tu)return!0;r.includePrerelease?e=mC:e=vy}if(t.length===1&&t[0].semver===tu){if(r.includePrerelease)return!0;t=vy}let n=new Set,o,i;for(let f of e)f.operator===">"||f.operator===">="?o=wy(o,f,r):f.operator==="<"||f.operator==="<="?i=by(i,f,r):n.add(f.semver);if(n.size>1)return null;let s;if(o&&i){if(s=nu(o.semver,i.semver,r),s>0)return null;if(s===0&&(o.operator!==">="||i.operator!=="<="))return null}for(let f of n){if(o&&!pn(f,String(o),r)||i&&!pn(f,String(i),r))return null;for(let w of t)if(!pn(f,String(w),r))return!1;return!0}let a,c,u,l,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,h=o&&!r.includePrerelease&&o.semver.prerelease.length?o.semver:!1;p&&p.prerelease.length===1&&i.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let f of t){if(l=l||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",o){if(h&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===h.major&&f.semver.minor===h.minor&&f.semver.patch===h.patch&&(h=!1),f.operator===">"||f.operator===">="){if(a=wy(o,f,r),a===f&&a!==o)return!1}else if(o.operator===">="&&!pn(o.semver,String(f),r))return!1}if(i){if(p&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===p.major&&f.semver.minor===p.minor&&f.semver.patch===p.patch&&(p=!1),f.operator==="<"||f.operator==="<="){if(c=by(i,f,r),c===f&&c!==i)return!1}else if(i.operator==="<="&&!pn(i.semver,String(f),r))return!1}if(!f.operator&&(i||o)&&s!==0)return!1}return!(o&&u&&!i&&s!==0||i&&l&&!o&&s!==0||h||p)},wy=(e,t,r)=>{if(!e)return t;let n=nu(e.semver,t.semver,r);return n>0?e:n<0||t.operator===">"&&e.operator===">="?t:e},by=(e,t,r)=>{if(!e)return t;let n=nu(e.semver,t.semver,r);return n<0?e:n>0||t.operator==="<"&&e.operator==="<="?t:e};_y.exports=hC});var Cy=d((d$,Ry)=>{var ou=fr(),Sy=sn(),gC=ue(),Ay=Jc(),vC=It(),wC=zh(),bC=Qh(),_C=tm(),EC=om(),SC=sm(),AC=cm(),RC=lm(),CC=pm(),PC=Re(),OC=ym(),TC=vm(),xC=Li(),IC=Em(),qC=Am(),HC=cn(),kC=Di(),MC=Vc(),$C=Gc(),NC=Ui(),LC=Ki(),DC=Xc(),UC=Hm(),KC=un(),WC=Ce(),FC=dn(),jC=Gm(),BC=zm(),JC=Qm(),VC=ty(),GC=ny(),XC=ji(),zC=uy(),YC=dy(),QC=hy(),ZC=yy(),eP=Ey();Ry.exports={parse:vC,valid:wC,clean:bC,inc:_C,diff:EC,major:SC,minor:AC,patch:RC,prerelease:CC,compare:PC,rcompare:OC,compareLoose:TC,compareBuild:xC,sort:IC,rsort:qC,gt:HC,lt:kC,eq:MC,neq:$C,gte:NC,lte:LC,cmp:DC,coerce:UC,Comparator:KC,Range:WC,satisfies:FC,toComparators:jC,maxSatisfying:BC,minSatisfying:JC,minVersion:VC,validRange:GC,outside:XC,gtr:zC,ltr:YC,intersects:QC,simplifyRange:ZC,subset:eP,SemVer:gC,re:ou.re,src:ou.src,tokens:ou.t,SEMVER_SPEC_VERSION:Sy.SEMVER_SPEC_VERSION,RELEASE_TYPES:Sy.RELEASE_TYPES,compareIdentifiers:Ay.compareIdentifiers,rcompareIdentifiers:Ay.rcompareIdentifiers}});var Py=d(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});var tP=Cy(),rP=qe(),nP=fc();function oP(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var iP=oP(tP);function sP(e){let t={package:"shopify-app"},r=(o,i={})=>e.warning(o,{...t,...i});function n(o){return function(i,s){if(iP.default.gte(nP.SHOPIFY_REMIX_LIBRARY_VERSION,i))throw new rP.FeatureDeprecatedError(`Feature was deprecated in version ${i}`);return o(`[Deprecated | ${i}] ${s}`)}}return{...e,log:(o,i,s={})=>e.log(o,i,{...t,...s}),debug:(o,i={})=>e.debug(o,{...t,...i}),info:(o,i={})=>e.info(o,{...t,...i}),warning:r,error:(o,i={})=>e.error(o,{...t,...i}),deprecated:n(r)}}iu.overrideLogger=sP});var Ty=d(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});var aP=(Ye(),R(ze)),Oy=Ai();function cP(e){let{api:t,config:r,logger:n}=e;return async function(i){let a=new URL(i.url).searchParams.get("shop");if(i.method==="GET"&&!a)return{};let c=a||(await i.formData()).get("shop");if(!c)return n.debug("Missing shop parameter",{shop:c}),{shop:Oy.LoginErrorType.MissingShop};let u=c.replace(/^https?:\/\//,"").replace(/\/$/,""),l=c?.indexOf(".")===-1?`${u}.myshopify.com`:u,p=t.utils.sanitizeShop(l);if(!p)return n.debug("Invalid shop parameter",{shop:c}),{shop:Oy.LoginErrorType.InvalidShop};let h=`${r.appUrl}${r.auth.path}?shop=${p}`;throw n.info(`Redirecting login request to ${h}`,{shop:p}),aP.redirect(h)}}su.loginFactory=cP});var cu=d(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});async function uP(e,{api:t,config:r}){let n=t.session.getOfflineId(e);return await r.sessionStorage.loadSession(n)}au.getOfflineSession=uP});var xy=d(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});var lP=qe(),dP=rn(),pP=cu();function fP(e){return async t=>{let r=await pP.getOfflineSession(t,e);if(!r)throw new lP.ShopifyError(`Could not find a session for shop ${t} when creating unauthenticated admin context`);return{session:r,admin:dP.adminClientFactory({params:e,session:r})}}}uu.unauthenticatedAdminContextFactory=fP});var Iy=d(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});var hP=Pi(),mP=_c(),yP=Oi(),gP=Ac(),vP=Cc();function wP(e){return async function(r,n={}){var o;let{logger:i}=e,s=(o=n.corsHeaders)!==null&&o!==void 0?o:[];gP.rejectBotRequest(e,r),vP.respondToOptionsRequest(e,r,s);let a=yP.getSessionTokenHeader(r);if(i.info("Authenticating checkout request"),!a)throw i.debug("Request did not contain a session token"),new Response(void 0,{status:401,statusText:"Unauthorized"});return{sessionToken:await mP.validateSessionToken(e,a,{checkAudience:!1}),cors:hP.ensureCORSHeadersFactory(e,r,s)}}}lu.authenticateCheckoutFactory=wP});var pu=d(du=>{"use strict";Object.defineProperty(du,"__esModule",{value:!0});var bP=St();function _P({params:e,session:t}){let{api:r}=e;return{graphql:async(n,o={})=>{let s=await new r.clients.Storefront({session:t,apiVersion:o.apiVersion}).query({data:{query:n,variables:o?.variables},tries:o.tries,extraHeaders:o.headers});return new Response(JSON.stringify(s.body),{headers:bP.flatHeaders(s.headers)})}}}du.storefrontClientFactory=_P});var Hy=d(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});var EP=rn(),SP=pu();function AP(e){let{api:t,config:r,logger:n}=e;return async function(i){n.info("Authenticating app proxy request");let{searchParams:s}=new URL(i.url),a=Object.fromEntries(s.entries()),c=!1;try{c=await t.utils.validateHmac(a,{signator:"appProxy"})}catch(f){throw n.info(f.message),new Response(void 0,{status:400,statusText:"Bad Request"})}if(!c)throw n.info("App proxy request has invalid signature"),new Response(void 0,{status:400,statusText:"Bad Request"});let u=s.get("shop"),l=t.session.getOfflineId(u),p=await r.sessionStorage.loadSession(l);return p?{liquid:qy,session:p,admin:EP.adminClientFactory({params:e,session:p}),storefront:SP.storefrontClientFactory({params:e,session:p})}:{liquid:qy,session:void 0,admin:void 0,storefront:void 0}}}var qy=(e,t)=>{if(typeof t!="object")return new Response(e,{status:t||200,headers:{"Content-Type":"application/liquid"}});let{layout:r,...n}=t||{},o=r===!1?`{% layout none %} ${e}`:e,i=new Headers(n.headers);return i.set("Content-Type","application/liquid"),new Response(o,{...n,headers:i})};fu.authenticateAppProxyFactory=AP});var ky=d(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});var RP=Iy(),CP=Hy();function PP(e){let{logger:t,config:r}=e,n=RP.authenticateCheckoutFactory(e),o=CP.authenticateAppProxyFactory(e);if(r.future.v3_authenticatePublic)return{checkout:n,appProxy:o};let i=(s,a)=>(t.deprecated("3.0.0","authenticate.public() will be deprecated in v3. Use authenticate.public.checkout() instead."),n(s,a));return i.checkout=n,i.appProxy=o,i}hu.authenticatePublicFactory=PP});var My=d(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});var OP=qe(),TP=pu(),xP=cu();function IP(e){return async t=>{let r=await xP.getOfflineSession(t,e);if(!r)throw new OP.ShopifyError(`Could not find a session for shop ${t} when creating unauthenticated storefront context`);return{session:r,storefront:TP.storefrontClientFactory({params:e,session:r})}}}mu.unauthenticatedStorefrontContextFactory=IP});var $y=d(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});Ms();var Bi=qe(),fn=Ai(),qP=fc(),HP=ph(),kP=kh(),MP=Mh(),$P=Py(),NP=Nc();zn();var LP=Ty(),DP=xy(),UP=ky(),KP=My();function WP(e){let t=BP(e),r=JP(e,t.config),n=$P.overrideLogger(t.logger);e.webhooks&&t.webhooks.addHandlers(e.webhooks);let o={api:t,config:r,logger:n},i=new kP.AuthStrategy(o),s={sessionStorage:r.sessionStorage,addDocumentResponseHeaders:NP.addDocumentResponseHeadersFactory(o),registerWebhooks:HP.registerWebhooksFactory(o),authenticate:{admin:i.authenticateAdmin.bind(i),public:UP.authenticatePublicFactory(o),webhook:MP.authenticateWebhookFactory(o)},unauthenticated:{admin:DP.unauthenticatedAdminContextFactory(o),storefront:KP.unauthenticatedStorefrontContextFactory(o)}};return(FP(s,e)||jP(s,e))&&(s.login=LP.loginFactory(o)),s}function FP(e,t){return t.distribution===fn.AppDistribution.AppStore}function jP(e,t){return t.distribution===fn.AppDistribution.SingleMerchant}function BP(e){var t,r;let n;try{n=new URL(e.appUrl)}catch{throw new Bi.ShopifyError("Invalid appUrl provided. Please provide a valid URL.")}n.hostname==="localhost"&&!n.port&&process.env.PORT&&(n.port=process.env.PORT),e.appUrl=n.origin;let o=`Shopify Remix Library v${qP.SHOPIFY_REMIX_LIBRARY_VERSION}`;return e.userAgentPrefix&&(o=`${e.userAgentPrefix} | ${o}`),Bi.shopifyApi({...e,hostName:n.host,hostScheme:n.protocol.replace(":",""),userAgentPrefix:o,isEmbeddedApp:(t=e.isEmbeddedApp)!==null&&t!==void 0?t:!0,apiVersion:(r=e.apiVersion)!==null&&r!==void 0?r:Bi.LATEST_API_VERSION,isCustomStoreApp:e.distribution===fn.AppDistribution.ShopifyAdmin})}function JP(e,t){var r,n,o,i;if(!e.sessionStorage)throw new Bi.ShopifyError("Please provide a valid session storage. Refer to https://github.com/Shopify/shopify-app-js/blob/main/README.md#session-storage-options for options.");let s=e.authPathPrefix||"/auth";return e.distribution=(r=e.distribution)!==null&&r!==void 0?r:fn.AppDistribution.AppStore,{...e,...t,canUseLoginForm:e.distribution!==fn.AppDistribution.ShopifyAdmin,useOnlineTokens:(n=e.useOnlineTokens)!==null&&n!==void 0?n:!1,hooks:(o=e.hooks)!==null&&o!==void 0?o:{},sessionStorage:e.sessionStorage,future:(i=e.future)!==null&&i!==void 0?i:{},auth:{path:s,callbackPath:`${s}/callback`,patchSessionTokenPath:`${s}/session-token`,exitIframePath:`${s}/exit-iframe`,loginPath:`${s}/login`}}}yu.shopifyApp=WP});var zP=d(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});Ms();var VP=St(),hn=qe(),Ny=Ai(),GP=dh(),XP=$y();VP.setAbstractRuntimeString(()=>"Remix");Object.defineProperty(He,"ApiVersion",{enumerable:!0,get:function(){return hn.ApiVersion}});Object.defineProperty(He,"BillingInterval",{enumerable:!0,get:function(){return hn.BillingInterval}});Object.defineProperty(He,"DeliveryMethod",{enumerable:!0,get:function(){return hn.DeliveryMethod}});Object.defineProperty(He,"LATEST_API_VERSION",{enumerable:!0,get:function(){return hn.LATEST_API_VERSION}});Object.defineProperty(He,"LogSeverity",{enumerable:!0,get:function(){return hn.LogSeverity}});He.AppDistribution=Ny.AppDistribution;He.LoginErrorType=Ny.LoginErrorType;He.boundary=GP.boundary;He.shopifyApp=XP.shopifyApp});export{ig as a,zP as b};
